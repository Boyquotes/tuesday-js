<!doctype html>
<html>
<head>
<title>Tuesday js visual editor</title>
<link rel="shortcut icon" href="icon.jpg" type="image/x-icon">
<meta charset="UTF-8">
<style>
*{
	font-family:Arial;
	border-collapse:collapse;
	border:none;
	margin:0;
	padding:0;
	border-spacing:0px;
	-webkit-touch-callout:none;
	-webkit-user-select:none;
	-khtml-user-select:none;
	-moz-user-select:none;
	-ms-user-select:none;
	user-select:none;
	outline:none;
}
:root {
  --cw:#efefff;
  --cb:#cec8e3;
  --cs:rgba(110,95,165,0.25);
  --cm:rgba(110,95,165,0.5);
  --cf:rgba(90,75,145,1);
}
.panel{background-color:#fff;box-shadow:0px 2px 24px var(--cs);border-radius:16px;padding:4px;}
@keyframes flash{0%{box-shadow:0px 2px 32px var(--cf);background-color:var(--cb);}25%{box-shadow:0px 2px 32px var(--cf);background-color:var(--cb);}100%{box-shadow:0px 2px 24px var(--cs);background-color:#fff;}}
.story_block{min-height:28px;width:256px;position:absolute;cursor:all-scroll;}
#world{position:absolute;-ms-transform:scale(1);transform:scale(1);-webkit-transform-origin: 0 0;-moz-transform-origin: 0 0;}
line{stroke:#6e5fa5;stroke-dasharray:20;stroke-width:2;animation:dash 4s linear infinite;}
@keyframes dash{from{stroke-dashoffset:0} to{stroke-dashoffset:200;}}
#toast{
	position:fixed;
	opacity:0;
	bottom:-10%;
	transform:translateX(-50%);
	padding:0px 32px;
	height:40px;
	min-width:128px;
	box-shadow:0px 2px 24px var(--cs);
	z-index:10000;
}
.toast_anim{left:50%;background-color:#fff;border-radius:32px;animation:viwe 0.25s,stop 2s 0.25s,close 0.5s 2s linear;}
@keyframes viwe{from{opacity:0;bottom:64px} to{opacity:1;bottom:64px}}
@keyframes stop{from{opacity:1;bottom:64px} to{opacity:1;bottom:64px}}
@keyframes close{from{opacity:1;bottom:64px} to{opacity:0;bottom:-32px}}
#new_story_block, #scene_controll{
	position:fixed;
	height:40px;
	z-index:1000;
	bottom:32px;
	right:32px;
    border-radius:20px;
    background-color:#fff;
    box-shadow:0px 2px 24px var(--cs);
    cursor:pointer;
}
#menu_panel{
	z-index:1000;
	top:0;
	left:0;
	background-color:#fff;
	box-shadow:0px 2px 24px var(--cs);
	border-radius:0 0 16px 0;
	position:fixed;
	height:40px;
	max-width:540px;
	width:100%;
}
.button_block{height:26px;width:26px;background-size:70% 70%;background-repeat:no-repeat;background-position:center;}
.icon{background-size:22px 22px;background-repeat:no-repeat;background-position:center;}
.icon_m{background-size:18px 18px;background-repeat:no-repeat;background-position:center;cursor:pointer;}
.button_menu{background-position:center;cursor:pointer;}
.button_menu:hover{background-color:var(--cb);}
.icon_new{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yMjMsNTIuNjZWMjQ5SDM1VjZIMTc2LjM0WiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTIyMyw1M0gxNzZWNiIvPg0KPC9zdmc+DQo=")}
.icon_load{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00OC4xMTYsODUuMzc0SDI1MS45OTFMMjA4Ljg3NSwyMjZINVoiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00OC4xMTYsODUuMzc0TDUsMjI2VjUxLjMyNUwxOC43LDM0SDY1LjQ0NWwxMy43LDE3LjMyNUgyMDguODc1Vjg1LjM3NEg0OC4xMTZaIi8+DQo8L3N2Zz4NCg==")}
.icon_save{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yMzgsNTEuOTE5VjIyOGExMCwxMCwwLDAsMS0xMCwxMEgyN2ExMCwxMCwwLDAsMS0xMC0xMFYyN0ExMCwxMCwwLDAsMSwyNywxN0gyMDMuMTE4WiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTM5LDIzOFYxMjdhMTAsMTAsMCwwLDEsMTAtMTBIMjA1YTEwLDEwLDAsMCwxLDEwLDEwVjIzOEgzOVpNMTc0LjIsOTUuNjVINzkuOGExMCwxMCwwLDAsMS0xMC0xMFYxN0gxODQuMlY4NS42NUExMCwxMCwwLDAsMSwxNzQuMiw5NS42NVpNMTY4LDQyYTEwLDEwLDAsMCwwLTEwLTEwSDE0NGExMCwxMCwwLDAsMC0xMCwxMFY3MWExMCwxMCwwLDAsMCwxMCwxMGgxNGExMCwxMCwwLDAsMCwxMC0xMFY0MloiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik02MywxNjJIMTkybTAsNDlINjMiLz4NCjwvc3ZnPg0K")}
.icon_play{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik03LDI0TDI0OCwxMjYuODg2VjEyOEw3LDIzMC44ODZWMjRaIi8+DQo8L3N2Zz4NCg==")}
.icon_edit{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xNjQuNzMzLDM3LjIzNGw1My4wMzMsNTMuMDMzLTEzMS43LDEzMS43TDMzLDE2OVoiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0yMjUuNzIxLDE2LjlMMjM4LjEsMjkuMjc5YTI4Ljc1MSwyOC43NTEsMCwwLDEsMCw0MC42NTlsLTIwLjMzLDIwLjMyOUwxNjQuNzMzLDM3LjIzNCwxODUuMDYzLDE2LjlBMjguNzQ5LDI4Ljc0OSwwLDAsMSwyMjUuNzIxLDE2LjlaIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNNTkuNTUxLDE5NS40NDlMMTkwLjM2Niw2NC42MzQiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik05LjE3LDI0NS44M2gwbDczLjM2Mi0yMi4xTDMyLjE1MSwxNzMuMzUyWiIvPgo8L3N2Zz4K")}
.icon_show{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yNDYsNDBIMTAiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yNDYsMTMwSDEwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMjQ2LDIyMEgxMCIvPg0KPC9zdmc+")}
.icon_setup{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTI4LjQ2OSw2LjgxM2ExNC4wNDcsMTQuMDQ3LDAsMSwxLTE0LDE0LjA0N0ExNC4wMjQsMTQuMDI0LDAsMCwxLDI4LjQ2OSw2LjgxM1ptNzQuMjY1LDQzLjIxOUExNC4wMzEsMTQuMDMxLDAsMSwxLDg4Ljc1LDY0LjA2MywxNC4wMDgsMTQuMDA4LDAsMCwxLDEwMi43MzQsNTAuMDMxWk02My45NjksOTMuMjE5YTE0LjAzMSwxNC4wMzEsMCwxLDEtMTQsMTQuMDMxQTE0LjAxNiwxNC4wMTYsMCwwLDEsNjMuOTY5LDkzLjIxOVpNNDkuOTg1LDEwNy4yNjVIMi42MjRtMC04Ni40aDExLjg0bS0xMS44NCw0My4ySDg3LjY1OW0zNy42NzQsNDMuMkg3Ny45NzFNNDIuNDUsMjAuODY1aDgyLjg4M20tOC42MTEsNDMuMmg4LjYxMSIvPg0KPC9zdmc+DQo=")}
.icon_about{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEwNiwxMDRoMjJ2ODYiLz4KICA8Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMTI4IiBjeT0iNjQiIHI9IjYiLz4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEwNiwxOTJoNDIiLz4KICA8Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMjAiLz4KPC9zdmc+Cg==")}
.icon_close{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNzEuMDc4LDE4NC40MjJMMTg0LjkyMiw3MC41NzgiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xODQuOTIyLDE4NC40MjJMNzEuMDc4LDcwLjU3OCIvPg0KPC9zdmc+")}
.icon_ok{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTk0LDgybC04Niw4Nkw2MSwxMjQiLz4NCjwvc3ZnPg==")}
.icon_build{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00NywxN0gyMDlhMzAsMzAsMCwwLDEsMzAsMzBWMjA5YTMwLDMwLDAsMCwxLTMwLDMwSDQ3YTMwLDMwLDAsMCwxLTMwLTMwVjQ3QTMwLDMwLDAsMCwxLDQ3LDE3WiIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE0OCwxNjIuNUgzOG0xODAsMEgxNzZtLTEwNywxOS0xNCwyNG05Mi0xNTUtNjcsMTEybTU5LTYyLDYzLDEwNW0tOTMtMTU1LDE5LDMxIi8+Cjwvc3ZnPgo=")}
.icon_go{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik04MiwzNmw5MSw5MUw4MiwyMTkiLz4KPC9zdmc+Cg==")}
.icon_add{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNDcsMTI4aDE2MSIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOCwyMDhWNDciLz4NCjwvc3ZnPg==")}
.icon_del{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xOTQuNDMxLDYyLjY3NVYyMzAuNTA4SDYzLjU2OVY2Mi42NzUiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00Ny4zNDYsNDUuNDkySDIxMC42NTQiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xMDgsMjNoMzlWNDVIMTA4VjIzWiIvPg0KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOC41NTUsNjIuMzgyVjIxMy40MzEiLz4NCiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik05Mi41LDYyLjM4MlYyMTMuNDMxIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTY0LjYwNSw2Mi4zODJWMjEzLjQzMSIvPg0KPC9zdmc+")}
.icon_json{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xNzcsNGgyNGM3LjQ1NywwLDEzLjgsMS42ODUsMTgsNnM2LDEwLjM4OSw2LDE4djgybDI3LjQ2LDE3Ljk0MUwyMjUsMTQ2djgyYzAsNy41MzQtMS43NjIsMTIuNjQ1LTYsMTdzLTEwLjYyMyw3LTE4LDdIMTc3Ii8+CiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik04NCw3SDYwYy03LjQ1NiwwLTEzLjgsMS42ODUtMTgsNnMtNiwxMC4zODktNiwxOHY3OUw4LjU0LDEyNy45NDEsMzYsMTQ2djc5YzAsNy41MzQsMS43NjIsMTIuNjQ1LDYsMTdzMTAuNjIzLDcsMTgsN0g4NCIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMTEzLDIxMmM5LjQzNiwwLDE3LjkzNy0zLjc1MSwyMi0xMCwzLjE4Ny00LjgxMyw0LTEyLjc1MSw0LTI1VjcyIi8+CiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgY3g9IjEzOS4zNzUiIGN5PSI0My41OTQiIHI9IjIuNSIvPgo8L3N2Zz4K")}
.icon_csv{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMjE3LDE5NkgxMDlMNDMsMjQ5VjE5NkgzOGMtMTYuNTY4LDAtMjktMTMuNDMxLTI5LTMwVjM4QzksMjEuNDMyLDIyLjQzMiw5LDM5LDlIMjE4YzE2LjU2OSwwLDI5LDEyLjQzMiwyOSwyOVYxNjZBMzAsMzAsMCwwLDEsMjE3LDE5NloiLz4NCjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJtIDEyOSw2MSB2IDk0IiAvPg0KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Im0gODQsMTAxIDQ1LC00OCA0NCw0NyIvPgkgDQo8L3N2Zz4=")}
.icon_text{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0yMTcsMTk2SDEwOUw0MywyNDlWMTk2SDM4Yy0xNi41NjgsMC0yOS0xMy40MzEtMjktMzBWMzhDOSwyMS40MzIsMjIuNDMyLDksMzksOUgyMThjMTYuNTY5LDAsMjksMTIuNDMyLDI5LDI5VjE2NkEzMCwzMCwwLDAsMSwyMTcsMTk2WiIvPgo8L3N2Zz4K")}
.icon_up{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMTIsMTg4IDEyOCw2MCAyNDYsMTg4eiIvPgkgDQo8L3N2Zz4=")}
.icon_down{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xMiw2MCAxMjgsMTg4IDI0Niw2MHoiLz4JIAo8L3N2Zz4=")}
.icon_goto{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xMTgsODhsNDIsNDAtNDIsNDYiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik03MCwxMjhoODQiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0zNCwyMjBWMzYiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0yNDgsMjIwSDE5MlYzNmg1NiIvPgo8L3N2Zz4K")}
.icon_back{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xMzgsODhMOTYsMTI4bDQyLDQ2Ii8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMTg2LDEyOEgxMDIiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0yMjIsMjIwVjM2Ii8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNOCwyMjBINjRWMzZIOCIvPgo8L3N2Zz4K")}
.icon_edit2{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE3MCw1NWg1OGEyMCwyMCwwLDAsMSwyMCwyMFYyMjVhMjAsMjAsMCwwLDEtMjAsMjBIMjlBMjAsMjAsMCwwLDEsOSwyMjVWNzVjMC0xMS4wNDYsOS45NTQtMjEsMjEtMjFIODciLz4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEwNS4xMyw5LjM3aDQ2Ljc0VjE2MC45OUgxMDUuMTNWOS4zN1oiLz4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyNy4zNjksMjA0LjMxaDIuMjc5bDIyLjIyMi00My4zMkgxMDUuMTQ3WiIvPgo8L3N2Zz4K")}
.icon_art{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8Y2lyY2xlIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGN4PSI2MCIgY3k9Ijk2IiByPSIxOSIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTkuNTYzLDI0LjM3NWgyMTcuMjNhMTAsMTAsMCwwLDEsMTAsMTBWMjI4LjkxYTEwLDEwLDAsMCwxLTEwLDEwSDE5LjU2M2ExMCwxMCwwLDAsMS0xMC0xMFYzNC4zNzVBMTAsMTAsMCwwLDEsMTkuNTYzLDI0LjM3NVoiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTcxLDIwMUgyNDJNMjgsMjAxSDUzIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik05MSwxOThsNDItNDMsNDIsNDMiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTE1NywxNzZsNDItNDIsNDMsNDIiLz4KPC9zdmc+Cg==")}
.icon_textadd{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0yMTcsMTk2SDEwOUw0MywyNDlWMTk2SDM4Yy0xNi41NjgsMC0yOS0xMy40MzEtMjktMzBWMzhDOSwyMS40MzIsMjIuNDMyLDksMzksOUgyMThjMTYuNTY5LDAsMjksMTIuNDMyLDI5LDI5VjE2NkEzMCwzMCwwLDAsMSwyMTcsMTk2WiIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTg2LDEwM2g4NCIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTEyOCw2MXY4NCIvPgo8L3N2Zz4K")}
.icon_audio_off{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik01Miw5MC43NzNMMTMzLDMwVjIyNUw1MiwxNjQuMjI3VjkwLjc3M1oiLz4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgZD0iTTEwLDkxSDUydjczSDEwVjkxWiIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMTczLjMsOTguM2w1OS40LDU5LjRtMC01OS40LTU5LjQsNTkuNCIvPgo8L3N2Zz4K")}
.icon_audio_play{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik01Miw5MC43NzNMMTMzLDMwVjIyNUw1MiwxNjQuMjI3VjkwLjc3M1oiLz4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xMCw5MUg1MnY3M0gxMFY5MVoiLz4KICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xODguOTU1LDYwLjIxNWMyNS4wNjMsMzcuMjU5LDI1LjA2Myw5Ny42NjksMCwxMzQuOTI4bS0yNy4yMjgtOTQuNDQ5YzEwLjAyNSwxNC45LDEwLjAyNSwzOS4wNjcsMCw1My45NzFNMjE2LjE5MiwxOC41MTljNDAuMTA1LDU5LjYyMiw0MC4xMDUsMTU2LjI4OCwwLDIxNS45MSIvPgo8L3N2Zz4K")}
.icon_event{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xMjguODgsMTcuNTZBMTExLjMyLDExMS4zMiwwLDAsMCwyNDAuMiwxMjguODhjMC4xNDcsMCwuMjkzLDAsMC40NC0wLjAwNnYxLjc3MkExMTEuMzExLDExMS4zMTEsMCwwLDAsMTI5Ljc3NywyNDAuNjRoLTEuNzgzQTExMS4zMTYsMTExLjMxNiwwLDAsMCwxNi42OCwxMjkuNzZjLTAuNDQxLDAtLjg4LjAxMi0xLjMyLDAuMDE3di0xLjc4M2MwLjE0NywwLC4yOTMuMDA2LDAuNDQsMC4wMDZBMTExLjMyLDExMS4zMiwwLDAsMCwxMjcuMTIsMTYuNjgiLz4KPC9zdmc+Cg==")}
.icon_var{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik00Mi41LDIxNkMyNS42NTUsMjE2LDEyLDE3Ni42LDEyLDEyOFMyNS42NTUsNDAsNDIuNSw0MG0xNzEsMTc2YzE2Ljg0NSwwLDMwLjUtMzkuNCwzMC41LTg4cy0xMy42NTUtODgtMzAuNS04OE04MCw1NWw5NywxNDVtMC0xNDVMODAsMjAwIi8+Cjwvc3ZnPgo=")}
.icon_controll{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTIwIi8+CjxjaXJjbGUgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGN4PSIxMjgiIGN5PSIxMjgiIHI9IjYwIi8+Cjwvc3ZnPgo=")}
.icon_choice{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xNjUsMjQ3VjE2NWg4MnY4MkgxNjVabTAtMjM3aDgyVjkySDE2NVYxMFpNMTAsMTBIOTJWOTJIMTBWMTBaIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBkPSJNMTY1LDIwNkgxMjhWNTEiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGQ9Ik0xNjUsNTFIOTIiLz4KPC9zdmc+Cg==")}
.icon_html{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTc4LjAxMywyMDUuMjI4TDEuNDgsMTI4LjcsNzguMDEzLDUyLjE2MyIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTc0LjQxMiwyMDUuMjI4TDI1MC45NDUsMTI4LjcsMTc0LjQxMiw1Mi4xNjMiLz4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTk0LDIxMS43NDFMMTU5LjcsNDMuOTg3Ii8+Cjwvc3ZnPgo=")}
.icon_equal{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNDcuNSwxMjcuNWgxNjEiLz4KCTxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTI4LDIwOFY0NyIvPgo8L3N2Zz4K")}
.icon_minus{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KCTxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNNDcuNSwxMjcuNWgxNjEiLz4KPC9zdmc+Cg==")}
.icon_scale{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iOTIiLz4KPC9zdmc+Cg==")}
.icon_color{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTYsN0g0MVYxMjNINlY3Wk01Miw1MUw4MCwyM2wyNSwyNUw1MiwxMDBNNzgsODdoNDR2MzVINTUiLz4KPGNpcmNsZSBpZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjIzLjUiIGN5PSIxMDQuNSIgcj0iNi41Ii8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00MSw4NEg2TTYsNDZINDFtMTEsNUw3Niw3NW03LDEydjM1Ii8+Cjwvc3ZnPgo=")}
.icon_right{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Im0gMTc1LDM2IC05MSw5MSA5MSw5MSIvPgo8L3N2Zz4K")}
.icon_layout{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xNCwxNDBWMTVIMjQyVjE0MCIvPgo8cmVjdCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgeD0iMTQiIHk9IjE2MSIgd2lkdGg9IjIyOCIgaGVpZ2h0PSI3NyIgcng9IjE1IiByeT0iMTUiLz4KPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyNy41IiBjeT0iNjAuNSIgcj0iMjUuNSIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgIGQ9Ik03NywxNDBjMC0yMS41MzksMjIuNjEtMzksNTAuNS0zOVMxNzgsMTE4LjQ2MSwxNzgsMTQwIi8+Cjwvc3ZnPgo=")}
.icon_copu{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KICA8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE3NCwyMDZ2MjZhMjAsMjAsMCwwLDEtMjAsMjBIMzdhMjAsMjAsMCwwLDEtMjAtMjBWNjlBMjAsMjAsMCwwLDEsMzcsNDlIODIuNzUiLz4KICA8cmVjdCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgeD0iODIiIHk9IjQiIHdpZHRoPSIxNTciIGhlaWdodD0iMjAzIiByeD0iMjAiIHJ5PSIyMCIvPgo8L3N2Zz4K")}
.icon_more{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPGNpcmNsZSBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIGN4PSIyMTMiIGN5PSIxMjgiIHI9IjEyIi8+CjxjaXJjbGUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBjeD0iMTI4IiBjeT0iMTI4IiByPSIxMiIvPgo8Y2lyY2xlIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxMiIgY3g9IjQyIiBjeT0iMTI4IiByPSIxMiIvPgo8L3N2Zz4K")}
.icon_toast{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHJlY3QgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjI4IiB5PSI2OCIgd2lkdGg9IjE5OSIgaGVpZ2h0PSIxMDAiIHJ4PSIzMCIgcnk9IjMwIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMjUxLDIxNUg1Ii8+Cjwvc3ZnPgo=")}
.bg_1{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyB2aWV3Qm94PScwIDAgMTAwIDEwMCc+CjxnIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxcHgiPgogIDxwYXRoIHN0cm9rZS1vcGFjaXR5PScwLjUnIGQ9Ik0tMTIsMTRIMTEyTS0xMiwyNEgxMTJNLTEyLDM0SDExMk0tMTIsNDRIMTEyTS0xMiw1NEgxMTJNLTEyLDY0SDExMk0tMTIsNzRIMTEyTS0xMiw4NEgxMTJNLTEyLDk0SDExMk0xNCwxMTlWLTVNMjQsMTE5Vi01TTM0LDExOVYtNU00NCwxMTlWLTVNNTQsMTE5Vi01TTY0LDExOVYtNU03NCwxMTlWLTVNODQsMTE5Vi01TTk0LDExOVYtNSIvPgogIDxwYXRoIGQ9Ik0tMTIsNUgxMTJNNCwxMTlWLTUiLz4KPC9nPgo8L3N2Zz4K")}
.bg_2{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTY0LDE0LjQwNnY5LjI2OUw0MC4zMjUsMGg5LjI2OVptLTY0LDBMMTQuNDA2LDBoOS4yNjlMMCwyMy42NzVWMTQuNDA2Wk0wLDQ5LjU5NFY0MC4zMjVMMjMuNjc1LDY0SDE0LjQwNlpNOC4zMjUsMzJMMzIsOC4zMjUsNTUuNjc1LDMyLDMyLDU1LjY3NVpNMzIsMTcuNTk0TDE3LjU5NCwzMiwzMiw0Ni40MDYsNDYuNDA2LDMyWm0zMiwzMkw0OS41OTQsNjRINDAuMzI1TDY0LDQwLjMyNXY5LjI2OVoiLz4KPC9zdmc+Cg==")}
.bg_3{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTMyLDMyVjBINjRWMzJIMzJaTTAsNjRWMzJIMzJWNjRIMFoiLz4KPC9zdmc+Cg==")}
.bg_4{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTMyLDBMNjMuOTc3LDMxLjk3NywzMiw2My45NTUsMC4wMjMsMzEuOTc3WiIvPgo8L3N2Zz4K")}
.bg_5{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTQxLjkzMSwzNS4zMUgzNS4zMXY2LjYyMUgyOC42OVYzNS4zMUgyMi4wNjlWMjguNjlIMjguNjlWMjIuMDY5SDM1LjMxVjI4LjY5aDYuNjIxVjM1LjMxWiIvPgo8L3N2Zz4K")}
.bg_6{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTY0LDcuMTg4QTcuMTg4LDcuMTg4LDAsMCwxLDU2LjgxMywwSDY0VjcuMTg4Wm0tNjQsMFYwSDcuMTg4QTcuMTg3LDcuMTg3LDAsMCwxLDAsNy4xODhaTTcuMTg4LDY0SDBWNTYuODEzQTcuMTg4LDcuMTg4LDAsMCwxLDcuMTg4LDY0Wk0zMiwzOS4yQTcuMiw3LjIsMCwxLDEsMzkuMiwzMiw3LjIsNy4yLDAsMCwxLDMyLDM5LjJaTTY0LDU2LjgxM1Y2NEg1Ni44MTNBNy4xODgsNy4xODgsMCwwLDEsNjQsNTYuODEzWiIvPgo8L3N2Zz4K")}
.bg_7{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHJlY3Qgb3BhY2l0eT0iMC4yNSIgZmlsbD0iI2ZmZiIgeD0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSI2NCIvPgo8cmVjdCBvcGFjaXR5PSIwLjI1IiBmaWxsPSIjZmZmIiB5PSIxNiIgd2lkdGg9IjY0IiBoZWlnaHQ9IjMyIi8+Cjwvc3ZnPgo=")}
.bg_8{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgdmlld0JveD0iMCAwIDY0IDY0Ij4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTY0LDUzLjQ3djkuMjdoMEw2Mi43MzksNjRINTMuNDdabTAtOC4zODZMNDUuMTI0LDY0SDM2LjAwN2wtMC4xLS4xaDBMNjQsMzUuODE0djkuMjY5aDBaTTQwLjU3MSw0LjY0NUwzNS45MjUsMGg5LjI4Wm0tMTcuMTQzLDBMMTguNzkxLDBoOS4yODRaTTMyLDQ4LjQ5MWwtNS44LDUuOC00LjYzNS00LjYzNUwzMiwzOS4yMjEsNDIuNDM0LDQ5LjY1NSwzNy44LDU0LjI5Wm0wLTE3LjY1NUwxNy4zNzMsNDUuNDYybC00LjYzNS00LjYzNUwzMiwyMS41NjYsNTEuMjYyLDQwLjgyOGwtNC42MzUsNC42MzVaTTE0LjYyNywxMy40NDhMMS4xNzksMGg5LjI2OWw4LjgxMyw4LjgxM1pNNS44LDIyLjI3NUwwLDE2LjQ3NlY3LjIwN0wxMC40MzQsMTcuNjQxWk0zMiwxMy4xOEw4LjU3LDM2LjY2LDMuOTExLDMyaDBMMzIsMy45MTEsNjAuMDg5LDMybC00LjY2Miw0LjY2MlptMjYuMiw5LjEtNC42MzUtNC42MzVMNjQsNy4yMDd2OS4yNjloMFpNNDQuNzM4LDguODEzTDUzLjU1MSwwaDkuMjdMNDkuMzczLDEzLjQ0OFpNMjcuOTkzLDY0aC05LjEyTDAsNDUuMDg0VjM1LjgxNEwyOC4wODksNjMuOVpNMS4yNjEsNjRMMCw2Mi43MzlWNTMuNDdMMTAuNTMxLDY0SDEuMjYxWiIvPgo8L3N2Zz4K")}
.bg_9{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiB2aWV3Qm94PSIwIDAgMTI4IDEyOCI+PGcgZmlsbD0iI2ZmZiI+CiAgPHBhdGggb3BhY2l0eT0iMC45IiBkPSJNMzIsOTZIMGwxNiwzMk0xMjgsMzJIOTZsMTYsMzJtMCw2NEg4MEw5Niw5Nk04MCwwSDQ4TDY0LDMyIi8+CiAgPHBhdGggb3BhY2l0eT0iMC43IiBkPSJNMzIsOTZIMEwxNiw2NE05Niw5Nkg2NGwxNiwzMm00OC0zMkg5NmwxNi0zMk04MCw2NEg0OEw2NCwzMm0wLDBIMzJMNDgsMG02NCw2NEg4MEw5NiwzMk0xMTIsMEg4MEw5NiwzMiIvPgogIDxwYXRoIG9wYWNpdHk9IjAuNSIgZD0iTTE0NCwxMjhIMTEybDE2LTMyTTMyLDMySDBMMTYsNjRtMzIsNjRIMTZMMzIsOTZNMTQ0LDBIMTEybDE2LDMyTTE2LDBILTE2TDAsMzJNNDgsNjRIMTZMMzIsOTZNODAsNjRINDhMNjQsOTZtNDgtMzJIODBMOTYsOTZNMTYsMTI4SC0xNkwwLDk2Ii8+CiAgPHBhdGggb3BhY2l0eT0iMC4zIiBkPSJNMzIsMzJIMEwxNiwwTTY0LDMySDMyTDQ4LDY0TTY0LDk2SDMybDE2LDMyTTk2LDMySDY0TDgwLDBtNDgsOTZIOTZsMTYsMzJtMzItNjRIMTEybDE2LTMyTTE2LDY0SC0xNkwwLDMyIi8+CiAgPHBhdGggb3BhY2l0eT0iMC4xIiBkPSJNNjQsOTZIMzJMNDgsNjRNOTYsOTZINjRMODAsNjQiLz48L2c+Cjwvc3ZnPgo=")}
.img_mouse{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTI4LDM2YTU1LjUsNTUuNSwwLDAsMSw1NS41LDU1LjV2NzNhNTUuNSw1NS41LDAsMCwxLTExMSwwdi03M0E1NS41LDU1LjUsMCwwLDEsMTI4LDM2WiIvPjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xMjcuNSw1MWE4LDgsMCwwLDEsOCw4VjgxYTgsOCwwLDAsMS0xNiwwVjU5QTgsOCwwLDAsMSwxMjcuNSw1MVptNTUsNTFINzMuNW01NCwwVjg5bTAtMzhWMzciLz48L3N2Zz4K");}
.img_touch{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTQyLjY2MSw0Ny4xMzJIMjEzLjMzOWExMCwxMCwwLDAsMSwxMCwxMFYxOTguODY4YTEwLDEwLDAsMCwxLTEwLDEwSDQyLjY2MWExMCwxMCwwLDAsMS0xMC0xMFY1Ny4xMzJBMTAsMTAsMCwwLDEsNDIuNjYxLDQ3LjEzMloiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTMzLDE2NkgyMjNtLTk1LDQyVjE2NyIvPgo8L3N2Zz4K")}
.scene{background-color:var(--cb);border-radius:12px;padding:4px;margin-top:4px;}
.dialog_element{padding:4px;font-size:12px;border-radius:6px;background-color:#fff;margin-bottom:4px;}
.dialog{margin-top:4px;padding:4px;border-radius:8px;background-color:var(--cw);}
.scene_bg{
	padding:4px 8px;
	border-radius:8px;
	background-color:#fff;
	background-size:cover;
	background-repeat:no-repeat;
	background-position:center;
	width:calc(100% - 16px);
	height:128px;
}
.element{padding:4px;border-radius:6px;font-size:12px;background-color:#fff;margin-bottom:4px;}
.choice_b{
	background-color:var(--cw);
	margin-bottom:8px;
	margin-top:8px;
	min-height:20px;
	text-align:center;
	padding:4px;
	border-radius:6px;
    font-size:12px;
}
#add_element{position:absolute;left:0;top:0;visibility:hidden;width:190px;}
#window_zone{height:100vh;width:100%;position:fixed;left:0;top:0;visibility:hidden;transition-duration:0.5s;z-index:10000;}
.window{
	position:absolute;
	top:50%;
	transform:translateX(-50%) translateY(-50%);
	left:50%;
	background-color:#fff;
	border-radius:16px;
	box-shadow:0px 2px 24px var(--cs);
}
.button{border-radius:8px;width:100%;height:90%;background-color:var(--cw);}
.button:hover{background-color:var(--cb);}
.big_button{border-radius:20px;height:40px;background-color:var(--cw);cursor:pointer;}
.big_button:hover{background-color:var(--cb);}
.big_button2{border-radius:20px;height:40px;background-color:#fff;box-shadow:0px 2px 24px var(--cs);cursor:pointer;}
.big_button2:hover{background-color:var(--cb);}
.big_button3{border-radius:16px;height:32px;background-color:var(--cw);cursor:pointer;}
.big_button3:hover{background-color:var(--cb);}
.big_button3b{background-color:var(--cw);}
#search_block{
	height:40px;
	border-left:1px solid var(--cb);
	border-right:1px solid var(--cb);
	width:88px;
	padding-left:8px;
    -webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;
}
.add_button{height:28px;width:28px;}
.input_text_b{
	border:0;
	font-family:Arial;
	font-size:12px;
	-webkit-appearance:none;
	background-color:transparent;
	cursor:text;
	height:20px;
	width:100%;
	-webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;
}
.input_text{
	border:0;
	font-family:Arial;
	font-size:12px;
	-webkit-appearance:none;
	border-bottom:1px solid var(--cb);
	background-color:transparent;
	cursor:text;
	height:28px;
	width:100%;
	-webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;
}
.input_slider{-webkit-appearance:none;height:8px;background: var(--cw);outline:none;border-radius:8px;}
.input_slider::-webkit-slider-thumb {-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:var(--cb);cursor:pointer;border:3px solid #fff;}
.input_slider::-moz-range-thumb {-moz-appearance:none;appearance:none;width:16px;height:16px;border-radius:50%;background:var(--cb);cursor:pointer;border:3px solid #fff;}
input[type="text"]{text-indent:4px;}
select{text-align-last:center;}
.input_text:focus{border-bottom:1px solid #000;}
hr{border-top:1px solid var(--cb);margin:4px 0px;}
.checkbox_a{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTEyIi8+DQo8L3N2Zz4=");background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;height:16px;width:16px;cursor:pointer;}
.checkbox_a:checked {content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij4NCiAgPGNpcmNsZSBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY3g9IjEyOCIgY3k9IjEyOCIgcj0iMTEyIi8+DQogIDxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjE4IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTk0LDgybC04Niw4Nkw2MSwxMjQiLz4NCjwvc3ZnPg==");}
.checkbox_b{height:22px;width:24px;content:none;background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;}
.checkbox_b:checked {content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgLTggMjU2IDI1NiI+CiAgPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTgiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xODgsODQgMTE0LDE2NiA2NywxMjIiLz4KPC9zdmc+");}
.color_select{border-radius:16px;text-align:center;}
.set_button{height:40px;border-right:1px solid var(--cb);padding:0px 8px;background-color:var(--cw);}
.set_select{background-color:var(--cb);}
.set_blank{overflow-x:hidden;position:absolute;overflow-y:auto;width:100%;height:60vh;}
.window_close{position:absolute;right:0px;top:0px;height:40px;width:40px;cursor:pointer;}
.namber{padding-left:8px;font-size:12px;color:#999;}
.add_el{height:40px;background-color:#fff;}
.add_el:hover{background-color:var(--cb);}
.text_tutorials_a{font-size:12px;text-align:left;background-color:var(--cw);padding:8px;color:#999;}
.text_tutorials_b{font-size:12px;text-align:left;padding-top:4px;color:#999;}
.select_tutorials{-webkit-touch-callout:text;-webkit-user-select:text;-khtml-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;}
.chec_bg{border:2px solid var(--cw); border-radius:8px;background-color:var(--cb);height:68px;width:68px;content:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;}
.chec_bg:checked{background-color:var(--cw); border:2px solid var(--cb);}
#scene_maker{height:100vh;width:100%;position:fixed;left:0px;top:0px;display:none;}
#scene_canvas{height:calc(100vh - 40px);width:calc(98vh - 40px);position:relative;}
@media only screen and (max-width: 120vh){#scene_canvas{height:72vw;width:72vw;}}
#scene_layout{
    overflow:hidden;
    height:100%;
    width:50%;
    background-color:#000;
    position:absolute;
    top:50%;left:50%;
    transform:translateX(-50%) translateY(-50%);
    border-radius:8px;
    background-color:#fff;
    background-size:cover;
    background-repeat:no-repeat;
    background-position:center;
    box-shadow:0px 2px 24px var(--cs);
}
.set_title{background-color:var(--cb);cursor:pointer;}
.input_color{cursor:pointer;border: none;height:100%;width:100%;opacity: 0;}
.show_color{background-color:var(--cb);border-radius:50%;width:26px;height:26px;}
#resizers{box-sizing:border-box;width:100px;height:100px;position:absolute;top:100px;left:100px;cursor: move;border: 2px dashed var(--cb);}
.resizer{width:10px;height:10px;border-radius:50%;background:#fff;border: 2px solid var(--cb);position:absolute;z-index:4000;}
.top-left{left:-8px;top:-8px;cursor:nwse-resize;}
.top-right{right:-8px;top:-8px;cursor:nesw-resize;}
.bottom-left{left:-8px;bottom:-8px;cursor:nesw-resize;}
.bottom-right{right:-8px;bottom:-8px;cursor:nwse-resize;}
.size-right{right:-8px;top:50%;cursor:ew-resize;transform:translateY(-50%);}
.size-top{left:50%;top:-8px;cursor:ns-resize;transform:translateX(-50%);}
.size-left{left:-8px;top:50%;cursor:ew-resize;transform:translateY(-50%);}
.size-bottom{left:50%;bottom:-8px;cursor:ns-resize;transform:translateX(-50%);}
.proportion_c{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgNTEyIj4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgIGQ9Ik0xMjgsMTg4YTEyLDEyLDAsMCwxLDEyLDEydjMyYTEyLDEyLDAsMCwxLTI0LDBWMjAwQTEyLDEyLDAsMCwxLDEyOCwxODhaIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjgiIHN0cm9rZS1saW5lam9pbj0icm91bmQiICBkPSJNMTI4LDI2OGExMiwxMiwwLDAsMSwxMiwxMnYzMmExMiwxMiwwLDAsMS0yNCwwVjI4MEExMiwxMiwwLDAsMSwxMjgsMjY4WiIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI4IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiAgZD0iTTEyOCwyODNWMjMyIi8+Cjwvc3ZnPgo=");height:64px;width:32px;background:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;}
.proportion_c:checked{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCAyNTYgNTEyIj4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTEyOCwzNTUuNVYzOThhMzAsMzAsMCwwLDEtMzAsMzBILTZNLTYsODVIOThhMzAsMzAsMCwwLDEsMzAsMzB2NDIuNSIvPgo8cGF0aCBmaWxsPSJub25lIiBmaWxsLW9wYWNpdHk9IjAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSI4IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiAgZD0iTTEyOCwxODhhMTIsMTIsMCwwLDEsMTIsMTJ2MzJhMTIsMTIsMCwwLDEtMjQsMFYyMDBBMTIsMTIsMCwwLDEsMTI4LDE4OFoiLz4KPHBhdGggZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSIwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgIGQ9Ik0xMjgsMjY4YTEyLDEyLDAsMCwxLDEyLDEydjMyYTEyLDEyLDAsMCwxLTI0LDBWMjgwQTEyLDEyLDAsMCwxLDEyOCwyNjhaIi8+CjxwYXRoIGZpbGw9Im5vbmUiIGZpbGwtb3BhY2l0eT0iMCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjgiIHN0cm9rZS1saW5lam9pbj0icm91bmQiICBkPSJNMTI4LDI4M1YyMzIiLz4KPC9zdmc+Cg==");}
</style>
</head>
<body onload="world_size();" style='background-color:var(--cw); font-size:12px;'>
    <input type="file" id="json_file" style="display:none; position:fixed;" multiple webkitdirectory/>
    <input type="color" id="paletr" style="position:fixed; visibility:hidden;" name="paletr">
	<div id="menu_panel">
		<table  width="100%" height="100%">
			<tbody>
				<tr>
					<td align='center' title='New project' onclick='new_project();add_element.style.visibility="hidden";' class='icon button_menu icon_new'></td>
                    <td align='center' title='Load project folder ' onclick='load_new=false;json_file.click();add_element.style.visibility="hidden";' class='icon button_menu icon_load'></td>
					<td align='center' title='Save JSON script project' onclick='save_file();add_element.style.visibility="hidden";' class='icon button_menu icon_save'></td>
					<td align='center' title='Settings project' onclick='setup();add_element.style.visibility="hidden";' class='icon button_menu icon_setup'></td>
                    <td align='center' title='Edit json text' onclick='jsonedit();add_element.style.visibility="hidden";' class='icon button_menu icon_json'></td>
                    <td align='center' title='Export all text to CSV file' onclick='csv_export();add_element.style.visibility="hidden";' class='icon button_menu icon_csv'></td>
                    <td align='center' title='About visual editor' onclick='about();add_element.style.visibility="hidden";' class='icon button_menu icon_about'></td>
                    <td align='center' style='width:88px;'><input type="text" id="search_block" onkeyup="search_block()" placeholder="search block"></td>
                    <td align='center' style='width:40px;'><select class='input_text' id='language_view' style='height:40px; border-right:1px solid var(--cb); border-bottom:0'><option value='en'>EN</option></select></td>
					<td align='center' title='Build project' onclick='build();add_element.style.visibility="hidden";' class='icon button_menu icon_build'></td>
					<td align='center' style='border-radius:0 0 16px 0;' title='Run preview Project' onclick='play_novel();add_element.style.visibility="hidden";' class='icon button_menu icon_play'></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div id="new_story_block">
        <table height="100%">
        <tbody>
            <tr>
                <td class='button_menu' style='border-radius:20px 0 0 20px; border-right:1px solid var(--cb);'><table onclick='new_block()' height="100%"><tbody><tr><td width='42px' class='icon icon_add'></td><td align='center'>Add story block</td><td width='16px'></td></tr></tbody></table></td>
                <td width="42px" class='icon button_menu icon_equal' onclick='world_scale(2)'></td>
                <td width="42px" class='icon button_menu icon_scale' onclick='world_scale(1)'></td>
                <td width="42px" class='icon button_menu icon_minus' onclick='world_scale(false)' style='border-radius:0 20px 20px 0;'></td>
            </tr>
        </tbody>
        </table>
	</div>
	<a id="downloadAnchorElem" style="display:none;position:fixed;"></a>
    <div id='world'>
	<svg id="story_lines" xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"></svg>
	<div id="story_blocks"></div>
    </div>
    <!--scene_maker-->
    <div id='scene_maker'>
        <table style="height:100vh;width:100%;">
            <tbody>
                <tr><td rowspan="3">
                    <div id='scene_view' style='width:calc(100vw - 286px);height:100vh;overflow:auto;box-sizing: border-box;' align='center'>
                        <div id='screen_preview' style='transform-origin:0 0;min-width:100%;min-height:100%;padding-top:40px;display:flex;justify-content:center;align-items:center;' onmouseup="window.getSelection().removeAllRanges();">
                            <div id='scene_canvas'><div id='scene_layout'>
                                <div id='resizers' style='visibility:hidden;'>
                                    <div class='resizer size-right'></div>
                                    <div class='resizer top-right'></div>
                                    <div class='resizer size-top'></div>
                                    <div class='resizer top-left'></div>
                                    <div class='resizer size-left'></div>
                                    <div class='resizer bottom-left'></div>
                                    <div class='resizer size-bottom'></div>
                                    <div class='resizer bottom-right'></div>
                                </div>
                            <table id="tue_text_block" align="center">
                                <tbody>
                                   <tr>
                                        <td id="tue_text_element" style="position:relative;" valign='top'>
                                            <div id="tue_text_view" ></div>
                                            <div id="tue_name_block"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div></div>
                        </div>
                    </div>
                    <div id="scene_controll" style="right:320px;">
                        <table height="100%">
                        <tbody>
                            <tr>
                                <td width="42px" class='icon button_menu icon_right' onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_editor(scen_data[0],scen_data[1],scen_data[2]-1);scen_edit_data();' style='border-radius:20px 0 0 20px;'></td>
                                <td width="42px" class='icon button_menu icon_go'    onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_editor(scen_data[0],scen_data[1],scen_data[2]+1);scen_edit_data();' style='border-right:1px solid var(--cb);'></td>
                                <td width="42px" class='icon button_menu icon_equal' onclick='world_scale(2)'></td>
                                <td width="42px" class='icon button_menu icon_scale' onclick='world_scale(1)'></td>
                                <td width="42px" class='icon button_menu icon_minus' onclick='world_scale(false)' style='border-radius:0 20px 20px 0;'></td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                </td>
                    <td id='scrnr_title' height="40px" align='center' style="background-color:#fff;width:286px;" class='namber'>block name (scene:1 | dialog:1)</td></tr>
                <tr>
                    <td style="background-color:#fff; border-bottom:1px solid var(--cb); border-top:1px solid var(--cb);"><div style='height:calc(100vh - 80px);overflow-x:hidden;overflow-y:auto;'>
                        <table onclick="block_open('set_preview');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Preview</td></tr></tbody></table>
                        <div class="set_panel" id="set_preview" style="width:100%; display:block;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%; padding-right:8px;'>Orientation</td><td style='padding-right:8px;'>
                                <select id='ratio_screen' class='input_text' oninput='setup_editor.preview[1]=this.selectedIndex;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));preview_size()' style='width:100%;'>
                                      <option value=true>landscape</option>
                                      <option value=false>Portrait</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Size</td><td style='padding-right:8px;'>
                               <select id='screen_size' class='input_text' oninput='preview_size();' style='width:100%;'>
                                    <option value="0">My screen</option>
                                    <option value="1080">1080</option>
                                    <option value="720">720</option>
                                    <option value="480">480</option>
                                    <option value="360">360</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Screen</td><td style='padding-right:8px;'>
                               <select class='input_text' oninput='p_width.value=this.value;setup_editor.preview[0]=this.value;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));preview_size();' style='width:100%;'>
                                    <option value="100">1:1</option>
                                    <option value="75">4:3</option>
                                    <option value="56">16:9</option>
                                </select>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Ratio</td><td style='padding-right:8px;'>
                                <input id='p_width' class='input_slider' onchange='setup_editor.preview[0]=this.value;localStorage.setItem("editor_setup",JSON.stringify(setup_editor));' oninput='preview_size()' type="range" value='100' min="50" max="100" style='width:100%;'>
                            </td></tr>
                        </tbody></table></div>
                        <table onclick="block_open('text_panel_g');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Text panel (global)</td></tr></tbody></table>
                        <div class="set_panel" id="text_panel_g" style="width:100%; display:none;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%; padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_w' class='input_text' onchange='scen_edit_updare(true)' type="text" value='95%' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_h' class='input_text' onchange='scen_edit_updare(true)' type="text" value='25%' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='3'>
                                <input id='style' class='input_text' onchange='scen_edit_updare(true)' type="text" value='' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color panel</td><td style='width:40px;' align='center'><div class='show_color' id='color_t_s'></div></td><td style='padding-right:8px;'>
                                <input id='color_t' class='input_text' onchange='color_t_b.value=this.value;color_t_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='color_t_b' type="color" name="paletr" class='input_color' oninput='color_t.value=this.value;color_t_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color text</td><td style='width:40px;' align='center'><div class='show_color' id='color_text_s'></div></td><td style='padding-right:8px;'>
                                <input id='color_text' class='input_text' onchange='color_text_b.value=this.value;color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='color_text_b' type="color" name="paletr" class='input_color' oninput='color_text.value=this.value;color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='size_text' class='input_text' onchange='scen_edit_updare(true)' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font family</td><td style='padding-right:8px;' colspan='3'>
                                <input id='font_family' class='input_text' onchange='scen_edit_updare(true)' type="text" value='20px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Class name</td><td style='padding-right:8px;' colspan='3'>
                                <input id='className' class='input_text' onchange='scen_edit_updare(true)' type="text" value='100' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Dialog speed</td><td style='padding-right:8px;' colspan='3'>
                                <input id='dialog_speed' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Top position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_t' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Left position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_l' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Bottom position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='indent_bottom' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Right position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='position_r' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Indent text</td><td style='padding-right:8px;' colspan='3'>
                                <input id='indent_text' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                        </tbody></table>
                        </div>
                        <table onclick="block_open('name_panel_g');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Name panel (global)</td></tr></tbody></table>
                        <div class="set_panel" id="name_panel_g" style="width:100%; display:none;">
                        <table style="width:100%;"><tbody>
                            <tr><td height='40px' align='right' style='width:40%; padding-right:8px;'>Width size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_w' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Height size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_h' class='input_text' onchange='scen_edit_updare(true)' type="text" value='48px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Style CSS</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_style' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color panel</td><td style='width:40px;' align='center'><div class='show_color' id='n_color_s'></div></td><td style='padding-right:8px;'>
                                <input id='n_color' class='input_text' onchange='n_color_b.value=this.value;n_color_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='n_color_b' type="color" name="paletr" class='input_color' oninput='n_color.value=this.value;n_color_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Color text</td><td style='width:40px;' align='center'><div class='show_color' id='n_color_text_s'></div></td><td style='padding-right:8px;'>
                                <input id='n_color_text' class='input_text' onchange='n_color_text_b.value=this.value;n_color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);' type="text" style='width:100%;'>
                            </td><td height='40px' align='right' style='width:40px;' class='icon icon_color'>
                                <input id='n_color_text_b' type="color" name="paletr" class='input_color' oninput='n_color_text.value=this.value;n_color_text_s.style.backgroundColor=this.value;scen_edit_updare(true);'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Font size</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_size_text' class='input_text' onchange='scen_edit_updare(true)' type="text" value='18px' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Class name</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_className' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Top position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_t' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Left position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_l' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Bottom position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_b' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Right position</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_position_r' class='input_text' onchange='scen_edit_updare(true)' type="text" value='0' style='width:100%;'>
                            </td></tr>
                            <tr><td height='40px' align='right' style='padding-right:8px;'>Indent text</td><td style='padding-right:8px;' colspan='3'>
                                <input id='n_indent_text' class='input_text' onchange='scen_edit_updare(true)' type="text" style='width:100%;'>
                            </td></tr>
                        </tbody></table>
                        </div>
                        <table onclick="block_open('interface_buttons');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Interface buttons (global)</td></tr></tbody></table>
                        <div class="interface_buttons" id="interface_buttons" style="width:100%; display:none;"><div id='interface_buttons_c'></div>
                            <div style='width:100%;margin-bottom:16px;' onclick='interface_buttons_c.innerHTML+=button_panel_edit(-1);button_panel_update();' align='center'><div id='add_scen_items' class='add_button icon_m icon_add'></div></div>
                        </div>
                        <table onclick="block_open('set_scene');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Scene content</td></tr></tbody></table>
                        <div class="set_panel" id="set_scene" style="width:100%; display:none;">
                            <table style="width:100%;"><tbody>
                                <tr><td height='60px' align='center' valign='center'>
                                    <table class='big_button' width='90%' id='s_scene_edit'><tbody><tr><td width='42px' class='icon icon_setup'></td><td align='center'>Scene edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr>
                                <tr><td height='60px' align='center' valign='center'>
                                    <table class='big_button' width='90%' id='s_scene_text'><tbody><tr><td width='42px' class='icon icon_edit2'></td><td align='center'>Text edit</td><td width='42px'></td></tr></tbody></table>
                                </td></tr>
                            </tbody></table>
                        </div>
                        <table onclick="block_open('arts_e');" class="set_title" height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Arts</td></tr></tbody></table>
                        <div class="set_panel" id="arts_e" style="width:100%; display:block;"><div id='arts_ec'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_art' class='add_button icon_m icon_add'></div></div>
                        </div>
                        <table onclick="block_open('choice_e');" class="set_title"  height='40px' width='100%'><tbody><tr><td width='40px' class='icon_m icon_more'></td><td align='left' valign='center'>Buttons & Сhoice</td></tr></tbody></table>
                        <div class="set_panel" id="choice_e" style="width:100%; display:block;"><div id='choice_ec'></div>
                            <div style='width:100%;margin-bottom:16px;' align='center'><div id='add_choice' class='add_button icon_m icon_add'></div></div>
                        </div>
                    </div></td>
                </tr>
                <tr>
                    <td height="40px" align='center' style="background-color:#fff;" class='button_menu'><table class='button_menu' width='100%' height="100%" onclick='scen_compres(scen_data[0],scen_data[1],scen_data[2]);scen_edit_updare(false);'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Back</td><td width='42px'></td></tr></tbody></table></td>
                </tr>
            </tbody>
        </table>
    </div>
    <!--scene_maker-->
	<div id='window_zone' align='center'></div>
    <div id='add_element' align='center' style='z-index:10001;'></div>
    <div id="toast">
        <table border="0" height="100%" width="100%">
            <tbody>
                <tr>
                    <td align="center" valign="center" >
                        <div id="toast_message"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
<script>
function set_ui(t){
    var r = document.querySelector(':root');
    r.style.setProperty('--cb', color_ui[t][0]);
    r.style.setProperty('--cw', color_ui[t][1]);
    r.style.setProperty('--cs', color_ui[t][2]);
    r.style.setProperty('--cf', color_ui[t][3]);
    r.style.setProperty('--cm', color_ui[t][4]);
}
let color_ui=[
    ['#cec8e3','#efefff','rgba(110,95,165,0.25)','rgba(90,75,145,1)','rgba(110,95,165,0.5)'],
    ['#a3cdf0','#dff1ff','rgba(83,150,204,0.25)','#fff','rgba(134,161,183,0.5)'],
    ['#bbb','#eee','rgba(0,0,0,0.25)','#fff','rgba(0,0,0,0.25)'],
    ['#bdd3a5','#dfebd5','rgba(109,124,91,0.25)','#fff','rgba(109,124,91,0.5)'],
    ['#edb740','#e4d7ba','rgba(0,0,0,0.25)','#fff','rgba(0,0,0,0.25)']
]
var body=document.body,html=document.documentElement;
var all_blocks=document.getElementsByClassName("story_block");
var story_lines=document.getElementById("story_lines");
var menu_add=document.getElementById('add_element');
let story_script={};
let line_controll=[];
var img_file=document.getElementById('json_file');
var color_chois=document.getElementById('paletr');
var runtime="let story_json=new Array;var tue_text_view,tue_text_block,tue_text_element,languare,dialog_text,dialog_timeout,tue_story,tue_bg_music,tuesday=document.getElementById(\"tuesday\"),tue_name_block=document.createElement(\"div\"),scene=0,dialog=0,dialog_speed=50,dialog_letter=0,tue_fullScreen=!1;function cmenu(){return!1}function get_lang(){var e;languare=null!=navigator.languages?navigator.languages[0].substring(0,2):navigator.languagesubstring(0,2);for(var t=0;t<story_json.parameters.languares.length;t++)languare==story_json.parameters.languares[t]&&(e=!0);e||(languare=story_json.parameters.languares[0])}function load_story(e,t){if(\"data\"==e)story_json=t,base_creation(),tuesday.dispatchEvent(new Event(\"script_loaded\")),creation_sound();else if(\"file\"==e){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==this.readyState&&(200==this.status||0==this.status)){try{story_json=JSON.parse(this.responseText)}catch(e){this.status>0&&alert(\"Json structure error\")}base_creation(),tuesday.dispatchEvent(new Event(\"script_loaded\")),creation_sound()}},s.open(\"GET\",t,!0),s.send(),s.onerror=function(){0==this.status&&alert(\"Error load json file Cross-Origin Resource Sharing(CORS)\")}}}function base_creation(){if(get_lang(),story_json.parameters.style_file&&add_style(story_json.parameters.style_file),dialog_speed=story_json.parameters.text_panel.dialog_speed,story_json.parameters.title&&(story_json.parameters.title[languare]?document.title=story_json.parameters.title[languare]:document.title=story_json.parameters.title),tuesday.style.backgroundRepeat=\"no-repeat\",tuesday.style.backgroundSize=\"cover\",tuesday.style.backgroundPosition=\"center\",tuesday.style.position=\"relative\",tuesday.style.overflow=\"hidden\",tuesday.innerHTML=\"<table id='tue_text_block' align='center'><tbody><tr><td id='tue_text_element'><div id='tue_text_view'></div></td></tr></tbody></table>\",tue_text_block=document.getElementById(\"tue_text_block\"),(tue_text_element=document.getElementById(\"tue_text_element\")).style.position=\"relative\",story_json.parameters.text_panel.className&&(tue_text_block.className=story_json.parameters.text_panel.className),story_json.parameters.text_panel.style&&(tue_text_block.style=story_json.parameters.text_panel.style),tue_text_block.style.position=\"absolute\",story_json.parameters.text_panel.size&&(tue_text_block.style.width=story_json.parameters.text_panel.size[0],tue_text_block.style.height=story_json.parameters.text_panel.size[1]),story_json.parameters.text_panel.position?(tue_text_block.style.left=0!=story_json.parameters.text_panel.position[0]?story_json.parameters.text_panel.position[0]:\"0\",tue_text_block.style.right=0!=story_json.parameters.text_panel.position[1]?story_json.parameters.text_panel.position[1]:\"0\",0!=story_json.parameters.text_panel.position[2]&&(tue_text_block.style.top=story_json.parameters.text_panel.position[2]),0!=story_json.parameters.text_panel.position[3]&&(tue_text_block.style.bottom=story_json.parameters.text_panel.position[3])):(tue_text_block.style.left=\"0\",tue_text_block.style.right=\"0\"),story_json.parameters.text_panel.indent_bottom&&(tue_text_block.style.bottom=story_json.parameters.text_panel.indent_bottom),tue_text_block.style.zIndex=\"1000\",tue_text_block.style.borderSpacing=\"0\",(tue_text_view=document.getElementById(\"tue_text_view\")).style.padding=story_json.parameters.text_panel.indent_text,tue_text_view.style.fontSize=story_json.parameters.text_panel.size_text,tue_text_view.style.height=\"100%\",story_json.parameters.name_panel&&(story_json.parameters.name_panel.className&&(tue_name_block.className=story_json.parameters.name_panel.className),story_json.parameters.name_panel.style&&(tue_name_block.style=story_json.parameters.name_panel.style),story_json.parameters.name_panel.color&&(tue_name_block.style.backgroundColor=story_json.parameters.name_panel.color),story_json.parameters.name_panel.color_text?tue_name_block.style.color=story_json.parameters.name_panel.color_text:tue_name_block.style.color=story_json.parameters.text_panel.color_text,tue_name_block.style.position=\"absolute\",tue_name_block.id=\"tue_name_block\",tue_name_block.style.padding=story_json.parameters.name_panel.indent_text,tue_name_block.style.fontSize=story_json.parameters.name_panel.size_text,tue_name_block.style.textAlign=\"center\",(tue_name_block.style.width=0!=story_json.parameters.name_panel.size[0])&&(tue_name_block.style.width=story_json.parameters.name_panel.size[0]),tue_name_block.style.height=story_json.parameters.name_panel.size[1],tue_name_block.style.lineHeight=story_json.parameters.name_panel.size[1],0!=story_json.parameters.name_panel.position[0]&&(tue_name_block.style.left=story_json.parameters.name_panel.position[0]),0!=story_json.parameters.name_panel.position[1]&&(tue_name_block.style.right=story_json.parameters.name_panel.position[1]),0!=story_json.parameters.name_panel.position[2]&&(tue_name_block.style.top=story_json.parameters.name_panel.position[2]),0!=story_json.parameters.name_panel.position[3]&&(tue_name_block.style.bottom=story_json.parameters.name_panel.position[3]),tue_name_block.style.zIndex=1001,tue_text_element.appendChild(tue_name_block)),(tue_bg_music=document.createElement(\"AUDIO\")).id=\"tue_bg_music\",tuesday.appendChild(tue_bg_music),story_json.parameters.launch_story)tue_story=story_json.parameters.launch_story;else for(var e=0;e<2;e++)if(\"parameters\"!=Object.getOwnPropertyNames(story_json)[e]){story_json.parameters.launch_story=Object.getOwnPropertyNames(story_json)[1],tue_story=story_json.parameters.launch_story;break}tuesday.dispatchEvent(new Event(\"script_executed\")),localStorage.getItem(story_json.parameters.autosave)&&(story_json.parameters.variables=JSON.parse(localStorage.getItem(\"tue_auto_data\"))),creation_buttons(),creation_scene()}function creation_buttons(){for(i=0;i<story_json.parameters.buttons.length;i++){var e=document.createElement(\"div\");story_json.parameters.buttons[i].sound&&e.setAttribute(\"onclick\",story_json.parameters.buttons[i].sound?get_sound(story_json.parameters.buttons[i].sound):\"\"+story_json.parameters.buttons[i].sound_stop?get_stop_sound(story_json.parameters.buttons[i].sound_stop):\"\"),story_json.parameters.buttons[i].className&&(e.className=story_json.parameters.buttons[i].className),story_json.parameters.buttons[i].style&&(e.style=story_json.parameters.buttons[i].style),story_json.parameters.buttons[i].text&&(\"object\"!=typeof story_json.parameters.buttons[i].text||story_json.parameters.buttons[i].text[languare]&&\"object\"!=typeof story_json.parameters.buttons[i].text[languare])&&(e.innerHTML=story_json.parameters.buttons[i].text[languare]?story_json.parameters.buttons[i].text[languare]:story_json.parameters.buttons[i].text,e.style.padding=story_json.parameters.buttons[i].indent_text,e.style.textAlign=\"center\",e.style.color=story_json.parameters.buttons[i].color_text,e.style.fontSize=story_json.parameters.buttons[i].size_text),e.style.zIndex=2e3+i,e.id=story_json.parameters.buttons[i].name,e.classList.add(\"tue_controll\"),e.style.position=\"absolute\",e.style.width=story_json.parameters.buttons[i].size[0],e.style.height=story_json.parameters.buttons[i].size[1],e.style.backgroundColor=story_json.parameters.buttons[i].color,e.style.backgroundRepeat=\"no-repeat\",e.style.backgroundPosition=\"center\",story_json.parameters.buttons[i].art&&(e.style.backgroundImage=\"url('\"+(story_json.parameters.buttons[i].art[languare]?story_json.parameters.buttons[i].art[languare]:story_json.parameters.buttons[i].art)+\"')\"),story_json.parameters.buttons[i].art_size&&(e.style.backgroundSize=story_json.parameters.buttons[i].art_size[0]+\" \"+story_json.parameters.buttons[i].art_size[1]),0!=story_json.parameters.buttons[i].position[0]&&(e.style.left=story_json.parameters.buttons[i].position[0]),0!=story_json.parameters.buttons[i].position[1]&&(e.style.right=story_json.parameters.buttons[i].position[1]),0!=story_json.parameters.buttons[i].position[2]&&(e.style.top=story_json.parameters.buttons[i].position[2]),0!=story_json.parameters.buttons[i].position[3]&&(e.style.bottom=story_json.parameters.buttons[i].position[3]),tuesday.appendChild(e)}if(document.getElementById(\"tue_next\")&&document.getElementById(\"tue_next\").addEventListener(\"click\",function(){go_story()}),document.getElementById(\"tue_back\")&&document.getElementById(\"tue_back\").addEventListener(\"click\",function(){back_story()}),document.getElementById(\"tue_home\")){var t=story_json.parameters.launch_story;document.getElementById(\"tue_home\").addEventListener(\"click\",function(){go_to(t)})}document.getElementById(\"tue_save\")&&document.getElementById(\"tue_save\").addEventListener(\"click\",function(){save_stag(\"bookmark\")}),document.getElementById(\"tue_load\")&&document.getElementById(\"tue_load\").addEventListener(\"click\",function(){load_stag(\"bookmark\")}),document.getElementById(\"tue_fullScreen\")&&document.getElementById(\"tue_fullScreen\").addEventListener(\"click\",function(){full_screen()})}function creation_scene(){if(del_element(\"tue_html_scene\"),story_json[tue_story][scene].legacy_choice)for(var e=0;e<story_json[tue_story][scene].legacy_choice.length;e++){var t=story_json[tue_story][scene].legacy_choice[e][0],s=story_json[tue_story][scene].legacy_choice[e][1],o=story_json[tue_story][scene].legacy_choice[e][2],a=story_json[tue_story][scene].legacy_choice[e][3];if(\">\"==s&&story_json.parameters.variables[t]>o){go_to(a);break}if(\"<\"==s&&story_json.parameters.variables[t]<o){go_to(a);break}if(\"=\"==s&&story_json.parameters.variables[t]==o){go_to(a);break}if(story_json[tue_story][scene].legacy_choice[e].go_to){go_to(story_json[tue_story][scene].legacy_choice[e].go_to);break}e==story_json[tue_story][scene].legacy_choice.length-1&&(scene++,dialog=0,creation_scene())}var n;(story_json[tue_story][scene].background_class?tuesday.className=story_json[tue_story][scene].background_class:tuesday.className=\"\",story_json[tue_story][scene].background_color&&(tuesday.style.backgroundColor=story_json[tue_story][scene].background_color),story_json[tue_story][scene].background_image&&(story_json[tue_story][scene].background_image[languare]?tuesday.style.backgroundImage=\"url('\"+story_json[tue_story][scene].background_image[languare]+\"')\":tuesday.style.backgroundImage=\"url('\"+story_json[tue_story][scene].background_image+\"')\"),document.getElementById(\"tue_home\")&&(tue_story==story_json.parameters.launch_story?document.getElementById(\"tue_home\").style.visibility=\"hidden\":document.getElementById(\"tue_home\").style.visibility=\"visible\"),story_json[tue_story][scene].html)&&(story_json[tue_story][scene].html[languare]?((n=document.createElement(\"div\")).className=\"tue_html_scene\",n.innerHTML=story_json[tue_story][scene].html[languare],tuesday.appendChild(n)):((n=document.createElement(\"div\")).className=\"tue_html_scene\",n.innerHTML=story_json[tue_story][scene].html,tuesday.appendChild(n)));creation_dialog(),story_json[tue_story][scene].background_music&&search_music()}function creation_dialog(){if(scene!=story_json[tue_story].length-1||dialog!=story_json[tue_story][scene].dialogs.length-1||story_json[tue_story][scene].dialogs[dialog].go_to?document.getElementById(\"tue_next\").style.visibility=\"visible\":document.getElementById(\"tue_next\").style.visibility=\"hidden\",0!=scene||0!=dialog||story_json[tue_story][scene].dialogs[dialog].back_to?document.getElementById(\"tue_back\").style.visibility=\"visible\":document.getElementById(\"tue_back\").style.visibility=\"hidden\",\"hidden\"==story_json[tue_story][scene].dialogs[dialog].controll)for(var e=document.getElementById(\"tuesday\").getElementsByClassName(\"tue_controll\"),t=0;t<e.length;t++)e[t].style.visibility=\"hidden\";else if(\"visible\"==story_json[tue_story][scene].dialogs[dialog].controll)for(e=document.getElementById(\"tuesday\").getElementsByClassName(\"tue_controll\"),t=0;t<e.length;t++)e[t].style.visibility=\"visible\";if(story_json[tue_story][scene].dialogs[dialog].text?(tue_text_block.style.visibility=\"visible\",tue_text_view.innerHTML=\"\",values_in_text(!1),clearTimeout(dialog_timeout),anim_text(),story_json[tue_story][scene].dialogs[dialog].text.className&&(tue_text_block.className=story_json[tue_story][scene].dialogs[dialog].text.className),story_json[tue_story][scene].dialogs[dialog].text.style&&(tue_text_block.style=story_json[tue_story][scene].dialogs[dialog].text.style)):story_json[tue_story][scene].dialogs[dialog].text_add?(tue_text_block.style.visibility=\"visible\",tue_text_view.innerHTML=\"\",values_in_text(!0),clearTimeout(dialog_timeout),anim_text()):tue_text_block.style.visibility=\"hidden\",story_json[tue_story][scene].dialogs[dialog].color?tue_text_block.style.backgroundColor=story_json[tue_story][scene].dialogs[dialog].color:story_json.parameters.text_panel.color&&(tue_text_block.style.backgroundColor=story_json.parameters.text_panel.color),story_json[tue_story][scene].dialogs[dialog].color_text?tue_text_view.style.color=story_json[tue_story][scene].dialogs[dialog].color_text:story_json.parameters.text_panel.color_text&&(tue_text_view.style.color=story_json.parameters.text_panel.color_text),story_json[tue_story][scene].dialogs[dialog].name?(story_json[tue_story][scene].dialogs[dialog].name[languare]?(tue_name_block.innerHTML=story_json[tue_story][scene].dialogs[dialog].name[languare],tue_name_block.style.backgroundColor=story_json[tue_story][scene].dialogs[dialog].name.color,tue_name_block.style.color=story_json[tue_story][scene].dialogs[dialog].name.color_text,story_json[tue_story][scene].dialogs[dialog].name.className&&(tue_name_block.className=story_json[tue_story][scene].dialogs[dialog].name.className)):story_json.parameters.characters?story_json.parameters.characters[story_json[tue_story][scene].dialogs[dialog].name]?(tue_name_block.innerHTML=story_json.parameters.characters[story_json[tue_story][scene].dialogs[dialog].name][languare],tue_name_block.style.backgroundColor=story_json.parameters.characters[story_json[tue_story][scene].dialogs[dialog].name].color,tue_name_block.style.color=story_json.parameters.characters[story_json[tue_story][scene].dialogs[dialog].name].color_text,story_json.parameters.characters[story_json[tue_story][scene].dialogs[dialog].name].className&&(tue_name_block.className=story_json.parameters.characters[story_json[tue_story][scene].dialogs[dialog].name].className)):(tue_name_block.innerHTML=story_json[tue_story][scene].dialogs[dialog].name,tue_name_block.style.backgroundColor=story_json[tue_story][scene].dialogs[dialog].name.color,tue_name_block.style.color=story_json[tue_story][scene].dialogs[dialog].name.color_text,story_json[tue_story][scene].dialogs[dialog].name.className&&(tue_name_block.className=story_json[tue_story][scene].dialogs[dialog].name.className)):tue_name_block.innerHTML=story_json[tue_story][scene].dialogs[dialog].name,tue_name_block.style.visibility=\"visible\"):tue_name_block.style.visibility=\"hidden\",del_element(\"tue_art\"),story_json[tue_story][scene].dialogs[dialog].art)for(t=0;t<story_json[tue_story][scene].dialogs[dialog].art.length;t++){var s=document.createElement(\"img\");story_json[tue_story][scene].dialogs[dialog].art[t].url[languare]?s.src=story_json[tue_story][scene].dialogs[dialog].art[t].url[languare]:story_json[tue_story][scene].dialogs[dialog].art[t].url&&(s.src=story_json[tue_story][scene].dialogs[dialog].art[t].url),s.classList.add(\"tue_art\"),story_json[tue_story][scene].dialogs[dialog].art[t].style&&(s.style=story_json[tue_story][scene].dialogs[dialog].art[t].style),s.style.position=\"absolute\",story_json[tue_story][scene].dialogs[dialog].art[t].fit&&(s.style.objectFit=story_json[tue_story][scene].dialogs[dialog].art[t].fit),story_json[tue_story][scene].dialogs[dialog].art[t].size&&(s.style.width=story_json[tue_story][scene].dialogs[dialog].art[t].size[0],s.style.height=story_json[tue_story][scene].dialogs[dialog].art[t].size[1]),0!=story_json[tue_story][scene].dialogs[dialog].art[t].position[0]&&(s.style.left=story_json[tue_story][scene].dialogs[dialog].art[t].position[0]),0!=story_json[tue_story][scene].dialogs[dialog].art[t].position[1]&&(s.style.right=story_json[tue_story][scene].dialogs[dialog].art[t].position[1]),0!=story_json[tue_story][scene].dialogs[dialog].art[t].position[2]&&(s.style.top=story_json[tue_story][scene].dialogs[dialog].art[t].position[2]),0!=story_json[tue_story][scene].dialogs[dialog].art[t].position[3]&&(s.style.bottom=story_json[tue_story][scene].dialogs[dialog].art[t].position[3]),tuesday.appendChild(s)}if(story_json[tue_story][scene].dialogs[dialog].choice)for(tue_next.style.visibility=\"hidden\",t=0;t<story_json[tue_story][scene].dialogs[dialog].choice.length;t++){var o=document.createElement(\"div\");story_json[tue_story][scene].dialogs[dialog].choice[t].className&&(o.className=story_json[tue_story][scene].dialogs[dialog].choice[t].className),story_json[tue_story][scene].dialogs[dialog].choice[t].style&&(o.style=story_json[tue_story][scene].dialogs[dialog].choice[t].style),o.classList.add(\"tue_choice\"),o.style.position=\"absolute\",o.style.backgroundColor=story_json[tue_story][scene].dialogs[dialog].choice[t].color,o.style.backgroundRepeat=\"no-repeat\",o.style.backgroundPosition=\"center\",story_json[tue_story][scene].dialogs[dialog].choice[t].art&&(o.style.backgroundImage=\"url('\"+(story_json[tue_story][scene].dialogs[dialog].choice[t].art[languare]?story_json[tue_story][scene].dialogs[dialog].choice[t].art[languare]:story_json[tue_story][scene].dialogs[dialog].choice[t].art)+\"')\"),story_json[tue_story][scene].dialogs[dialog].choice[t].size&&(0!=story_json[tue_story][scene].dialogs[dialog].choice[t].size[0]&&(o.style.width=story_json[tue_story][scene].dialogs[dialog].choice[t].size[0]),0!=story_json[tue_story][scene].dialogs[dialog].choice[t].size[1]&&(o.style.height=story_json[tue_story][scene].dialogs[dialog].choice[t].size[1],o.style.lineHeight=story_json[tue_story][scene].dialogs[dialog].choice[t].size[1])),story_json[tue_story][scene].dialogs[dialog].choice[t].art_size&&(o.style.backgroundSize=story_json[tue_story][scene].dialogs[dialog].choice[t].art_size[0]+\" \"+story_json[tue_story][scene].dialogs[dialog].choice[t].art_size[1]),0!=story_json[tue_story][scene].dialogs[dialog].choice[t].position[0]&&(o.style.left=story_json[tue_story][scene].dialogs[dialog].choice[t].position[0]),0!=story_json[tue_story][scene].dialogs[dialog].choice[t].position[1]&&(o.style.right=story_json[tue_story][scene].dialogs[dialog].choice[t].position[1]),0!=story_json[tue_story][scene].dialogs[dialog].choice[t].position[2]&&(o.style.top=story_json[tue_story][scene].dialogs[dialog].choice[t].position[2]),0!=story_json[tue_story][scene].dialogs[dialog].choice[t].position[3]&&(o.style.bottom=story_json[tue_story][scene].dialogs[dialog].choice[t].position[3]),o.style.color=story_json[tue_story][scene].dialogs[dialog].choice[t].color_text,o.style.padding=story_json[tue_story][scene].dialogs[dialog].choice[t].indent_text,o.style.fontSize=story_json[tue_story][scene].dialogs[dialog].choice[t].size_text,o.style.textAlign=\"center\",o.style.zIndex=1001+t,story_json[tue_story][scene].dialogs[dialog].choice[t].text&&(\"object\"!=typeof story_json[tue_story][scene].dialogs[dialog].choice[t].text||story_json[tue_story][scene].dialogs[dialog].choice[t].text[languare]&&\"object\"!=typeof story_json[tue_story][scene].dialogs[dialog].choice[t].text[languare])&&(story_json[tue_story][scene].dialogs[dialog].choice[t].text[languare]?o.innerHTML=story_json[tue_story][scene].dialogs[dialog].choice[t].text[languare]:o.innerHTML=story_json[tue_story][scene].dialogs[dialog].choice[t].text);var a=\"\";if(story_json[tue_story][scene].dialogs[dialog].choice[t].variables)for(var n=0;n<story_json[tue_story][scene].dialogs[dialog].choice[t].variables.length;n++)\"add\"==story_json[tue_story][scene].dialogs[dialog].choice[t].variables[n][1]?a+=\"story_json.parameters.variables.\"+story_json[tue_story][scene].dialogs[dialog].choice[t].variables[n][0]+\" += \"+story_json[tue_story][scene].dialogs[dialog].choice[t].variables[n][2]+\";\":\"set\"==story_json[tue_story][scene].dialogs[dialog].choice[t].variables[n][1]&&(a+=\"story_json.parameters.variables.\"+story_json[tue_story][scene].dialogs[dialog].choice[t].variables[n][0]+\" = \"+story_json[tue_story][scene].dialogs[dialog].choice[t].variables[n][2]+\";\");if(story_json[tue_story][scene].dialogs[dialog].choice[t].go_to)\"tue_go\"==(n=story_json[tue_story][scene].dialogs[dialog].choice[t].go_to)?o.setAttribute(\"onclick\",\"del_element('tue_choice'); \"+a+\"go_story(true);\"+r()):\"tue_load_autosave\"==n?o.setAttribute(\"onclick\",\"load_stag('auto');\"+r()):\"load\"==n||\"tue_load\"==n?o.setAttribute(\"onclick\",\"load_stag('bookmark');\"+r()):\"tue_save\"==n?o.setAttribute(\"onclick\",\"save_stag('bookmark');\"+r()):\"tue_no\"==n||\"\"==n?o.setAttribute(\"onclick\",\"\"):\"tue_fullScreen\"==n?o.setAttribute(\"onclick\",\"full_screen();\"):\"tue_home\"==n?o.setAttribute(\"onclick\",'document.getElementById(\"tue_home\").addEventListener(\"click\",function(){go_to(\"'+story_json.parameters.launch_story+'\")});'):\"tue_back\"==n?o.setAttribute(\"onclick\",\"back_story();\"):\"tue_next\"==n?o.setAttribute(\"onclick\",\"go_story();\"):o.setAttribute(\"onclick\",a+\"go_to('\"+n+\"');\"+r());else o.setAttribute(\"onclick\",a+\"go_story(true);del_element('tue_choice');\"+r()),tuesday.appendChild(o);function r(){var e=\"\";return story_json[tue_story][scene].dialogs[dialog].choice[t].sound&&(e=get_sound(story_json[tue_story][scene].dialogs[dialog].choice[t].sound)),story_json[tue_story][scene].dialogs[dialog].choice[t].sound_stop&&(e+=get_stop_sound(story_json[tue_story][scene].dialogs[dialog].choice[t].sound_stop)),e}tuesday.appendChild(o)}var l,_;story_json[tue_story][scene].dialogs[dialog].html&&(story_json[tue_story][scene].dialogs[dialog].html[languare]?((l=document.createElement(\"div\")).className=\"tue_html_dialog\",l.innerHTML=story_json[tue_story][scene].dialogs[dialog].html[languare],tuesday.appendChild(l)):((l=document.createElement(\"div\")).className=\"tue_html_dialog\",l.innerHTML=story_json[tue_story][scene].dialogs[dialog].html,tuesday.appendChild(l)));if(story_json[tue_story][scene].dialogs[dialog].variables)for(t=0;t<story_json[tue_story][scene].dialogs[dialog].variables.length;t++){var i=story_json[tue_story][scene].dialogs[dialog].variables[t][0];\"add\"==story_json[tue_story][scene].dialogs[dialog].variables[t][1]?(story_json.parameters.variables[i]+=story_json[tue_story][scene].dialogs[dialog].variables[t][2],tuesday.dispatchEvent(new Event(story_json[tue_story][scene].dialogs[dialog].variables[t][0]+\"_add\"))):\"set\"==story_json[tue_story][scene].dialogs[dialog].variables[t][1]&&(story_json.parameters.variables[i]=story_json[tue_story][scene].dialogs[dialog].variables[t][2]),tuesday.dispatchEvent(new Event(story_json[tue_story][scene].dialogs[dialog].variables[t][0]+\"_set\"))}(story_json[tue_story][scene].dialogs[dialog].event&&tuesday.dispatchEvent(new Event(story_json[tue_story][scene].dialogs[dialog].event)),story_json[tue_story][scene].dialogs[dialog].sound_stop)&&sound_stop((_=story_json[tue_story][scene].dialogs[dialog].sound_stop)[languare]?_[languare]:_);story_json[tue_story][scene].dialogs[dialog].sound&&sound_play((_=story_json[tue_story][scene].dialogs[dialog].sound)[languare]?_[languare]:_);tuesday.dispatchEvent(new Event(\"creation_dialog\"))}function values_in_text(e){var t=\"\";e?(dialog_letter=dialog_text.length,t=dialog_text,t+=story_json[tue_story][scene].dialogs[dialog].text_add[languare]?story_json[tue_story][scene].dialogs[dialog].text_add[languare]:story_json[tue_story][scene].dialogs[dialog].text_add):(dialog_letter=0,t=story_json[tue_story][scene].dialogs[dialog].text[languare]?story_json[tue_story][scene].dialogs[dialog].text[languare]:story_json[tue_story][scene].dialogs[dialog].text);let s=t.matchAll(/<(.*?)>/g);s=Array.from(s);for(var o=0;o<s.length;o++){let e=s[o];t=t.replace(e[0],story_json.parameters.variables[e[1]])}dialog_text=t}function go_story(e){if(!story_json[tue_story][scene].dialogs[dialog].choice||e){if(story_json[tue_story][scene].dialogs[dialog].go_to)go_to(story_json[tue_story][scene].dialogs[dialog].go_to);else dialog<story_json[tue_story][scene].dialogs.length-1?(dialog++,story_json[tue_story][scene].dialogs[dialog].text?\"skip\"==story_json[tue_story][scene].dialogs[dialog].text[languare]?go_story():creation_dialog():story_json[tue_story][scene].dialogs[dialog].text_add&&\"skip\"==story_json[tue_story][scene].dialogs[dialog].text_add[languare]?go_story():creation_dialog()):++scene>=story_json[tue_story].length?scene=story_json[tue_story].length-1:(dialog=0,creation_scene());story_json.parameters.autosave&&save_stag(\"auto\")}}function back_story(){(del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"),story_json[tue_story][scene].dialogs[dialog].back_to)?go_to(story_json[tue_story][scene].dialogs[dialog].back_to):dialog>0?(dialog-=1,story_json[tue_story][scene].dialogs[dialog].text?\"skip\"==story_json[tue_story][scene].dialogs[dialog].text[languare]?back_story():creation_dialog():story_json[tue_story][scene].dialogs[dialog].text_add?\"skip\"==story_json[tue_story][scene].dialogs[dialog].text_add[languare]?back_story():(dialog_text=story_json[tue_story][scene].dialogs[dialog].text_add[languare]?dialog_text.replace(story_json[tue_story][scene].dialogs[dialog].text_add[languare],\"\"):dialog_text.replace(story_json[tue_story][scene].dialogs[dialog].text_add,\"\"),dialog_text=story_json[tue_story][scene].dialogs[dialog+1].text_add[languare]?dialog_text.replace(story_json[tue_story][scene].dialogs[dialog+1].text_add[languare],\"\"):dialog_text.replace(story_json[tue_story][scene].dialogs[dialog+1].text_add,\"\"),creation_dialog()):(creation_dialog(),del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"))):(scene-=1)<0?scene=0:(dialog=story_json[tue_story][scene].dialogs.length-1,creation_scene());story_json.parameters.autosave&&save_stag(\"auto\")}function save_stag(e){localStorage.setItem(\"tue_\"+e+\"_scene\",scene),localStorage.setItem(\"tue_\"+e+\"_dialog\",dialog),localStorage.setItem(\"tue_\"+e+\"_story\",tue_story),story_json.parameters.variables&&localStorage.setItem(\"tue_\"+e+\"_data\",JSON.stringify(story_json.parameters.variables)),\"bookmark\"==e&&tuesday.dispatchEvent(new Event(\"save\"))}function load_stag(e){del_element(\"tue_choice\"),del_element(\"tue_html_sc\"),scene=localStorage.getItem(\"tue_\"+e+\"_scene\"),dialog=localStorage.getItem(\"tue_\"+e+\"_dialog\"),tue_story=localStorage.getItem(\"tue_\"+e+\"_story\"),story_json.parameters.variables=JSON.parse(localStorage.getItem(\"tue_\"+e+\"_data\")),creation_scene(),search_music(),tuesday.dispatchEvent(new Event(\"load\"))}function go_to(e){del_element(\"tue_choice\"),del_element(\"tue_html_dialog\"),dialog=0,scene=0,tue_story=e,creation_scene()}function del_element(e){for(var t=document.getElementById(\"tuesday\").getElementsByClassName(e),s=t.length,o=0;o<s;o++)t[0].parentNode.removeChild(t[0])}function anim_text(){0==dialog_speed?tue_text_view.innerHTML=dialog_text:0!=dialog_speed&&dialog_letter<dialog_text.length?dialog_timeout=setTimeout(add_letter,dialog_speed):dialog_letter==dialog_text.length&&(tue_text_view.innerHTML=dialog_text,tuesday.dispatchEvent(new Event(\"dialog_end\")))}function add_letter(){tue_text_view.innerHTML=dialog_text.slice(0,dialog_letter),dialog_letter++,anim_text()}function search_music(){for(var e=scene;e>=0;e--)if(story_json[tue_story][e].background_music){tue_bg_music.canPlayType(\"audio/mpeg\")?story_json[tue_story][e].background_music.indexOf(\"blob:\")>-1?tue_bg_music.src=story_json[tue_story][e].background_music:story_json[tue_story][e].background_music.indexOf(\".mp3\")>-1?tue_bg_music.src=story_json[tue_story][e].background_music:tue_bg_music.src=story_json[tue_story][e].background_music+\".mp3\":tue_bg_music.src=story_json[tue_story][e].background_music+\".ogg\",tue_bg_music.loop=!0,tue_bg_music.play();break}}function creation_sound(){for(var e=0;Object.keys(story_json.parameters.sounds)[e];){var t=document.createElement(\"audio\");t.preload=\"auto\",t.id=Object.keys(story_json.parameters.sounds)[e],t.canPlayType(\"audio/mpeg\")?story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].indexOf(\"blob:\")>-1?t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]:story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]].indexOf(\".mp3\")>-1?t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]:t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]+\".mp3\":t.src=story_json.parameters.sounds[Object.keys(story_json.parameters.sounds)[e]]+\".ogg\",tuesday.appendChild(t),e++}}function get_sound(e){return e[languare]?\"sound_play('\"+e[languare]+\"');\":\"sound_play('\"+e+\"');\"}function get_stop_sound(e){return e[languare]?\"sound_stop('\"+e[languare]+\"');\":\"sound_stop('\"+e+\"');\"}function sound_play(e){document.getElementById(e).currentTime=0,document.getElementById(e).volume=1,document.getElementById(e).play()}function sound_stop(e){document.getElementById(e).currentTime=0,document.getElementById(e).pause()}function add_style(e){var t=document.createElement(\"link\");t.setAttribute(\"rel\",\"stylesheet\"),t.setAttribute(\"type\",\"text/css\"),t.setAttribute(\"href\",e),document.getElementsByTagName(\"head\").item(0).appendChild(t)}function full_screen(){tue_fullScreen?(tue_fullScreen=!1,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(tue_fullScreen=!0,tuesday.requestFullscreen?tuesday.requestFullscreen():tuesday.mozRequestFullScreen?tuesday.mozRequestFullScreen():tuesday.webkitRequestFullscreen?tuesday.webkitRequestFullscreen():tuesday.msRequestFullscreen&&tuesday.msRequestFullscreen())}document.oncontextmenu=cmenu,document.addEventListener(\"keydown\",function(e){var t=e.code;if(t==story_json.parameters.key.next)go_story();else if(t==story_json.parameters.key.back)back_story();else if(t==story_json.parameters.key.main){go_to(story_json.parameters.launch_story)}else t==story_json.parameters.key.save?save_stag(\"bookmark\"):t==story_json.parameters.key.load?load_stag(\"bookmark\"):t==story_json.parameters.key.autosave?load_stag(\"auto\"):t==story_json.parameters.key.full_screen&&full_screen()});"
let plugins_list={
    "show_toast":{
        "name":"show toast",
        "text":"small message appears for a while",
        "code":"let tue_toast;function creation_tost(){var t=document.createElement(\"style\");t.type=\"text/css\",t.innerHTML=\"#toast{position: fixed;opacity: 0;top: -96px;z-index: 1000;}.toast_anim{left: 50%;transform: translateX(-50%);animation: viwe 0.25s, stop 2s 0.25s, close 0.5s 2s linear;}@keyframes viwe {from {opacity: 0; top: 3em}to {opacity: 1; top: 3em}}@keyframes stop {from {opacity: 1; top: 3em}to {opacity: 1; top: 3em}}@keyframes close {from {opacity: 1; top: 3em}to {opacity: 0; top: -96px}}\",document.getElementsByTagName(\"head\")[0].appendChild(t),(tue_toast=document.createElement(\"div\")).id=\"toast\",tue_toast.innerHTML=\"<table border=\'0\' height=\'100%\' width=\'100%\'><tbody><tr><td id=\'toast_message\' align=\'center\' valign=\'center\' ></td></tr></tbody></table>\",document.body.appendChild(tue_toast)}function toast(t){tue_toast.classList.remove(\"toast_anim\"),document.getElementById(\"toast_message\").innerHTML=t,tue_toast.offsetParent,tue_toast.classList.add(\"toast_anim\")}creation_tost(),tuesday.addEventListener(\"creation_dialog\",function(t){story_json[tue_story][scene].dialogs[dialog].toast&&(story_json[tue_story][scene].dialogs[dialog].toast[languare]?toast(story_json[tue_story][scene].dialogs[dialog].toast[languare]):toast(story_json[tue_story][scene].dialogs[dialog].toast))});"
    },
    "touch_swipe":{
        "name":"touch swipe",
        "text":"switches dialogue by swiping your finger across the touchscreen",
        "code":"var endTime,starttouch=null;window.addEventListener(\"touchstart\",function(t){startTime=new Date,starttouch=1===t.touches.length?t.touches.item(0).clientX:null}),window.addEventListener(\"touchend\",function(t){var e=new Date-startTime;if(starttouch&&e<500){var n=t.changedTouches.item(0).clientX;n>starttouch+40&&back_story(),n<starttouch-40&&go_story()}});"
    }
}
var languare="en";
let languares= {"English":"en","Japanese":"ja","Korean":"ko","Spanish":"es","Russian":"ru","French":"fr","Dutch":"nl","Abkhazian":"ab","Afar":"aa","Afrikaans":"af","Akan":"ak","Albanian":"sq","Amharic":"am","Arabic":"ar","Aragonese":"an","Armenian":"hy","Assamese":"as","Avaric":"av","Avestan":"ae","Aymara":"ay","Azerbaijani":"az","Bambara":"bm","Bashkir":"ba","Basque":"eu","Belarusian":"be","Bengali (Bangla)":"bn","Bihari":"bh","Bislama":"bi","Bosnian":"bs","Breton":"br","Bulgarian":"bg","Burmese":"my","Catalan":"ca","Chamorro":"ch","Chechen":"ce","Chichewa,Chewa,Nyanja":"ny","Chinese":"zh","Chinese (Simplified)":"zh-Hans","Chinese (Traditional)":"zh-Hant","Chuvash":"cv","Cornish":"kw","Corsican":"co","Cree":"cr","Croatian":"hr","Czech":"cs","Danish":"da","Divehi,Dhivehi,Maldivian":"dv","Dzongkha":"dz","Esperanto":"eo","Estonian":"et","Ewe":"ee","Faroese":"fo","Fijian":"fj","Finnish":"fi","Fula,Fulah,Pulaar,Pular":"ff","Galician":"gl","Gaelic (Scottish)":"gd","Gaelic (Manx)":"gv","Georgian":"ka","German":"de","Greek":"el","Greenlandic":"kl","Guarani":"gn","Gujarati":"gu","Haitian Creole":"ht","Hausa":"ha","Hebrew":"he","Herero":"hz","Hindi":"hi","Hiri Motu":"ho","Hungarian":"hu","Icelandic":"is","Ido":"io","Igbo":"ig","Indonesian":"id","Interlingua":"ia","Interlingue":"ie","Inuktitut":"iu","Inupiak":"ik","Irish":"ga","Italian":"it","Javanese":"jv","Kalaallisut,Greenlandic":"kl","Kannada":"kn","Kanuri":"kr","Kashmiri":"ks","Kazakh":"kk","Khmer":"km","Kikuyu":"ki","Kinyarwanda (Rwanda)":"rw","Kirundi":"rn","Kyrgyz":"ky","Komi":"kv","Kongo":"kg","Kurdish":"ku","Kwanyama":"kj","Lao":"lo","Latin":"la","Latvian (Lettish)":"lv","Limburgish ( Limburger)":"li","Lingala":"ln","Lithuanian":"lt","Luga-Katanga":"lu","Luganda,Ganda":"lg","Luxembourgish":"lb","Manx":"gv","Macedonian":"mk","Malagasy":"mg","Malay":"ms","Malayalam":"ml","Maltese":"mt","Maori":"mi","Marathi":"mr","Marshallese":"mh","Moldavian":"mo","Mongolian":"mn","Nauru":"na","Navajo":"nv","Ndonga":"ng","Northern Ndebele":"nd","Nepali":"ne","Norwegian":"no","Norwegian bokmål":"nb","Norwegian nynorsk":"nn","Nuosu":"ii","Occitan":"oc","Ojibwe":"oj","Old Church Slavonic,Old Bulgarian":"cu","Oriya":"or","Oromo (Afaan Oromo)":"om","Ossetian":"os","Pāli":"pi","Pashto,Pushto":"ps","Persian (Farsi)":"fa","Polish":"pl","Portuguese":"pt","Punjabi (Eastern)":"pa","Quechua":"qu","Romansh":"rm","Romanian":"ro","Sami":"se","Samoan":"sm","Sango":"sg","Sanskrit":"sa","Serbian":"sr","Serbo-Croatian":"sh","Sesotho":"st","Setswana":"tn","Shona":"sn","Sichuan Yi":"ii","Sindhi":"sd","Sinhalese":"si","Siswati":"ss","Slovak":"sk","Slovenian":"sl","Somali":"so","Southern Ndebele":"nr","Sundanese":"su","Swahili (Kiswahili)":"sw","Swati":"ss","Swedish":"sv","Tagalog":"tl","Tahitian":"ty","Tajik":"tg","Tamil":"ta","Tatar":"tt","Telugu":"te","Thai":"th","Tibetan":"bo","Tigrinya":"ti","Tonga":"to","Tsonga":"ts","Turkish":"tr","Turkmen":"tk","Twi":"tw","Uyghur":"ug","Urdu":"ur","Uzbek":"uz","Venda":"ve","Vietnamese":"vi","Volapük":"vo","Wallon":"wa","Welsh":"cy","Wolof":"wo","Western Frisian":"fy","Xhosa":"xh","Yiddish":"yi","Yoruba":"yo","Zhuang,Chuang":"za","Zulu":"zu"}
let color_bg=['#ffd4d4','#ebd4d4','#ffedd2','#edffca','#cfffd8','#deffff','#FFF','#d3f2ff','#d8e7ff','#d3d1ff','#f0e0ff','#fbddff','#e9e9e9']
let texts={
    "tutorials":[{
        "en":"Move to the next block based on the values ​​in variables. Variables are created in the 'Settings project' in the 'Variables' section."
        },{
        "en":"Text and character name settings that will be displayed in the text area"
        },{
        "en":"Customize the look of the scene, its background image and music, for subsequent dialogues and actions."
        },{
        "en":"Select working media folder for project (images & sounds)."
        },{
        "en":"Changes in the values ​​of variables, their values ​​can be displayed in the text as <values ​​name> or in \"Legacy Choice\" to go to another block of script."
        },{
        "en":"Select an input device for ease of use. You can change the device in the settings in the 'editor' section."
        },{
        "en":"Mouse<br>control with the zoom wheel"
        },{
        "en":"TouchPad<br>recommended for laptops and MacBooks"
        }
    ]
}
let setup_editor={
        'wheel':true,
        'fon':'',
        'ui':0,
        'lines':false,
        'preview':[76,1],
        'ferst':true
    };
if(localStorage.getItem("editor_setup")){setup_editor=JSON.parse(localStorage.getItem("editor_setup"))}
if(setup_editor.ferst){
    var sel="<div class='window' style='padding:24px 8px;'><p>Select input device</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[5].en+"</p>"
    +"<table style=' border-spacing:10px; border-collapse:separate;'><tbody><tr>"
    +"<td><div style='width:256px; height:256px; border-radius:8px;' class='button_menu img_mouse' onclick='setup_editor.ferst=false;setup_editor.wheel=true;modal_window(\"close\");editor_setup();localStorage.setItem(\"editor_setup\",JSON.stringify(setup_editor));'></div><br><p style='font-size:12px;text-align:center;width:256px;' class='select_tutorials'>"+texts.tutorials[6].en+"</p></td>"
    +"<td><div style='width:256px; height:256px; border-radius:8px;' class='button_menu img_touch' onclick='setup_editor.ferst=false;setup_editor.wheel=false;modal_window(\"close\");editor_setup();localStorage.setItem(\"editor_setup\",JSON.stringify(setup_editor));'></div><br><p style='font-size:12px;text-align:center;width:256px;' class='select_tutorials'>"+texts.tutorials[7].en+"</p></td>"
    +"</tr></tbody></table></div>"
    modal_window("open",sel);
}else{editor_setup();}
function editor_setup(){
    world.className=setup_editor.fon;
    screen_preview.className=setup_editor.fon;
    preview_size();
    if(setup_editor.wheel){html.style.overflow='hidden';}
    if(setup_editor.ui&&setup_editor.ui!=0){set_ui(setup_editor.ui);}
    else{html.style.overflow='auto';}
}
function color_element(id,color){
    var pos=document.getElementById(id).getBoundingClientRect();
    color_chois.name=id;
    color_chois.value=color;
    color_chois.style.top=pos.top+"px";
    color_chois.style.left=pos.right+"px";
    color_chois.click();
};
color_chois.addEventListener("input", function(){
    document.getElementById(color_chois.name).value=color_chois.value;
    if(color_chois.name=='scene_color'){scene_bg_preview.style.backgroundColor=color_chois.value}
}, false);

document.addEventListener("wheel",function(e){if(setup_editor.wheel&&(!scroll_block||scene_screen)){if(e.deltaY>0) world_scale(false);else world_scale(2);}});
let project_files=[];
img_file.addEventListener('change',loadFiles);
var load_new=false;
var wf;
function loadFiles(e){
    wf=e.target.files[0].webkitRelativePath.split("/")[0]+"/";
    if(load_new){
        project_foler.value=wf.replace("/","")
        for(var i=0;i<e.target.files.length;i++){project_files.push([e.target.files[i].webkitRelativePath.replace(wf,'').replace('.mp3',''),URL.createObjectURL(e.target.files[i]),e.target.files[i].type]);}
    }else{
        var jsons=[];
        for(var i=0;i<e.target.files.length;i++){
            project_files.push([e.target.files[i].webkitRelativePath.replace(wf,'').replace('.mp3',''),URL.createObjectURL(e.target.files[i]),e.target.files[i].type]);
            if(e.target.files[i].type=="application/json"){jsons.push([i,e.target.files[i].name])}
        }
        if(jsons.length==1){load_story_edit(URL.createObjectURL(e.target.files[jsons[0][0]]))}
        else if(jsons.length>1){
            var html="<div class='window'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><br><p>Select JSON project file</p><br><hr><div style='margin:0 16px 8px 16px; max-height:75vh; overflow-x:hidden;'>"
            for(var f=0;f<jsons.length;f++){html+="<table class='button' style='width:412px; margin:8px 0px;' onclick='load_story_edit(open_file(\""+jsons[f][1]+"\")); modal_window(\"close\"); '><tbody><tr><td width='48px' height='48px' class='icon icon_new'> </td><td align='left'><div style='width:364px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden;'>"+jsons[f][1]+"</div></td></tr></tbody></table>"}
            html+="</div></div>"
            modal_window("open",html)
        } else if(jsons.length==0){alert('json file no found')}
    }
}
function open_file(name){
    for(var f=0;f<project_files.length;f++){if(project_files[f][0]==name){name=(project_files[f][1]);break;}} return name;
}
function new_novel(){
    story_script={"parameters":{"text_panel":{"size":["95%","25%"],"color":"#efefff","indent_text":"8px","indent_bottom":"32px","size_text":"20px","style":"border-radius:16px;","dialog_speed":"10"},"name_panel":{"size":["0","48px"],"position":["0","0","-48px","0"],"size_text":"18px"},"title":{"en":"new novel"},"launch_story":"","key":{"next":"","back":"","save":"","load":"","full_screen":"","launch_story":"","load_autosave":""},"languares":["en"],"buttons":[{"name":"tue_back","style":"border-radius:26px;","position":["0","55%","0","8px"],"size":["52px","52px"],"color":"#cec8e3","size_text":"44px","text":"<"},{"name":"tue_next","style":"border-radius:26px;","position":["55%","0","0","8px"],"size":["52px","52px"],"color":"#cec8e3","size_text":"44px","text":">"}],"style_file":"","autosave":false,"font":"Arial","font_size":"18px","variables":{},"sounds":{}},"blocks":{}};
    update_novel();
}
function update_novel(){
    if(scene_screen){scen_edit_updare(true)}
    else{
        add_element.style.visibility="hidden";
        story_blocks.innerHTML=""
        line_controll=[];
        search_block.value=""
        while(story_lines.hasChildNodes()){story_lines.removeChild(story_lines.firstChild);}
        parse_story();
        lines();
    }
}
function load_story_edit(url){
    var xmlhttp=new XMLHttpRequest();
    xmlhttp.onreadystatechange=function(){
        if(this.readyState==4&&this.status==200){
            new_novel()
            story_script=JSON.parse(this.responseText);
            if(!story_script.parameters){alert("error in json file")}
			else{
                toast("json file loading completed");
                languare=story_script.parameters.languares[0]
                parse_story()
                lines()
            }
        }
    };
    xmlhttp.open("GET",url,true);
    xmlhttp.send();
    xmlhttp.onerror=function(){if(this.status==0){alert('json file not loaded');}}
}
var all_blocks=0;
function parse_story(){
    story_blocks=document.getElementById("story_blocks");
    story_blocks.innerHTML=""
    story_lines=document.getElementById("story_lines");
	story_blocks.setAttribute("align","center");
    while(story_lines.hasChildNodes()){story_lines.removeChild(story_lines.firstChild);}
    all_blocks=0;
	if(!story_script.blocks){story_script.blocks={}}
    if(!story_script.parameters.title){story_script.parameters.title=""}
    if(!story_script.parameters.key){story_script.parameters.key=""}
    while(Object.keys(story_script)[all_blocks]){creation_block(all_blocks);all_blocks++;}
	if(story_script.parameters.languares){lang_select()}
    control_dlock()
    world_size()
}
function lang_select(){
	var lang_list=document.getElementById('language_view');
	lang_list.innerHTML=project_languares(languare);
}
language_view.onchange=function(e){
	languare=language_view.value;
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2]);}
    update_novel()
};
function creation_block(b){
    var chapter=document.createElement("div");
    var element="";
    var all=0;
    chapter.id=Object.keys(story_script)[b];
    var go="";
    if(chapter.id!="parameters"&&chapter.id!="blocks"){
        for(var i=0;i<story_script[chapter.id].length;i++){
            element+="<div id='s_"+chapter.id+"_"+i+"' class='scene' align='center'>"
            if(story_script[chapter.id][i].legacy_choice){
				element+="<table height='22px' width='100%' style='margin:4px;'><tbody><tr><td width='24px' class='icon_m icon_up' title='Scene up' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",-1)'></td><td width='24px' class='icon_m icon_down' title='Scene down' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",1)'></td><td><p class='namber'>scene:"+(i+1)+"</p></td><td width='48px' class='icon_m icon_show' id='"+chapter.id+"_"+i+"_edit' onmouseup='arr_l=story_script."+chapter.id+";arr_n="+i+";legacy_choice_m(this.id);' title='Scene edit'></td></tr></tbody></table><div width='100%'>"
                for(var l=0;l<story_script[chapter.id][i].legacy_choice.length;l++){
                    if(story_script[chapter.id][i].legacy_choice[l][0]){
                        go=story_script[chapter.id][i].legacy_choice[l][3];
                        if(story_script[go]){
                            element+="<table id='"+all+"l"+l+go+all_blocks+"' class='choice_b to_go' width='100%'><tbody><tr><td style=padding:4px;>"+story_script[chapter.id][i].legacy_choice[l][0]+" "+story_script[chapter.id][i].legacy_choice[l][1]+" "+story_script[chapter.id][i].legacy_choice[l][2]+"</td><td></td><td colspan='3' align='right'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"][3]=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</td><td class='icon button_block icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"l"+l+go+all_blocks]);
                            creaton_line(all+"l"+l+go+all_blocks)
                            all++
                        }else{
                            element+="<table id='"+all+"l"+l+go+all_blocks+"' class='choice_b' width='100%'><tbody><tr><td>"+story_script[chapter.id][i].legacy_choice[l][0]+" "+story_script[chapter.id][i].legacy_choice[l][1]+" "+story_script[chapter.id][i].legacy_choice[l][2]+"</td><td align='center'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"][3]=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</td><td class='icon button_block icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                        }
                    } else if(story_script[chapter.id][i].legacy_choice[l].go_to){
                        go=story_script[chapter.id][i].legacy_choice[l].go_to;
                        if(story_script[go]){
                            element+="<table id='"+all+"l"+l+go+all_blocks+"' class='choice_b to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"].go_to=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"l"+l+go+all_blocks]);
                            creaton_line(all+"l"+l+go+all_blocks)
                            all++
                        }else{element+="<div id='"+all+"l"+l+go+all_blocks+"' class='choice_b'>"+"<select onchange='story_script."+chapter.id+"["+i+"].legacy_choice["+l+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,0)+"</select>"+"</div>"}
                    }
                }
                element+="</div>"
            }else{element+="<table height='22px' width='100%' style='margin:4px;'><tbody><tr><td width='24px' class='icon_m icon_up' title='Scene up' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",-1)'></td><td width='24px' class='icon_m icon_down' title='Scene down' onmouseup='move_elenetn(story_script."+chapter.id+","+i+",1)'></td><td><p class='namber'>scene:"+(i+1)+"</p></td><td width='45px' class='icon_m icon_show' id='"+chapter.id+"_"+i+"_edit' onmouseup='arr_l=story_script."+chapter.id+";arr_n="+i+";scene_m(this.id,"+(i+1)+",\""+chapter.id+"\");' title='Scene edit'></td></tr></tbody></table>"}
            if(story_script[chapter.id][i].background_image&&(typeof story_script[chapter.id][i].background_image!=='object'||(story_script[chapter.id][i].background_image[languare]&&typeof story_script[chapter.id][i].background_image[languare]!=='object')) ||story_script[chapter.id][i].background_color){element+="<div class='scene_bg' style='background-image:url("+open_file(languare_data(story_script[chapter.id][i].background_image))+");background-color:"+story_script[chapter.id][i].background_color+";' width='100%'></div>"}
            if(story_script[chapter.id][i].dialogs){
                for(var d=0;d<story_script[chapter.id][i].dialogs.length;d++){
					element+="<div class='dialog' id='d_"+chapter.id+"_"+i+"_"+d+"'>"+"<table height='22px' width='100%' style='margin-bottom:4px'><tbody><tr><td width='24px' class='icon_m icon_up' title='Dialog up' onmouseup='move_elenetn(story_script."+chapter.id+"["+i+"].dialogs,"+d+",-1)'></td><td width='24px' class='icon_m icon_down' title='Dialog down' onmouseup='move_elenetn(story_script."+chapter.id+"["+i+"].dialogs,"+d+",1)'></td><td><p class='namber'>scene:"+(i+1)+" | dialog:"+(d+1)+"</p></td><td id='m_"+chapter.id+"_"+i+"_"+d+"' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs;arr_n="+d+";dialog_m(this.id,'"+(d+1)+"','"+chapter.id+"',"+i+")\" class='add_button icon_m icon_show' title='Dialog'></td></tr></tbody></table>"
                    var n=languare_data(story_script[chapter.id][i].dialogs[d].name);
					if(story_script[chapter.id][i].dialogs[d].back_to){
                        go=story_script[chapter.id][i].dialogs[d].back_to;
                        if(story_script[go]){
						element+="<div class='dialog_element'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Back to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_back_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='back_to';dialog_el(this.id,'Back to',false)\"  width='24px' class='icon_m icon_edit' title='Сhange next block'></td></tr></tbody></table>"
								+"<table id='"+all+"b"+d+go+all_blocks+"' class='choice_b to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].back_to=this.value;' class='input_text_b'>"+option_block(go,0)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"b"+d+go+all_blocks]);
                            creaton_line(all+"b"+d+go+all_blocks)
                            all++
                        }else{element+="<div class='dialog_element'>"
						+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Back to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_go_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='back_to';dialog_el(this.id,'Back to',false)\"  width='24px' class='icon_m icon_edit' title='Сhange next block'></td></tr></tbody></table>"
						+"<div id='"+all+"b"+d+go+all_blocks+"' class='choice_b'>"+"<select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].back_to=this.value;' class='input_text_b'>"+option_block(go,0)+"</select>"+"</div></div>";}
						element+="</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].text){
						var t=(languare_data(story_script[chapter.id][i].dialogs[d].text))
						element+="<div class='dialog_element' align='left'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'>"+((n.length>0)?"<p><b>"+n+"</p></b>" :"&nbsp;")+"</td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_text' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='text';dialog_el(this.id,'Text',true)\" width='24px' class='icon_m icon_edit' title='Edit dialog'></td></tr></tbody></table>"
								+"<p style='padding:4px;'>"+((t.length>0)?t:'&nbsp;')+"</p></div>"
					}
                    if(story_script[chapter.id][i].dialogs[d].text_add){
                        var t=(languare_data(story_script[chapter.id][i].dialogs[d].text_add))
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'>"+((n.length>0)?"<p><b>"+n+" " :"<p><b>")+"text add</b></p></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_text_add' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='text_add';dialog_el(this.id,'Text add',true)\" width='24px' class='icon_m icon_edit' title='Edit dialog'></td></tr></tbody></table>"
                                +"<p>"+((t.length>0)?t:'&nbsp;')+"</p></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].sound_stop){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Stop sound<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_sound_stop' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='sound_stop';dialog_el(this.id,'Stop sound',true)\" width='24px' class='icon_m icon_edit' title='Edit sound'></td></tr></tbody></table>"
                                +"<input class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].sound_stop=this.value' value='"+story_script[chapter.id][i].dialogs[d].sound_stop+"' type='text'></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].sound){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Play sound<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_sound' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='sound';dialog_el(this.id,'Play sound',true)\" width='24px' class='icon_m icon_edit' title='Edit sound'></td></tr></tbody></table>"
                                +"<input class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].sound=this.value' value='"+story_script[chapter.id][i].dialogs[d].sound+"' type='text'></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].event){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Event<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_event' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='event';dialog_el(this.id,'Event',false)\" width='24px' class='icon_m icon_edit' title='Edit event'></td></tr></tbody></table>"
                                +"<input class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].event=this.value' value='"+story_script[chapter.id][i].dialogs[d].event+"' type='text'></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].toast){
                        element+="<div class='dialog_element' align='left'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Toast</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_html' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='toast';dialog_el(this.id,'HTML code',true);\" width='24px' class='icon_m icon_edit' title='Edit toast'></td></tr></tbody></table><p style='padding:4px;'>"+languare_data(story_script[chapter.id][i].dialogs[d].toast)+"</p></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].controll){
                        element+="<div class='dialog_element' align='left'>"
                                +"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Interface<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_controll' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='controll';dialog_el(this.id,'Interface',false)\" width='24px' class='icon_m icon_edit' title='Edit interface'></td></tr></tbody></table>"
                                +"<div class='choice_b'><select class='input_text_b' oninput='story_script."+chapter.id+"["+i+"].dialogs["+d+"].controll=this.value'><option value='hidden'>Hidden</option><option value='visible' "+((story_script[chapter.id][i].dialogs[d].controll=="visible")?"selected":"")+">Visible</option></select></div></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].variables){
                        var t="";
                        for(var c=0;c<story_script[chapter.id][i].dialogs[d].variables.length;c++){t+="<table width='100%' height='28px' class='choice_b'><tbody><tr><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].variables["+c+"][0]=this.value;' class='input_text_b'>"+option_var(story_script[chapter.id][i].dialogs[d].variables[c][0])+"</select></td><td width='15%'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].variables["+c+"][1]=this.value;' class='input_text_b'><option value='add'>add</option><option value='set' "+((story_script[chapter.id][i].dialogs[d].variables[c][1]=="set")?"selected":"")+">set</option></select></td><td width='34%'> <input class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].variables["+c+"][2]=this.value' value='"+story_script[chapter.id][i].dialogs[d].variables[c][2]+"' type='text'> </td><td width='5%'></td></tr></tbody></table>"};
                        element+="<div class='dialog_element' align='left'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center'><b>Variables<b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_variables' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='variables';dialog_el(this.id,'Variables',true)\" width='24px' class='icon_m icon_edit' title='Edit variables'></td></tr></tbody></table>"+t+"</div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].html){
                        element+="<div class='dialog_element'><table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>HTML code</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_html' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='html';dialog_el(this.id,'HTML code',true);\" width='24px' class='icon_m icon_edit' title='Edit html'></td></tr></tbody></table></div>"
                    }
                    if(story_script[chapter.id][i].dialogs[d].choice){
                        element+="<div class='dialog_element'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Choice</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_choice' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='choice';dialog_el(this.id,'Choice',true)\" width='24px' class='icon_m icon_edit' title='Edit choice'></td></tr></tbody></table>"
                        for(var c=0;c<story_script[chapter.id][i].dialogs[d].choice.length;c++){
                            go=story_script[chapter.id][i].dialogs[d].choice[c].go_to;
                            if(go&&go!=""&&go!="undefined"){
                                var t=languare_data(story_script[chapter.id][i].dialogs[d].choice[c].text)
                                if(story_script[go]){
                                    element+="<table id='"+all+"c"+d+go+all_blocks+"' style='width:100%;' class='choice_b to_go'><tbody><tr><td style='padding-left:8px;width:50%;'><input style='width:100%;' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].text=this.value' value='"+((t=="")?go:t)+"' type='text'></td><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,2)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"></td></tr></tbody></table>"
                                    line_controll.push([go,chapter.id,all+"c"+d+go+all_blocks]);
                                    creaton_line(all+"c"+d+go+all_blocks);
                                }else{element+="<table style='width:100%;' class='choice_b'><tbody><tr><td style='padding-left:8px;width:50%;'><input style='width:100%;' class='input_text' onkeyup='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].text=this.value' value='"+((t=="")?go:t)+"' type='text'></td><td><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].choice["+c+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,2)+"</select></td><td class='button_block icon'></td></tr></tbody></table>"}
                            }else{var t=languare_data(story_script[chapter.id][i].dialogs[d].choice[c].text)
								element+="<table style='width:100%;' class='choice_b'><tbody><tr><td class='button_block'></td><td style='padding:4px;'>"+((t=="")?go:t)+"</td><td class='button_block icon'></td></tr></tbody></table>"
                            }all++
                        }
                        element+="</div>"
                    }
					if(story_script[chapter.id][i].dialogs[d].go_to){
                        go=story_script[chapter.id][i].dialogs[d].go_to;
                        if(story_script[go]){
						element+="<div class='dialog_element'>"
								+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Go to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_go_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='go_to';dialog_el(this.id,'Go to',false)\"  width='24px' class='icon_m icon_edit' title='Сhange next block'></td></tr></tbody></table>"
								+"<table id='"+all+"g"+d+go+all_blocks+"' class='choice_b to_go' style='width:100%;'><tbody><tr><td style='padding:4px;'><select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,0)+"</select></td><td class='button_block icon icon_go' style='cursor:pointer;' onmouseup=\"go_to_block('"+go+"')\"> </td></tr></tbody></table>"
                            line_controll.push([go,chapter.id,all+"g"+d+go+all_blocks]);
                            creaton_line(all+"g"+d+go+all_blocks)
                            all++
                        }else{element+="<div class='dialog_element'>"
							+"<table height='22px' width='100%' style='margin:4px 0px;'><tbody><tr><td align='left' valign='center' style='padding-left:4px;'><b>Go to</b></td><td id='dialog_"+chapter.id+"_"+i+"_"+d+"_go_to' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];arr_n='go_to';dialog_el(this.id,'Go to',false)\"  width='24px' class='icon_m icon_edit' title='Сhange next block'></td></tr></tbody></table>"+"<div id='"+all+"g"+d+go+all_blocks+"' class='choice_b'>"
							+"<select onchange='story_script."+chapter.id+"["+i+"].dialogs["+d+"].go_to=this.value;update_novel();' class='input_text_b'>"+option_block(go,0)+"</select>"+"</div></div>";}
						element+="</div>"
                    }
					element+="<div align='right'><div id='add_d_"+chapter.id+"_"+i+"_"+d+"' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs["+d+"];add_element_d(this.id,'"+(d+1)+"')\" class='add_button icon_m icon_add' title='Add element to dialog'></div></div></div>"
                }
				element+="<div align='right' style='margin-right:4px;'><div id='add_s_"+chapter.id+"_"+i+"' onmouseup=\"arr_l=story_script."+chapter.id+"["+i+"].dialogs;arr_n="+d+";add_element_s(this.id,'"+(i+1)+"')\" class='add_button icon_m icon_add' title='Add element to scene'></div></div>"
            }
            element+="</div>"
        }
        element+="<div align='right' style='margin-right:8px;'><div id='add_b_"+chapter.id+"' onmouseup=\"add_element_b(this.id,\'"+chapter.id+"\')\" class='add_button icon_m icon_add' title='Add element to block'></div></div>"
        chapter.innerHTML="<div style='margin:2px;'><table height='100%' width='100%'><tbody><tr><td align='center' style='cursor:pointer;'  onmousedown=\"block_open('"+chapter.id+"_content')\" class='button_block icon icon_more'></td><td align='center'>"+((chapter.id.length>17)?chapter.id.slice(0,15)+"...":chapter.id )+"</td><td align='center' style='cursor:pointer; width:48px;' onmouseup=\"edit_block('"+chapter.id+"')\" class='icon_m button_block icon_edit'></td><td align='center' style='cursor:pointer;' onmouseup=\"play_novel('"+chapter.id+"')\" class='icon_m button_block icon_play'></td> <td style='width:8px;'></td> </tr></tbody></table></div><div id='"+chapter.id+"_content' style='display:"+((story_script.blocks[chapter.id])?story_script.blocks[chapter.id][2]:"none" )+";'>"+element+"</div>";
        chapter.className="story_block panel";
		if(!story_script.blocks[chapter.id]){
			chapter.style.left=64+(320 * (all_blocks-1))+"px";
			chapter.style.top=64+(128 * (all_blocks-1))+"px";
			story_script.blocks[chapter.id]=[chapter.style.left,chapter.style.top,'none','#fff']
		}else{
			chapter.style.left=story_script.blocks[chapter.id][0];
			chapter.style.top=story_script.blocks[chapter.id][1];
			chapter.style.backgroundColor=story_script.blocks[chapter.id][3];
		}
        story_blocks.appendChild(chapter);
    }
}
function languare_data(data){
    if(data){return ((data[languare])?data[languare]:data);}
	else{return ""}
}
function data_la(arr,key){
    var s=((Object.keys(arr[key])[0]==languare)?arr[key][languare]:arr[key]);
	arr[key]={};
	for(var i=0;i<story_script.parameters.languares.length;i++){arr[key][story_script.parameters.languares[i]]=s;}
}
function data_only(arr,key){
if(arr[key][story_script.parameters.languares[0]]){
	var n=arr[key][story_script.parameters.languares[0]];
	var a=0;
	for(var i=0;i<story_script.parameters.languares.length;i++){
		if(arr[key][story_script.parameters.languares[i]]){
			if(n.length==0||n==arr[key][story_script.parameters.languares[i]]||arr[key][story_script.parameters.languares[i]].length==0){a++}
			else{n=arr[key][story_script.parameters.languares[i]]}
		}else{a++}
	}
	if(a==story_script.parameters.languares.length){arr[key]=n};
}}
function creaton_line(id){
    var newLine=document.createElementNS("http://www.w3.org/2000/svg",'line');
    newLine.id=id+"l"
    story_lines.appendChild(newLine);
}
new_novel()
function save_file(){
    var d=new Date();
    var n="new";
    var dm=String(d.getMonth()+1);
    var dd=String(d.getDate());
    var dh=String(d.getHours());
    var di=String(d.getMinutes());
    var ds=String(d.getSeconds());
    var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(story_script));
    var dlAnchorElem=document.getElementById('downloadAnchorElem');
    if(story_script.parameters.title){n=(story_script.parameters.title.en)?story_script.parameters.title.en :story_script.parameters.title;}
	else{n="new_novel";}
    dlAnchorElem.setAttribute("href",dataStr);
    dlAnchorElem.setAttribute("download",n+'_'+d.getFullYear()+'_'+(dm.length<2?'0'+dm :dm)+'_'+(dd.length<2?'0'+dd :dd)+'_'+(dh.length<2?'0'+dh :dh)+"-"+(di.length<2?'0'+di:di)+"-"+(ds.length<2?'0'+ds:ds)+'.json');
    dlAnchorElem.click();
}
function lines(elem){
    var to_go=document.getElementsByClassName("to_go");
    for(var x=0;x<to_go.length;x++){
        if(!setup_editor.lines){
            if(elem==line_controll[x][1]||elem==line_controll[x][0]){document.getElementById(line_controll[x][2]+"l").style.visibility='visible'}
            else{document.getElementById(line_controll[x][2]+"l").style.visibility='hidden'}
        }
        var title_block;
        if(document.getElementById(line_controll[x][1]+"_content").style.display=='none'){
            title_block=document.getElementById(line_controll[x][0]).getBoundingClientRect();
            var rect=document.getElementById(line_controll[x][1]).getBoundingClientRect();
            var l1=(html.scrollLeft+rect.left)/scale;
            var l2=(html.scrollLeft+title_block.left)/scale
            if(l1>l2){
                moveSlider(l1,'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(22*scale))/scale,'y2',line_controll[x][2]);
                moveSlider((l2+(256)),'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }else{
                moveSlider((l1+256),'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(22*scale))/scale,'y2',line_controll[x][2]);
                moveSlider(l2,'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }
        }else{
            title_block=document.getElementById(line_controll[x][0]).getBoundingClientRect();
            var rect=document.getElementById(line_controll[x][2]).getBoundingClientRect();
            var l1=(html.scrollLeft+rect.left)/scale;
            var l2=(html.scrollLeft+title_block.left)/scale
            if(l1>l2){
                moveSlider((l1-12),'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(12*scale))/scale,'y2',line_controll[x][2]);
                moveSlider((l2+256),'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }else{
                moveSlider((l1+244),'x2',line_controll[x][2]);
                moveSlider((rect.top+html.scrollTop+(12*scale))/scale,'y2',line_controll[x][2]);
                moveSlider(l2,'x1',line_controll[x][2]);
                moveSlider((title_block.top+html.scrollTop+(22*scale))/scale,'y1',line_controll[x][2]);
            }
        }
    }
}
var moveSlider=function(slider,direction,id){
    var value=slider;
    var element=document.getElementById(id+"l");
    var coord=direction;
    element.setAttributeNS(null,coord,value);
}
function control_dlock(){
    all_blocks=document.getElementsByClassName("story_block");
    for(var i=0;i<all_blocks.length;i++){movie_dlock(all_blocks[i].id)}
}
var scroll_block=false;
function movie_dlock(id){
    var focus_block=document.getElementById(id);
    focus_block.onmousedown=function(e){
        add_element.style.visibility="hidden";
        var coords=getCoords(focus_block);
        var shiftX=(e.pageX-coords.left);
        var shiftY=(e.pageY-coords.top);
        scroll_block=true;
        focus_block.style.position='absolute';
        focus_block.style.animation=false;
        focus_block.style.WebkitAnimation=false;
        story_blocks.appendChild(focus_block);
        moveAt(e);
        function moveAt(e){
            focus_block.style.left=((e.pageX-shiftX)/scale)+'px';
            focus_block.style.top=((e.pageY-shiftY)/scale)+'px';
            lines(id)
        }
        document.onmousemove=function(e){moveAt(e);};
        focus_block.onmouseup=function(){
			story_script.blocks[focus_block.id]=[focus_block.style.left,focus_block.style.top,document.getElementById(focus_block.id+"_content").style.display,focus_block.style.backgroundColor]
            document.onmousemove=null;
            focus_block.onmouseup=null;
            if(window_zone.style.visibility!="visible"){scroll_block=false};
            world_size()
        };
    }
    focus_block.ondragstart=function(){return false;};
    function getCoords(elem){
        var box=elem.getBoundingClientRect();
        return {
            top:box.top+pageYOffset,
            left:box.left+pageXOffset
        };
    }
}
function world_size(){
    var height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);
    var width=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollWidth,html.offsetWidth);
    story_lines.setAttribute("height",height/scale);
    story_lines.setAttribute("width",width/scale);
    story_lines.setAttribute("viewBox","0,0,"+width/scale+","+height/scale);
}
function block_open(id){
    var e=document.getElementById(id);
    if(e.style.display === "block"){e.style.display="none";}
	else{e.style.display="block";}
    lines()
}
var startmove_x=null;
var startmove_y=null;
var scroll_x=null;
var scroll_y=null;
var scroll_xz=null;
var scroll_yz=null;
html.ontouchstart=function(e){
    if(!scroll_block||scene_screen){
        startmove_x=e.touches[0].clientX;
        startmove_y=e.touches[0].clientY;
        scroll_x=html.scrollTop;
        scroll_y=html.scrollLeft;
        html.ontouchmove=function(e){
            html.scrollTop=scroll_x-(e.touches[0].clientY-startmove_y);
            html.scrollLeft=scroll_y-(e.touches[0].clientX-startmove_x);
        }
        html.ontouchend=function(e){
            startmove_x=null;
            startmove_y=null;
            html.ontouchmove=null;
            html.ontouchend=null;
            scroll_z();
        };
    }
}
scene_view.ontouchstart=function(e){
    if(scene_screen&&scene_scroll){
        startmove_x=e.touches[0].clientX;
        startmove_y=e.touches[0].clientY;
        scroll_x=scene_view.scrollTop;
        scroll_y=scene_view.scrollLeft;
        html.ontouchmove=function(e){
            scene_view.scrollTop=scroll_x-(e.touches[0].clientY-startmove_y);
            scene_view.scrollLeft=scroll_y-(e.touches[0].clientX-startmove_x);
        }
        html.ontouchend=function(e){
            startmove_x=null;
            startmove_y=null;
            html.ontouchmove=null;
            html.ontouchend=null;
            scroll_z();
        };
    }
}
html.onmousedown=function(e){
    if(!scroll_block&&!scene_screen){
        startmove_x=e.clientX;
        startmove_y=e.clientY;
        scroll_x=html.scrollTop;
        scroll_y=html.scrollLeft;
        html.onmousemove=function(e){
            html.scrollTop=scroll_x-(e.clientY-startmove_y);
            html.scrollLeft=scroll_y-(e.clientX-startmove_x);
        }
        html.onmouseup=function(e){
            startmove_x=null;
            startmove_y=null;
            html.onmousemove=null;
            html.onmouseup=null;
            scroll_z();
        };
		html.onmouseleave=function(){
			html.onmousemove=null;
			html.onmouseup=null;
			document.onmousemove=null;
			document.onmouseup=null;
		};
    }
}
scene_view.onmousedown=function(e){
    if(scene_screen&&scene_scroll){
        startmove_x=e.clientX;
        startmove_y=e.clientY;
        scroll_x=scene_view.scrollTop;
        scroll_y=scene_view.scrollLeft;
        html.onmousemove=function(e){
            scene_view.scrollTop=scroll_x-(e.clientY-startmove_y);
            scene_view.scrollLeft=scroll_y-(e.clientX-startmove_x);
        }
        html.onmouseup=function(e){
            startmove_x=null;
            startmove_y=null;
            html.onmousemove=null;
            html.onmouseup=null;
        };
        html.onmouseleave=function(){
            html.onmousemove=null;
            html.onmouseup=null;
            document.onmousemove=null;
            document.onmouseup=null;
        };
    }
}
function scroll_z(){
    scroll_xz=((html.scrollTop+(html.clientHeight/2))/scale)-(html.clientHeight/2);
    scroll_yz=((html.scrollLeft+(html.clientWidth/2))/scale)-(html.clientWidth/2);
}
function modal_window(action,content){
    var window_zone=document.getElementById("window_zone");
    if(action=='close'){
        add_element.style.visibility="hidden";
        window_zone.style.visibility="hidden"
        window_zone.style.backgroundColor='rgba(110,95,165,0)';
        html.style.overflow='scroll';
        scroll_block=false;
        window_zone.innerHTML="";
    } else if(action=='open'&&window_zone.style.visibility!="visible"){
        window_zone.style.visibility="visible";
        window_zone.style.backgroundColor='var(--cm)'//'#cec8e3';
        html.style.overflow='hidden';
        window_zone.innerHTML=content;
        scroll_block=true;
    }
}
function play_novel(bl){
    var story_preview=JSON.stringify(story_script)
    for(var f=0;f<project_files.length;f++){for(var r=JSON.stringify(story_script).split(project_files[f][0]).length+2;r>0;r--){story_preview=story_preview.replace(project_files[f][0],project_files[f][1])}}
    var plugins_code=" ";
    var plugins_file="";
    if(story_script.parameters.plugins){for(var i=0;i<story_script.parameters.plugins.length;i++){
        if(plugins_list[story_script.parameters.plugins[i]]){
            if (plugins_list[story_script.parameters.plugins[i]].code){plugins_code+=plugins_list[story_script.parameters.plugins[i]].code+" "}
            else if(plugins_list[story_script.parameters.plugins[i]].file){plugins_file+="<script type='text/javascript' src='"+open_file(plugins_list[story_script.parameters.plugins[i]].file)+"'><\/script>"}
        }else{plugins_file+=((plugins_list[story_script.parameters.plugins[i]])?"<script type='text/javascript' src='"+open_file(plugins_list[story_script.parameters.plugins[i]].file)+"'><\/script>":"<script type='text/javascript' src='"+open_file(story_script.parameters.plugins[i])+"'><\/script>")}
    }}
    var fonts="";
    if(story_script.parameters.font_files){for(var i=0;i<Object.keys(story_script.parameters.font_files).length;i++){fonts+="@font-face{font-family:"+Object.keys(story_script.parameters.font_files)[i]+";src:url("+open_file(story_script.parameters.font_files[Object.keys(story_script.parameters.font_files)[i]])+");} "}}
    var preview=window.open("https://kirilllive.github.io/Tuesday/tuesday_visual.html","preview","location=no,scrollbars=no,width=640,height=480");
    preview.document.write("<html><head><style>"+fonts+" "+((story_script.parameters.font)?"*{font-family:"+story_script.parameters.font+";} ":"")+"body{font-size:"+story_script.parameters.font_size+"; background-color:#fff; border-collapse:collapse; border:none; margin:0; padding:0; border:0; border-spacing:0px; -webkit-touch-callout:none; -webkit-user-select:none; -khtml-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;}<\/style><\/head><body><div id='tuesday' style='width:100%; height:100vh;'> <\/div><script type='text/javascript'>"+runtime+plugins_code+"<\/script>"+plugins_file+"<script>let story_preview="+story_preview+";  tuesday.addEventListener('script_executed',function(event){languare='"+languare+"'}); "+((bl)?"tuesday.addEventListener('script_loaded',function(event){go_to('"+bl+"')});" :"")+" load_story('data',story_preview);<\/script><\/body><\/html>");
}
function search_block(){
    var input,filter,li,i,txtValue;
    input=document.getElementById("search_block");
    filter=input.value.toUpperCase();
    li=document.getElementsByClassName("story_block");
    var ferst=false
    for(i=0;i<li.length;i++){
        txtValue=li[i].id.toUpperCase();
        if(txtValue.toUpperCase().indexOf(filter)>-1){
            li[i].style.opacity=1;
            if(filter.length>0&&!ferst){
                scroll_to_block(li[i]);
                ferst=true;
            } else if(filter==txtValue){
                scroll_to_block(li[i]);
                ferst=true;
            }
        }else{li[i].style.opacity=0.25;}
    }
}
function go_to_block(bl){bl=document.getElementById(bl);scroll_to_block(bl);}
function scroll_to_block(bl){
    var rect=bl.getBoundingClientRect();
    html.scrollTop=(html.scrollTop+(rect.top-(html.clientHeight/2)+22));
    html.scrollLeft=(html.scrollLeft+(rect.left-(html.clientWidth/2)+(rect.width/2)));
    bl.style.animation="flash 2s 1";
    bl.style.WebkitAnimation="flash 2s 1";
    story_blocks.appendChild(bl);
}
function toast(message){
    var x=document.getElementById("toast");
    x.classList.remove("toast_anim");
    toast_message.innerHTML=message
    void x.offsetParent;
    x.classList.add("toast_anim");
}
function about(){
    var html="<div class='window' style='padding:24px 16px; width:412px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><div align='center'><p style='font-size:22px;'>Tuesday js visual editor</p><hr><p style=''>Version:0.10 (Beta)</p><br><table style=' border-spacing:10px; border-collapse:separate;'><tr><td align='right'>E-Mail:</td><td align='left'><a href='mailto:tuesdayjsengine@gmail.com' target='_blank'>tuesdayjsengine@gmail.com</a></td></tr><tr><td align='right'>Home:</td><td align='left'><a href='https://kirilllive.github.io/tuesday-js' target='_blank'>https://kirilllive.github.io/tuesday-js</a></td></tr><tr><td align='right'>itch.io:</td><td align='left'><a href='https://kirill-live.itch.io/tuesday-js' target='_blank'>https://kirill-live.itch.io/tuesday-js</a></td></tr><tr><td align='right'>GitHub:</td><td align='left'><a href='https://github.com/Kirilllive/tuesday-js' target='_blank'>https://github.com/Kirilllive/tuesday-js</a></td></tr></table><br><p>Thanks for the help from users</p><hr><br><table width='100%' align='center'><tbody><tr>"
    +"<td width='25%' align='center'></td>"
    +"<td width='25%' align='center'><a href='https://itch.io/profile/laurentk' target='_blank'>LaurentK</a></td>"
    +"<td width='25%' align='center'>Argosa</td>"
    +"<td width='25%' align='center'></td>"
    +"</tr></tbody></table><br><br><p><a href='https://www.patreon.com/kirill_live' target='_blank'><svg height='40' width='198' viewBox='0 0 1000 200' xmlns='http://www.w3.org/2000/svg'><path d='M0 0h1000v200H0z' fill='#FF424D'/><path d='M310 129V72h19c7 0 12 1 15 4 4 2 5 6 5 11 0 3 0 5-2 7-1 3-3 4-6 5a13 13 0 0110 13c0 6-2 10-6 13-3 2-8 4-14 4zm10-26v18h11l7-2c2-2 3-4 3-7 0-6-3-9-9-9zm0-7h10l7-2c2-2 2-4 2-6 0-3 0-5-2-6l-8-2h-9zm58 34c-6 0-11-2-14-6-4-4-6-9-6-15v-1l2-12c2-3 4-6 7-7 3-2 6-3 10-3 6 0 10 2 13 5 4 4 5 9 5 16v4h-27c0 3 1 6 3 8s5 3 8 3c4 0 8-2 10-5l5 5-6 6zm-1-37c-3 0-5 1-6 3-2 2-3 5-3 8h18v-1c0-3-1-5-3-7-1-2-3-3-6-3zm43 29l6-2 2-5h9l-2 7-7 6-8 2c-6 0-11-2-14-6-4-4-5-9-5-16v-1c0-6 1-12 5-15 3-4 8-6 14-6 5 0 9 1 12 4s5 7 5 12h-9l-2-6-6-3c-3 0-6 2-7 4-2 2-3 5-3 10v1c0 5 1 8 3 11 1 2 4 3 7 3zm23-15c0-4 0-8 2-11s4-6 7-7c3-2 6-3 10-3 6 0 11 2 14 5 4 4 6 9 6 15v2c0 4-1 8-3 11-1 4-3 6-6 8s-7 3-11 3c-6 0-10-2-14-6s-5-10-5-16zm9 1c0 5 1 8 3 10 2 3 4 4 7 4s6-1 8-4c2-2 2-6 2-11 0-4 0-7-2-10-2-2-5-4-8-4s-5 2-7 4c-2 3-3 6-3 11zm47-21v4c3-3 7-5 12-5 6 0 10 2 12 6 3-4 7-6 13-6 5 0 8 1 10 4 3 2 4 6 4 11v28h-10v-28l-1-6-6-1-6 1-2 5v29h-10v-28c0-5-3-7-8-7-3 0-6 1-8 4v31h-9V87zm79 43c-6 0-11-2-15-6-3-4-5-9-5-15v-1l2-12c2-3 4-6 7-7 3-2 6-3 10-3 6 0 10 2 13 5 4 4 5 9 5 16v4h-28l4 8c2 2 5 3 8 3 4 0 8-2 10-5l5 5-6 6zm-1-37c-3 0-5 1-6 3-2 2-3 5-3 8h18v-1c-1-3-1-5-3-7-1-2-3-3-6-3zm71 36l-1-4c-3 3-7 5-12 5-4 0-7-2-10-4s-4-5-4-9 2-8 5-10c3-3 8-4 14-4h6v-3c0-2 0-4-2-5l-5-2-6 2-2 4h-9l2-7 6-4c3-2 6-2 9-2 5 0 9 1 12 4 3 2 5 6 5 10v19l1 9v1zm-11-7l5-1 4-4v-8h-5l-8 2c-2 1-2 3-2 5l1 4zm59-14v21h-10V72h22c7 0 12 2 15 5 4 3 6 8 6 13 0 6-2 10-6 13-3 3-8 5-15 5zm0-8h12c4 0 6-1 8-3 2-1 3-4 3-7s-1-5-3-7-4-3-7-3h-13zm66 29l-1-4c-3 3-7 5-11 5s-8-2-11-4c-2-2-4-5-4-9s2-8 5-10c4-3 9-4 15-4h6v-3l-2-5-6-2-5 2c-2 1-2 2-2 4h-10c0-3 1-5 3-7 1-2 3-3 6-4 2-2 5-2 9-2 5 0 9 1 12 4 2 2 4 6 4 10v19l2 9v1zm-10-7l5-1 4-4v-8h-6l-8 2-2 5c0 2 0 3 2 4 1 1 2 2 5 2zm40-46v11h7v7h-7v23l1 4 3 1 4-1v8l-7 1c-7 0-11-4-11-12V94h-7v-7h7V76zm37 19h-4c-5 0-7 2-9 5v29h-9V87h9v4c2-3 5-5 9-5h4zm4 12l2-11c2-3 4-6 7-7 3-2 7-3 11-3 5 0 10 2 13 5 4 4 6 9 6 15v2l-2 11c-2 4-4 6-7 8s-6 3-10 3c-6 0-11-2-15-6-3-4-5-10-5-16zm9 1c0 5 1 8 3 10 2 3 4 4 8 4 3 0 5-1 7-4 2-2 3-6 3-11 0-4-1-7-3-10-2-2-4-4-7-4-4 0-6 2-8 4-2 3-3 6-3 11zm47-21v4c3-3 8-5 13-5 8 0 13 5 13 15v28h-9v-28l-2-5c-1-2-3-2-6-2-4 0-7 1-8 5v30h-10V87z' fill='#fff'/><path d='M165 39c-25 0-45 21-45 46s20 46 45 46 45-21 45-46-20-46-45-46' fill='#fff'/><path d='M83 161V39h23v122z' fill='#fff'/></svg></a></p></div></div>"
    modal_window("open",html);
}
function build(){
    let story_build=JSON.parse(JSON.stringify(story_script));
    var plugins_file="";
    var plugins_code=" ";
    if(story_script.parameters.plugins){for(var i=0;i<story_script.parameters.plugins.length;i++){
        if(plugins_list[story_script.parameters.plugins[i]]){
            if (plugins_list[story_script.parameters.plugins[i]].code){plugins_code+=plugins_list[story_script.parameters.plugins[i]].code+" "}
            else if(plugins_list[story_script.parameters.plugins[i]].file){plugins_file+="<script type='text/javascript' src='"+plugins_list[story_script.parameters.plugins[i]].file+"'><\/script>"}
        }else{plugins_file+=((plugins_list[story_script.parameters.plugins[i]])?"<script type='text/javascript' src='"+plugins_list[story_script.parameters.plugins[i]].file+"'><\/script>":"<script type='text/javascript' src='"+story_script.parameters.plugins[i]+"'><\/script>")}
    }}
    var fonts=""
    if(story_build.parameters.font_files){for(var i=0;i<Object.keys(story_build.parameters.font_files).length;i++){fonts+="@font-face{font-family:"+Object.keys(story_build.parameters.font_files)[i]+";src:url("+story_build.parameters.font_files[Object.keys(story_build.parameters.font_files)[i]]+");} "}}
    var par=[((story_script.parameters.font)?story_script.parameters.font:0),((story_script.parameters.font_size)?story_script.parameters.font_size:0),((story_script.parameters.icon)?story_script.parameters.icon:0)]
    delete story_build.parameters['plugins'];
    delete story_build.parameters['font'];
    delete story_build.parameters['font_size'];
    delete story_build.parameters['icon'];
    delete story_build.parameters.font_files;
    delete story_build.blocks;
    var story_preview=JSON.stringify(story_build)
    var dataStr="data:text/json;charset=utf-8,"+encodeURIComponent("<html><head>"+((par[2]!=0)?"<link rel='shortcut icon' href='"+par[2]+"' type='image/x-icon'>":"")+"<style>"+fonts+" "+((par[0]!=0)?"*{font-family:"+par[0]+";} ":"")+"body {"+((par[1]!=0)?"font-size:"+par[1]:"")+"; background-color:#fff; border-collapse:collapse; border:none; margin:0; padding:0; border:0; border-spacing:0px; -webkit-touch-callout:none; -webkit-user-select:none; -khtml-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;}<\/style><\/head><body><div id='tuesday' style='width:100%; height:100vh;'> <\/div><script type='text/javascript'>"+runtime+plugins_code+"<\/script>"+plugins_file+"<script>let story_novel="+story_preview+"; load_story('data',story_novel); <\/script><\/body><\/html>");
    var dlAnchorElem=document.getElementById('downloadAnchorElem');
    dlAnchorElem.setAttribute("href",dataStr);
    dlAnchorElem.setAttribute('download','index.html');
    dlAnchorElem.click();
    toast("index.html file is created");
}
function jsonedit(arr){
	if(arr){var html="<div class='window' style='padding:24px 8px; width:75vw;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>JSON Edit</p><br><p><textarea id='editJson' class='input_text' wrap='off' style='font-family:monospace;resize:none; padding-left:0px; height:calc(90vh - 128px); width:100%; border:1px solid var(--cb);'>"+JSON.stringify(arr_l[arr_n],null,'\t')+"</textarea></p><br><table class='big_button' width='256px' onclick='arr_l[arr_n]=JSON.parse(editJson.value);update_novel();modal_window(\"close\");toast(\"script updated\");add_element.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"}
    else{var html="<div class='window' style='padding:24px 8px; width:75vw;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>JSON Edit</p><br><p><textarea id='editJson' class='input_text' wrap='off' style='font-family:monospace;resize:none; padding-left:0px; height:calc(90vh - 128px); width:100%; border:1px solid var(--cb);'>"+JSON.stringify(story_script,null,'\t')+"</textarea></p><br><table class='big_button' width='256px' onclick='story_script=JSON.parse(editJson.value);update_novel();modal_window(\"close\");toast(\"script updated\");'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"}
    modal_window("open",html);
}
function big_languares(s){
    var lang='';
    for(l=0;l<Object.keys(languares).length;l++){lang+="<option value='"+languares[Object.keys(languares)[l]]+"' "+((languares[Object.keys(languares)[l]]==s)?"selected":"")+">"+languares[Object.keys(languares)[l]].toUpperCase()+" - "+Object.keys(languares)[l]+"</option>"}
    return lang;
}
function new_project(){
    scen_editor_apply();
    new_novel();
    var html="<div class='window' style='padding:24px 8px; width:360px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>New project</p><hr><br><div style='overflow-x:hidden; overflow-y:auto; width:100%; max-height:60vh;'>"
        +"<p align='left' style=' margin-left:8px;'>Project folder/location</p>"
        +"<table style='width:100%;'><tbody><tr><td><input id='project_foler' onclick=\"load_new=true;json_file.click()\" class='input_text' style='padding-top:10px;' type='text'></td><td onclick=\"load_new=true;json_file.click()\" style='width:40px; cursor:pointer;' title='delet' class='icon icon_load'></td></tr></tbody></table><p class='text_tutorials_b select_tutorials'>"+texts.tutorials[3].en+"</p><br><br>"
        +"<p align='left' style=' margin-left:8px;'>Name project</p><table id='new_title'><tbody>"
        +"<tr><td style='padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;'><select class='input_text title_lang'>"+big_languares()+"</select></td><td><input class='title_name input_text' placeholder='translated title' style='padding-top:10px;' type='text' value='"+
        story_script.parameters.title.en+"'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"
        +"</tbody></table><div onclick=\"add_tr('new_title')\" class='icon icon_add' style='margin-top:16px;height:26px; width:26px; cursor:pointer;'></div>"
        +"</div><br><br><table class='big_button' width='256px' onclick='create_project()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Create project</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function create_project(){
    li_n=document.getElementsByClassName("title_lang");
    li_v=document.getElementsByClassName("title_name");
    story_script.parameters.title={};
    story_script.parameters.languares=[];
    for(var i=0;i<li_n.length;i++){
        story_script.parameters.title[li_n[i].value]=li_v[i].value
        story_script.parameters.languares.push(li_n[i].value);
    }
    modal_window("close");
}
function new_block(){
	var html="<div class='window' style='padding:24px 8px; width:360px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>New story block</p><hr><br>"
		+"<form id='color_chec'><table style='width:100%;  border-spacing:10px; border-collapse:separate;'><tbody><tr><td style='width:50px' align='right'>block id </td><td align='left'><input autofocus id='block_id' value='block "+(Object.keys(story_script).length-1)+"' class='input_text' type='text'></td></tr></tbody></table><br><p style=':14px; margin-left:12px;' align='left'>color block</p><br><table style='border-spacing:4px; border-collapse:separate;'><tbody><tr>"
		+"<td class='color_select' style='background-color:"+color_bg[0]+";'><input class='checkbox_b' type='radio' name='color' value='0'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[1]+";'><input class='checkbox_b' type='radio' name='color' value='1'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[2]+";'><input class='checkbox_b' type='radio' name='color' value='2'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[3]+";'><input class='checkbox_b' type='radio' name='color' value='3'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[4]+";'><input class='checkbox_b' type='radio' name='color' value='4'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[5]+";'><input class='checkbox_b' type='radio' name='color' value='5'></td>"
		+"<td class='color_select' style='background-color:#fbfbfb;'><input class='checkbox_b' type='radio' name='color' value='6'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[7]+";'><input class='checkbox_b' type='radio' name='color' value='7'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[8]+";'><input class='checkbox_b' type='radio' name='color' value='8'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[9]+";'><input class='checkbox_b' type='radio' name='color' value='9'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[10]+";'><input class='checkbox_b' type='radio' name='color' value='10'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[11]+";'><input class='checkbox_b' type='radio' name='color' value='11'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[12]+";'><input class='checkbox_b' type='radio' name='color' value='12'></td>"
		+"</tr></tbody></table></form><br><br><table class='big_button' width='256px' onclick='create_block()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Create block</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function create_block(){
	var color_chec= document.forms.color_chec;
	for(i=0;i<color_chec.length;i++){
		if(color_chec[i].checked){
		color_chec=color_bg[color_chec[i].value]
		break;}
	}
    var new_id=correct_name(block_id.value);
	if(new_id!=''&&!story_script[new_id]){
		if(Object.keys(story_script).length<=2){story_script.parameters.launch_story=new_id}
		story_script[new_id]=[];
		for(var i=0 ;i<Object.keys(story_script).length;i++){if(Object.keys(story_script)[i]==new_id){creation_block(i);break;}}
		new_id=document.getElementById(new_id)
		var rect=new_id.getBoundingClientRect();
		new_id.style.backgroundColor=color_chec;
		new_id.style.left=html.scrollLeft+((html.clientWidth/2)-(rect.width/2))+"px";
        new_id.style.top=html.scrollTop+((html.clientHeight/2)-(rect.height/2))+"px";
		new_id.style.animation="flash 2s 1";
		new_id.style.WebkitAnimation="flash 2s 1";
		control_dlock()
		toast("new block created");
		modal_window('close');
    } else if(story_script[new_id]){
        toast("this name is used by other blocks");
        modal_window('close');
    }else{
        toast("block id not entered");
        modal_window('close');
    }
    story_script.blocks[new_id.id]=[new_id.style.left,new_id.style.top,document.getElementById(new_id.id+"_content").style.display,new_id.style.backgroundColor]
}
function edit_block(id){
	var html="<div class='window' style='padding:24px 8px; width:360px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>New story block</p><hr>"
		+"<form id='color_chec'><table style='width:100%;  border-spacing:10px; border-collapse:separate;'><tbody><tr><td style='width:50px' align='right'>block id </td><td align='left'><input autofocus id='block_id' class='input_text' type='text' value="+id+"></td></tr></tbody></table><br><p style=' margin-left:12px;' align='left'>color block</p><br><table style='border-spacing:4px; border-collapse:separate;'><tbody><tr>"
		+"<td class='color_select' style='background-color:"+color_bg[0]+";'><input class='checkbox_b' type='radio' name='color' value='0'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[1]+";'><input class='checkbox_b' type='radio' name='color' value='1'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[2]+";'><input class='checkbox_b' type='radio' name='color' value='2'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[3]+";'><input class='checkbox_b' type='radio' name='color' value='3'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[4]+";'><input class='checkbox_b' type='radio' name='color' value='4'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[5]+";'><input class='checkbox_b' type='radio' name='color' value='5'></td>"
		+"<td class='color_select' style='background-color:#fbfbfb;'><input class='checkbox_b' type='radio' name='color' value='6'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[7]+";'><input class='checkbox_b' type='radio' name='color' value='7'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[8]+";'><input class='checkbox_b' type='radio' name='color' value='8'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[9]+";'><input class='checkbox_b' type='radio' name='color' value='9'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[10]+";'><input class='checkbox_b' type='radio' name='color' value='10'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[11]+";'><input class='checkbox_b' type='radio' name='color' value='11'></td>"
		+"<td class='color_select' style='background-color:"+color_bg[12]+";'><input class='checkbox_b' type='radio' name='color' value='12'></td>"
		+"</tr></tbody></table></form><br><br><table class='big_button' width='256px' onclick='delet_block(\""+id+"\")'><tbody><tr><td width='42px' class='icon icon_del'></td><td align='center'>Delet block</td><td width='42px'></td></tr></tbody></table><br><table class='big_button' width='256px' onclick='updata_block(\""+id+"\")'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Update block</td><td width='42px'></td></tr></tbody></table> </div>";
    modal_window("open",html);
}
function delet_block(id){
	delete story_script[id];
	update_novel();
	toast("block removed");
	modal_window ('close');
}
function updata_block(old_id){
	var color_chec= document.forms.color_chec;
	for(i=0;i<color_chec.length;i++){
		if(color_chec[i].checked){
		story_script.blocks[old_id][3]=color_bg[color_chec[i].value]
		document.getElementById(old_id).style.backgroundColor=color_bg[color_chec[i].value]
		break;}
	}
	var new_id=correct_name(block_id.value);
	if(old_id!=new_id&&!story_script[new_id]){
		var story_rename=JSON.stringify(story_script)
		new_novel();
		story_script=JSON.parse(story_rename.replace(new RegExp('"'+old_id+'"',"g"),'"'+new_id+'"'));
		parse_story();
		lines();
		toast("block updated");
    } else if(story_script[new_id]){toast("this name is used by other blocks");}
	modal_window ('close');
}
function file_catalog(id,files,area,preview,arr){
    var code='<div class="window" style="width:480px; position:fixed;"><table style="width:100%;"><tbody><tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">File selection</td></tr><tr><td><div style="overflow-x:hidden;overflow-y:auto;max-height:80vh;"><table style="width:100%;"><tbody>'
    var f,t,a;
    if (id.indexOf('artt')>-1){
        a=id.replace("artt","art")
    }else{a=''}
    if(files=='img'){
        files=['.jpg','.svg','.gif','.jpeg','.png','.webp','.apng','.bmp'];
        for(f=0;f<project_files.length;f++){
            for(t=0;t<files.length;t++){
                if(project_files[f][0].indexOf(files[t])>-1){
                    code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="'+((a.length>1)?a+'.src=\''+project_files[f][1]+'\';':'')+' '+arr+'=\''+project_files[f][0]+'\';'+area+'.value=\''+project_files[f][0]+'\';'+((preview!=0)?preview+'.style.backgroundImage=\'url('+project_files[f][1]+')\'':'')+';add_element.style.visibility=\'hidden\';"><table style="margin:4px;"><tbody><tr><td width="64px" height="64px" style=\'border-radius:8px;background-image:url(\"'+project_files[f][1]+'\");background-size:cover;background-repeat:no-repeat;background-position:center;\'></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                }
            }
        }
    }
    else if(files=='audio'){
        files=['audio/mpeg'];
        for(f=0;f<project_files.length;f++){
            for(t=0;t< files.length;t++){
                if(project_files[f][2].indexOf(files[t])>-1){
                    code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="var n='+((id!='files_auio')?'add_audio(\''+project_files[f][0]+'\')':'\''+project_files[f][0]+'\'')+';'+arr+'=n;'+area+'.value=n;add_element.style.visibility=\'hidden\';'+((preview=='update')?'update_novel();':'')+'"><table style="margin:4px;"><tbody><tr><td width="40px" height="40px" class="icon_m icon_audio_play"></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                }
            }
        }
    }else{
        files=[files];
        for(f=0;f<project_files.length;f++){
            for(t=0;t<files.length;t++){
                if(project_files[f][0].indexOf(files[t])>-1){
                    code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="'+arr+'=\''+project_files[f][0]+'\';'+area+'.value=\''+project_files[f][0]+'\';add_element.style.visibility=\'hidden\';"><table style="margin:4px;"><tbody><tr><td width="40px" height="40px" class="icon_m icon_new"></td><td style="padding:0px 8px;">'+project_files[f][0]+'</td></tr></tbody></table></td></tr>'
                }
            }
        }
    }
    code+='</tbody></table></div></td></tr><tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="52px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr></tbody></table></div>'
    var rect=document.getElementById(id).getBoundingClientRect();
    menu_file=document.getElementById('add_element');
    menu_file.style.visibility='visible';
    menu_file.innerHTML=code
    menu_file.style.top=html.scrollTop+50+"vh";
    menu_file.style.left=html.scrollLeft+rect.right-280+"px";
}
function add_audio(d){
    n=d.split("/")[d.split("/").length-1]
    if (!story_script.parameters.sounds[n]){story_script.parameters.sounds[n]=d}
    return n
}
function add_element_b(id,arr){
    var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Add to block \''+arr+'\'</td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scene_add(\''+arr+'\');add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_art"></td><td>Scene</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="'+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?'legacy_choice_add(\''+arr+'\')':'setup();set_menu(5);')+';add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_choice"></td><td>Legacy choice</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code)
}
function add_element_s(id,n){
    var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Add to scene '+n+'</td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_textadd"></td><td>Add dialog</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="back_to";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_back"></td><td>back to</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="go_to";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_goto"></td><td>go to</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="event";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_event"></td><td>event</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="controll";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_controll"></td><td>interface</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\' '+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?'dialog_add();arr_l=arr_l[arr_n];arr_n="variables";element_to();':'setup();set_menu(5);')+' add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_var"></td><td>variables</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'sound\';element_to();dialog_audio_edit(\''+id+'\');"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_play"></td><td>play sound</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'sound_stop\';element_to();dialog_audio_edit(\''+id+'\');"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_off"></td><td>stop sound</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];arr_n="text";element_to();dialog_text_edit();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_text"></td><td>text</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'html\';edit_html();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_html"></td><td>HTML code</td></tr></tbody></table></td></tr>'
                //+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'dialog_add();arr_l=arr_l[arr_n];add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_art"></td><td>art</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'choice\';element_to();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_choice"></td><td>choice</td></tr></tbody></table></td></tr>'
                +((story_script.parameters.plugins)?((story_script.parameters.plugins.includes("show_toast"))?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_add();arr_l=arr_l[arr_n];arr_n=\'toast\';edit_toast();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_toast"></td><td>Toast</td></tr></tbody></table></td></tr>':''):'')
                +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code)
}
function add_element_d(id,n){
    var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Add element to dialog '+n+'</td></tr>'
				+((arr_l.back_to)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="back_to";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_back"></td><td>back to</td></tr></tbody></table></td></tr>')
				+((arr_l.go_to)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="go_to";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_goto"></td><td>go to</td></tr></tbody></table></td></tr>')
				+((arr_l.event)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="event";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_event"></td><td>event</td></tr></tbody></table></td></tr>')
				+((arr_l.controll)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="controll";element_to();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_controll"></td><td>interface</td></tr></tbody></table></td></tr>')
				+((arr_l.variables)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\' '+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?'arr_n="variables";element_to();':'setup();set_menu(5);')+' add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_var"></td><td>variables</td></tr></tbody></table></td></tr>')
				+((arr_l.sound)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="sound";element_to();dialog_audio_edit("'+id+'");\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_play"></td><td>play sound</td></tr></tbody></table></td></tr>')
				+((arr_l.sound_stop)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="sound_stop";element_to();dialog_audio_edit("'+id+'");\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_audio_off"></td><td>stop sound</td></tr></tbody></table></td></tr>')
				+((arr_l.text||arr_l.text_add)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="text";element_to();dialog_text_edit();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_text"></td><td>text</td></tr></tbody></table></td></tr>')
				+((arr_l.text||arr_l.text_add)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'arr_n="text_add";element_to();dialog_text_edit();add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_textadd"></td><td>text add</td></tr></tbody></table></td></tr>')
                +((arr_l.html)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'html\';edit_html();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_html"></td><td>HTML code</td></tr></tbody></table></td></tr>')
				//+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick=\'add_element.style.visibility="hidden";\'><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_art"></td><td>art</td></tr></tbody></table></td></tr>'
				+((arr_l.choice)?'':'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'choice\';element_to();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_choice"></td><td>choice</td></tr></tbody></table></td></tr>')
                +((story_script.parameters.plugins)?((!arr_l.toast&&story_script.parameters.plugins.includes("show_toast"))?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="arr_n=\'toast\';edit_toast();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_toast"></td><td>Toast</td></tr></tbody></table></td></tr>':''):'')
                +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code)
}
function dialog_m(id,n,block,i){
	var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody>'
              +'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Dialog '+n+'</td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scen_editor(\''+block+'\','+i+','+n+');scen_edit_data();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_layout"></td><td>Scene edit</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="duplicat_arr();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copu"></td><td>Duplicate</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="element_del();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
              +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
              +'</tbody></table></div>'
	menu_view(id,code)
}
function legacy_choice_m(id){
    var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Legacy choice</td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="legacy_choice_edit();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="element_del();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code)
}
function scene_m(id,i,block){
    var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody>'
				+'<tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">Scene '+i+'</td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scene_edit();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
				+((story_script[block][i-1].dialogs[0])?'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="scen_data[1]='+(i-1)+';scen_editor(\''+block+'\',scen_data[1],1);scen_edit_data();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_layout"></td><td>Scene edit</td></tr></tbody></table></td></tr>':'')
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="duplicat_arr();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_copu"></td><td>Duplicate</td></tr></tbody></table></td></tr>'
                +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="element_del();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
				+'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
				+'</tbody></table></div>'
	menu_view(id,code)
}
function dialog_el(id,n,e){
    var code='<div class="window" style="width:220px;"><table style="width:100%;"><tbody><tr><td style="height:40px;border-radius:16px 16px 0 0;border-bottom:1px solid var(--cb);" align="center">'+n+'</td></tr>'
        if(e){
            if(arr_n=='html'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="edit_html();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            } else if(arr_n=='text'||arr_n=='text_add'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_text_edit();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            } else if(arr_n=='variables'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="variables_set_edit();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            } else if (arr_n=='toast'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="edit_toast();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            } else if (arr_n=='choice'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="edit_choice();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            } else if (arr_n=='sound'||arr_n=='sound_stop'){
                code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="dialog_audio_edit(\''+id+'\');"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_edit2"></td><td>Edit</td></tr></tbody></table></td></tr>'
            }
        }
        code+='<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="jsonedit(true);add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_json"></td><td>JSON</td></tr></tbody></table></td></tr>'
        +'<tr><td class="add_el" style="border-bottom:1px solid var(--cb);" onclick="delete arr_l.name;element_dialog_del();add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_del"></td><td>Delete</td></tr></tbody></table></td></tr>'
        +'<tr><td class="add_el" style="border-radius:0 0 16px 16px;" onclick="add_element.style.visibility=\'hidden\';"><table><tbody><tr><td width="40px" height="26px" class="icon_m icon_close"></td><td>Cancel</td></tr></tbody></table></td></tr>'
        +'</tbody></table></div>'
	menu_view(id,code)
}
let arr_l;
let arr_n;
function menu_view(id,code){
	var rect=document.getElementById(id).getBoundingClientRect();
	menu_add=document.getElementById('add_element');
    menu_add.style.visibility='visible';
	menu_add.innerHTML=code;
    menu_add.style.top=html.scrollTop+rect.top+"px";
    menu_add.style.left=html.scrollLeft+rect.right+20+"px";
}
function scene_add(arr){
	story_script[arr].push({"background_image":"","background_music":"","dialogs":[]});
	arr_l=story_script[arr]
	arr_n=story_script[arr].length-1
	scene_edit();
	update_novel();
}
function legacy_choice_add(arr){
	story_script[arr].push({"legacy_choice":[["","=",0,""],{"go_to":""}]});
	arr_n=story_script[arr].length-1
	arr_l=story_script[arr]
	legacy_choice_edit()
}
function option_var(d){
	var var_list='';
	if(story_script.parameters.variables){for(l=0;l<Object.keys(story_script.parameters.variables).length;l++){var_list+="<option value='"+Object.keys(story_script.parameters.variables)[l]+"' "+((d==Object.keys(story_script.parameters.variables)[l])?"selected" :"")+">"+Object.keys(story_script.parameters.variables)[l]+"</option>"}}
	return var_list
}
function project_languares(d){
	var lang='';
	for(l=0;l<story_script.parameters.languares.length;l++){lang+="<option value='"+story_script.parameters.languares[l]+"' "+((d==story_script.parameters.languares[l])?"selected":"")+">"+story_script.parameters.languares[l].toUpperCase()+"</option>"}
	return lang
}
function option_block(d,g){
	var scene_list="";
    if(g>=1){scene_list+="<option value='tue_no' "+((d=="tue_no")?"selected":"")+">None</option><optgroup label='Story blocks'><option value='tue_go' "+((d=="tue_go")?"selected":"")+">Next scene</option>"} else {scene_list+="<optgroup label='Story blocks'>"}
    for(var l=0;l<Object.keys(story_script).length;l++){if(Object.keys(story_script)[l]!="parameters"&&Object.keys(story_script)[l]!="blocks"){scene_list+="<option value='"+Object.keys(story_script)[l]+"' "+((d==Object.keys(story_script)[l])?"selected":"")+">"+Object.keys(story_script)[l]+"</option>"}}
    if(g>=2){scene_list+='</optgroup><optgroup label="System function">';
        for(var s=0;s<Object.keys(button_name).length;s++){
            var y=true
            if(g==2){for(var f=0;f<story_script.parameters.buttons.length;f++){
                if(story_script.parameters.buttons[f].name==Object.keys(button_name)[s]){y=false;break;}
            }}
            if(y){scene_list+="<option value='"+Object.keys(button_name)[s]+"' "+((d==Object.keys(button_name)[s])?"selected":"")+">"+button_name[Object.keys(button_name)[s]]+"</option>"}
        }
    }
    scene_list+='</optgroup>'
    return scene_list
}
function legacy_choice_edit(){
	var var_if="<table width='100%' id='legacy_choice_edit'><tbody>";
	for(var i=0;i<arr_l[arr_n].legacy_choice.length-1;i++){
		var_if +="<tr><td style='padding-right:4px; white-space:nowrap;' align='right'>"+((i==0)?"if {":"else if {")+"</td>"
		+"<td style='width:128px;' valign='bottom'><select class='input_text legacy_var'>"+option_var(arr_l[arr_n].legacy_choice[i][0])+"</select></td>"
		+"<td style='width:24px; border-right:1px solid var(--cb); border-left:1px solid var(--cb);' valign='bottom'><select class='input_text legacy_compare'><option value='&#61'>&#61</option><option value='&lt;'>&lt;</option><option value='&gt;'>&gt;</option></select></td>"
		+"<td style='width:64px;' valign='bottom'><input class='input_text legacy_value' value='"+arr_l[arr_n].legacy_choice[i][2]+"' type='text'></td>"
		+"<td style='width:92px;font-size:12px;' align='center' valign='center'>} go to block:</td>"
		+"<td style='width:128px;' valign='bottom'><select class='input_text legacy_block'>"+option_block(arr_l[arr_n].legacy_choice[i][3],0)+"</select></td>"
		+"<td style='width:40px; cursor:pointer;' onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" title='delet' class='icon icon_del'></td>"
		+"</tr>";
	}
	var_if+="</tbody><tbody><tr><td style='width:40px;'>else</td><td colspan='5'><select id='legacy_go_to' class='input_text'>"+option_block(arr_l[arr_n].legacy_choice[i].go_to,0)+"</select></td><td style='width:40px;'></td></tr></tbody></table><div aling='center' onclick=\"legacy_choice_new()\" class='icon icon_add' style='margin-top:16px;height:26px; width:26px; cursor:pointer;'></div>"
    var html="<div class='window' style='padding:24px 8px; min-width:512px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>legacy choice edit</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[0].en+"</p><br><div style='max-height:70vh;overflow-x:hidden;overflow-y:auto;'>"+var_if+"</div><br><table class='big_button' width='256px' onclick='legacy_choice_apply()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
	modal_window("open",html);
}
function legacy_choice_new(){
	var tbody=document.getElementById('legacy_choice_edit').getElementsByTagName('tbody')[0];
	var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    var td4=document.createElement("td");
    var td5=document.createElement("td");
    var td6=document.createElement("td");
    var td7=document.createElement("td");
	td1.innerHTML="else if {";
	td1.style="padding-right:4px; white-space:nowrap;";
	td2.innerHTML="<select class='input_text legacy_var'>"+option_var()+"</select>";
	td2.setAttribute("valign","bottom");
	td3.innerHTML="<select class='input_text legacy_compare'><option value='&#61'>&#61</option><option value='&lt;'>&lt;</option><option value='&gt;'>&gt;</option></select>";
	td3.style="border-right:1px solid var(--cb); border-left:1px solid var(--cb);";
	td3.setAttribute("valign","bottom");
	td4.innerHTML="<input class='input_text legacy_value' value='' type='text'>";
	td4.setAttribute("valign","bottom");
	td5.innerHTML="} go to block:";
    td5.style="font-size:12px;";
	td5.setAttribute("valign","center");
	td5.setAttribute("align","center");
	td6.innerHTML="<select class='input_text legacy_block'>"+option_block(story_script.parameters.launch_story,0)+"</select>";
	td6.setAttribute("valign","bottom");
    td7.style="cursor:pointer;";
    td7.title="delet";
    td7.className="icon icon_del";
    td7.setAttribute("onclick","var a=this.closest('tr'); a.parentElement.removeChild(a);");
	row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
	row.appendChild(td4);
    row.appendChild(td5);
    row.appendChild(td6);
    row.appendChild(td7);
    tbody.appendChild(row);
}
function legacy_choice_apply(){
    arr_l[arr_n].legacy_choice=[];
    li_v=document.getElementsByClassName("legacy_var");
    li_c=document.getElementsByClassName("legacy_compare");
    li_z=document.getElementsByClassName("legacy_value");
    li_b=document.getElementsByClassName("legacy_block");
    for(var i=0;i<li_v.length;i++){if(li_z[i].value){arr_l[arr_n].legacy_choice.push([li_v[i].value,li_c[i].value,parseInt(li_z[i].value),li_b[i].value])}}
	arr_l[arr_n].legacy_choice.push({"go_to":legacy_go_to.value})
	modal_window('close')
	update_novel();
}
function duplicat_arr(){arr_l.splice(arr_n,0,JSON.parse(JSON.stringify(arr_l[arr_n])));update_novel();}
function element_del(){arr_l.splice(arr_n,1);update_novel();}
function element_dialog_del(){delete arr_l[arr_n];update_novel();}
function dialog_add(){arr_l.push({});arr_n=arr_l.length-1;update_novel();}
function element_to(){
	if(arr_n=='go_to'||arr_n=='back_to'){arr_l[arr_n]=story_script.parameters.launch_story;}
    else if(arr_n=='event'){arr_l[arr_n]="event"}
    else if(arr_n=='controll'){arr_l[arr_n]="visible"}
    else if(arr_n=='variables'){arr_l[arr_n]=[[Object.keys(story_script.parameters.variables)[0], "add", 1]];variables_set_edit()}
    else if(arr_n=='choice'){arr_l.choice=[];edit_choice();}
    else if(arr_n=='text'){arr_l.text={};for(var i=0;i<story_script.parameters.languares.length;i++){arr_l.text[story_script.parameters.languares[i]]='';}}
    else if(arr_n=='text_add'){arr_l.text_add={};for(var i=0;i<story_script.parameters.languares.length;i++){arr_l.text_add[story_script.parameters.languares[i]]='';}}
    else if(arr_n=='sound'){arr_l[arr_n]=""}
    else if(arr_n=='sound_stop'){arr_l[arr_n]=""}
	update_novel();
}
let copy_arr={};
function dialog_audio_edit(id){copy_arr=arr_l;file_catalog(id,'audio',id,'update','copy_arr[arr_n]');}
function dialog_text_edit(){
	copy_arr=JSON.parse(JSON.stringify(arr_l));
	if(!copy_arr.name){copy_arr.name={}}
    if(!copy_arr[arr_n][languare]){data_la(copy_arr,arr_n)}
	var html="<div class='window' style='padding:24px 8px; width:90%; max-width:800px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Dialog text</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[1].en+"</p>"
	+"<table width='100%'><tbody><tr><td width='80px' align='center'>languare:</td>"
	+"<td width='40px'><select class='input_text' id='text_la' onchange='name_text.value=copy_arr.name[this.value];dialogtext.value=copy_arr.text[this.value];text_сhars.innerHTML=dialogtext.value.length' style='height:40px; border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:0'>"+project_languares(languare)+"</select></td>"
	+"<td width='90px' align='center'>сharacters:</td><td id='text_сhars'>"+copy_arr[arr_n][languare].length+"</td><td></td></tr></tbody></table><table width='100%'><tbody><tr>"
	+"<td><textarea id='dialogtext' oninput='text_сhars.innerHTML=this.value.length;copy_arr[arr_n][text_la.value]=this.value;' class='input_text' style='resize:none;padding:4px;-moz-box-sizing:border-box; box-sizing:border-box;height:calc(90vh - 256px);width:100%;border:1px solid var(--cb);'>"+((copy_arr[arr_n][languare].length>0)?copy_arr[arr_n][languare]:'&nbsp;')+"</textarea></td>"
	+"<td width='286px' valign='top'><div style='width:100%;height:calc(90vh - 256px);overflow-x:hidden;overflow-y:auto;'><table width='100%'><tbody>"
	+"<tr><td width='80px' height='40px' align='left' style='padding-left:8px; border-bottom:1px solid var(--cb);' colspan='3'>Settings text panel</td></tr>"
    +"<tr><td height='40px' align='right' style='padding-right:8px;'>Text color</td><td><input id='text_color' class='input_text' value='"+((copy_arr.color_text)?copy_arr.color_text:"")+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px; width:40px;' onclick='color_element(\"text_color\",\""+copy_arr.name.color+"\");'></td></tr>"
    +"<tr><td height='40px' align='right' style='padding-right:8px;'>Panel color</td><td><input id='p_color' class='input_text' value='"+((copy_arr.color_text)?copy_arr.color:"")+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px; width:40px;' onclick='color_element(\"p_color\",\""+copy_arr.color+"\");'></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>Style</td><td><input id='text_style' class='input_text' value='"+((copy_arr[arr_n].style)?copy_arr[arr_n].style:"")+"' type='text'></td><td></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>ClassName</td><td><input id='text_class' class='input_text' value='"+((copy_arr[arr_n].className)?copy_arr[arr_n].className:"")+"' type='text'></td><td></td></tr>"
	+"<tr><td height='28px' align='left' colspan='3'></td></tr>"
	+"<tr><td height='40px' align='left' style='padding-left:8px; border-bottom:1px solid var(--cb);' colspan='3'>Settings name panel</td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>Character name</td><td><input id='name_text' class='input_text' oninput='copy_arr.name[text_la.value]=this.value;' value='"+((copy_arr.name[languare])?copy_arr.name[languare]:"")+"' type='text'></td><td class='icon icon_load'></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>Style</td><td><input id='name_style' class='input_text' value='"+((copy_arr.name.style)?copy_arr.name.style:"")+"' type='text'></td><td></td></tr>"
	+"<tr><td height='40px' align='right' style='padding-right:8px;'>ClassName</td><td><input id='name_class' class='input_text' value='"+((copy_arr.name.className)?copy_arr.name.className:"")+"' type='text'></td><td></td></tr>"
    +"<tr><td height='40px' align='right' style='padding-right:8px;'>Text color</td><td><input id='name_color' class='input_text' value='"+((copy_arr.name.color_text)?copy_arr.name.color_text:"")+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px; width:40px;' onclick='color_element(\"name_color\",\""+copy_arr.name.color_text+"\");'></td></tr>"
    +"<tr><td align='right' style='padding-right:8px;'>Panel color</td><td><input id='n_color' class='input_text' value='"+((copy_arr.name.color_text)?copy_arr.name.color:"")+"' type='text'></td>"
    +"<td class='icon icon_color' style='height:40px; width:40px;' onclick='color_element(\"n_color\",\""+copy_arr.name.color+"\");'></td></tr>"
    +"</tbody></table></div></td>"
	+"</tr></tbody></table><br><table class='big_button' width='256px' onclick='dialog_text_apply()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function dialog_text_apply(){
	if(text_style.value!=""){copy_arr[arr_n].style=text_style.value;}else{delete copy_arr[arr_n].style};
	if(text_class.value!=""){copy_arr[arr_n].className=text_class.value;}else{delete copy_arr[arr_n].className};
    if(text_color.value!=""){arr_l.color_text=text_color.value;}else{delete arr_l.color_text};
    if(p_color.value!=""){arr_l.color=p_color.value;}else{delete arr_l.color};
    data_only(copy_arr,'text');
	var a=0;
	for(var i=0;i<story_script.parameters.languares.length;i++){a+=((copy_arr.name[story_script.parameters.languares[i]])?copy_arr.name[story_script.parameters.languares[i]].length:0)};
	if(a>0){
		if(name_style.value!=""){copy_arr.name.style=name_style.value;}else{delete copy_arr.name.style}
		if(name_class.value!=""){copy_arr.name.className=name_class.value;}else{delete copy_arr.name.className}
        if(name_color.value!=""){copy_arr.name.color_text=name_color.value;}else{delete copy_arr.name.color_text};
        if(n_color.value!=""){copy_arr.name.color=n_color.value;}else{delete copy_arr.name.color};
		arr_l.name=JSON.parse(JSON.stringify(copy_arr.name));
	}else{delete arr_l.name}
	arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]));
	modal_window("close");
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2])}
    else{update_novel();}
}
function scene_edit(){
	copy_arr=JSON.parse(JSON.stringify(arr_l));
    if(!copy_arr[arr_n].background_image){copy_arr[arr_n].background_image=""}
    if(!copy_arr[arr_n].background_image[languare]){data_la(copy_arr[arr_n],'background_image')}
    var html="<div class='window' style='padding:24px 8px; width:640px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Settings scene</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[2].en+"</p><br><br>"
    +"<table width='100%' height='256px'><tbody><tr>"
    +"<td width='256px' id='scene_bg_preview' rowspan='6' style='border-radius:10px; background-color:var(--cw); background-image:url("+open_file((copy_arr[arr_n].background_image[languare])?copy_arr[arr_n].background_image[languare]:copy_arr[arr_n].background_image)+"); background-color:"+copy_arr[arr_n].background_color+"; background-size:cover; background-repeat:no-repeat; background-position:center;'>&nbsp;</td>"
    +"<td width='50px' align='right' style='height:28px;padding-right:8px;'>Image:</td>"
    +"<td style='width:40px;'><select class='input_text' id='scene_la' onchange='scene_bg_preview.style.backgroundImage=\"url(\"+open_file(copy_arr[arr_n].background_image[this.value])+\")\"; scene_bg_url.value=copy_arr[arr_n].background_image[this.value];' style='height:28px; width:40px; border-left:1px solid var(--cb); border-right:1px solid var(--cb);'>"+project_languares(languare)+"</select></td>"
    +"<td><input id='scene_bg_url' class='input_text' style='height:28px; width:100%;' oninput='copy_arr[arr_n].background_image[scene_la.value]=this.value;scene_bg_preview.style.backgroundImage=\"url(\"+open_file(copy_arr[arr_n].background_image[scene_la.value])+\")\";' value='"+((copy_arr[arr_n].background_image[languare].length>0)?copy_arr[arr_n].background_image[languare]:'&nbsp;')+"' type='text'></td>"
    +"<td id='files_img' class='icon icon_load' style='height:40px; width:40px;' onclick='file_catalog(\"scene_bg_url\",\"img\",\"scene_bg_url\",\"scene_bg_preview\",\"copy_arr[arr_n].background_image[scene_la.value]\")'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Music:</td>"
    +"<td colspan='2'><input id='scene_music' class='input_text' style='height:28px;' value='"+((copy_arr[arr_n].background_music)?copy_arr[arr_n].background_music:"")+"' type='text'></td>"
    +"<td id='files_auio' class='icon icon_load' style='height:40px; width:40px;' onclick='file_catalog(this.id,\"audio\",\"scene_music\",0,\"copy_arr[arr_n].background_music\")'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Color:</td>"
    +"<td colspan='2'><input id='scene_color' class='input_text' style='height:28px;' value='"+((copy_arr[arr_n].background_color)?copy_arr[arr_n].background_color:"")+"' type='text' onkeyup='scene_bg_preview.style.backgroundColor=this.value'></td>"
    +"<td class='icon icon_color' style='height:40px; width:40px;' onclick='color_element(\"scene_color\",\""+copy_arr[arr_n].background_color+"\")'></td>"
    +"</tr><tr>"
    +"<td width='50px' height='40px' align='right' style='padding-right:8px;'>Class:</td>"
    +"<td colspan='2'><input id='scene_class' class='input_text' style='height:28px;' value='"+((copy_arr[arr_n].background_class)?copy_arr[arr_n].background_class:"")+"' type='text'></td>"
    +"<td style='height:40px; width:40px;'></td>"
    +"</tr><tr>"
    +"<td>&nbsp;</td>"
    +"<td colspan='3'>&nbsp;</td>"
    +"</tr></tbody></table><br>"
	+"<table class='big_button' width='256px' onclick='scene_edit_apply();'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function scene_edit_apply(){
	if(copy_arr[arr_n].background_image){
        data_only(copy_arr[arr_n],'background_image');
        arr_l[arr_n].background_image=JSON.parse(JSON.stringify(copy_arr[arr_n].background_image));
    }
	if(scene_music.value!=""){arr_l[arr_n].background_music=scene_music.value;}else{delete arr_l[arr_n].background_music};
    if(scene_color.value!=""){arr_l[arr_n].background_color=scene_color.value;}else{delete arr_l[arr_n].background_color};
    if(scene_class.value!=""){arr_l[arr_n].background_class=scene_class.value;}else{delete arr_l[arr_n].background_class};
	modal_window("close");
    if(scene_screen){scen_editor(scen_data[0],scen_data[1],scen_data[2])}
    else{update_novel();}
}
function edit_html(){
    var html="<div class='window' style='padding:24px 8px; width:75vw;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>HTML code edit</p><br><p><textarea id='editHtml' class='input_text' wrap='off' style='font-family:monospace;resize:none; padding-left:0px; height:calc(90vh - 128px); width:100%; border:1px solid var(--cb);'>"+((arr_l[arr_n])?arr_l[arr_n]:'')+"</textarea></p><br><table class='big_button' width='256px' onclick='arr_l[arr_n]=editHtml.value;update_novel();modal_window(\"close\");add_element.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_toast(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    if(!copy_arr[arr_n]){copy_arr[arr_n]=""}
    if(!copy_arr[arr_n][languare]){data_la(copy_arr,arr_n)}
    var toast_list="<table width='90%' id='var_toast' style='margin:10px 0 10px 0;'><tbody>";
    for(var l=0;l<story_script.parameters.languares.length;l++){toast_list+="<tr><td align='center' style='width:40px;'>"+story_script.parameters.languares[l]+"</td><td style='calc(100% - 40px)'><input class='addon_path input_text' oninput='copy_arr[arr_n]."+story_script.parameters.languares[l]+"=this.value;' value='"+copy_arr[arr_n][story_script.parameters.languares[l]]+"' type='text'></td></tr>";}
    toast_list+="</tbody></table>"
    var html="<div class='window' style='padding:24px 8px;width:512px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Toast edit</p><br><hr style='margin:0;'><div style='max-height:75vh;overflow-x:hidden;overflow-y:auto;'>"+toast_list+"</div><br><table class='big_button' width='256px' onclick='data_only(copy_arr,arr_n);arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]));update_novel();modal_window(\"close\");add_element.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_choice(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    var choice_list="<table width='98%' id='var_choice' style='margin:10px 0 10px 0;'><tbody>";
        for(var l=0;l<copy_arr[arr_n].length;l++){
        if(!copy_arr[arr_n][l].text[languare]){data_la(copy_arr[arr_n][l],'text')}
        choice_list+="<tr><td style='width:32px;height:26px;'>Text</td><td valign='bottom' style='height:26px;width:28px;'><select id='chol"+l+"' class='input_text' onchange='cho"+l+".value=copy_arr."+arr_n+"["+l+"].text[this.value];' style='height:26px;width:30px;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);'>"+project_languares(languare)+"</select></td><td><input id='cho"+l+"' class='input_text' oninput='copy_arr."+arr_n+"["+l+"].text[chol"+l+".value]=this.value;' style='height:26px;' value='"+copy_arr[arr_n][l].text[languare]+"' type='text'></td><td style='width:64px;padding-right:8px;' align='right'>Position X</td><td style='width:48px;'><input class='input_text' style='height:26px;' oninput='copy_arr."+arr_n+"["+l+"].position[0]=this.value;' value='"+copy_arr[arr_n][l].position[0]+"' type='text'></td><td style='width:16px;' align='center'>Y</td><td style='width:48px;'><input class='input_text' oninput='copy_arr."+arr_n+"["+l+"].position[2]=this.value;' style='height:26px;' value='"+copy_arr[arr_n][l].position[2]+"' type='text'></td><td style='width:48px;' align='right'>go to:</td><td style='width:92px;'><select onchange='copy_arr."+arr_n+"["+l+"].go_to=this.value;' class='input_text'>"+option_block(copy_arr[arr_n][l].go_to,2)+"</select></td><td onclick='copy_arr."+arr_n+"["+l+"]={}; var a=this.closest(\"tr\"); a.parentElement.removeChild(a);' style='width:32px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"
    }
    choice_list+="</tbody></table>"
    var html="<div class='window' style='padding:24px 8px;width:568px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><p>Choice edit</p><br><hr style='margin:0;'><div style='max-height:70vh;overflow-x:hidden;overflow-y:auto;'>"+choice_list+"<div onclick=\"edit_choice_new()\" class='icon icon_add' style='margin-top:16px;height:26px; width:26px; cursor:pointer;'></div></div><br><br><table class='big_button' width='256px' onclick='for(var l=copy_arr[arr_n].length;l>=0;l--){if(!copy_arr[arr_n][l]||!copy_arr[arr_n][l].go_to){copy_arr[arr_n].splice(l,1);}else{data_only(copy_arr[arr_n][l],\"text\");}};arr_l[arr_n]=JSON.parse(JSON.stringify(copy_arr[arr_n]));update_novel();modal_window(\"close\");add_element.style.visibility=\"hidden\";'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function edit_choice_new(){
	var tbody=document.getElementById('var_choice').getElementsByTagName('tbody')[0];
    var l=copy_arr[arr_n].length;
    copy_arr[arr_n].push({"go_to":"tue_no","position":["50%","0","50%","0"],"size":[0,story_script.parameters.buttons[0].size[1]],"color":story_script.parameters.text_panel.color,"color_text":story_script.parameters.text_panel.color_text,"text":"button"});
    data_la(copy_arr[arr_n][l],'text')
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    var td4=document.createElement("td");
    var td5=document.createElement("td");
    var td6=document.createElement("td");
    var td7=document.createElement("td");
    var td8=document.createElement("td");
    var td9=document.createElement("td");
    var td10=document.createElement("td");
	td1.innerHTML="Text";
	td1.style="width:32px;height:26px;";
	td2.innerHTML="<select id='chol"+l+"' class='input_text choice_la' onchange='cho"+l+".value=copy_arr."+arr_n+"["+l+"].text[this.value];' style='height:26px;width:30px;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);'>"+project_languares(languare)+"</select>";
	td2.setAttribute("valign","bottom");
    td2.style="height:26px;width:28px;";
    td3.innerHTML="<input id='cho"+l+"' class='addon_path input_text' oninput='copy_arr."+arr_n+"["+l+"].text[chol"+l+".value]=this.value;' style='height:26px;' value='button' type='text'>";
    td4.innerHTML="Position X";
	td4.setAttribute("align","right");
    td4.style="width:64px;padding-right:8px;";
	td5.innerHTML="<input class='addon_path input_text' style='height:26px;' oninput='copy_arr."+arr_n+"["+l+"].position[0]=this.value;' value='50%' type='text'>";
	td5.setAttribute("valign","center");
    td5.style="height:26px;width:28px;";
    td6.innerHTML="Y";
	td6.setAttribute("align","center");
    td6.style="width:16px;";
    td7.innerHTML="<input class='addon_path input_text' style='height:26px;' oninput='copy_arr."+arr_n+"["+l+"].position[2]=this.value;' value='50%' type='text'>";
    td7.style="width:48px;";
    td8.innerHTML="go to:";
    td8.setAttribute("align","right");
    td8.style="width:48px;";
    td9.innerHTML="<select onchange='copy_arr."+arr_n+"["+l+"].go_to=this.value;' class='input_text'>"+option_block("tue_no",2)+"</select>";
    td9.style="width:92px;";
    td10.style="width:32px; cursor:pointer;";
    td10.title="delet";
    td10.className="icon icon_del";
    td10.setAttribute("onclick","copy_arr."+arr_n+"["+l+"]={};var a=this.closest('tr'); a.parentElement.removeChild(a);");
	row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
	row.appendChild(td4);
    row.appendChild(td5);
    row.appendChild(td6);
    row.appendChild(td7);
    row.appendChild(td8);
    row.appendChild(td9);
    row.appendChild(td10);
    tbody.appendChild(row);
}
let scen_data=[];
let scen_element={};
function scen_edit_data(){
    s_scene_edit.setAttribute("onclick","arr_l=story_script['"+scen_data[0]+"'];arr_n="+scen_data[1]+";scene_edit();");
    s_scene_text.setAttribute("onclick","if(!story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].text){story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"].text=''};arr_l=story_script."+scen_data[0]+"["+scen_data[1]+"].dialogs["+(scen_data[2]-1)+"];arr_n='text';dialog_text_edit();");
    size_w.value=((story_script.parameters.text_panel.size[0])?story_script.parameters.text_panel.size[0]:"")
    size_h.value=((story_script.parameters.text_panel.size[1])?story_script.parameters.text_panel.size[1]:"")
    className.value=((story_script.parameters.text_panel.className)?story_script.parameters.text_panel.className:"")
    style.value=((story_script.parameters.text_panel.style)?story_script.parameters.text_panel.style:"")
    if(story_script.parameters.text_panel.position){
        position_l.value=((story_script.parameters.text_panel.position[0])?story_script.parameters.text_panel.position[0]:0)
        position_r.value=((story_script.parameters.text_panel.position[1])?story_script.parameters.text_panel.position[1]:0)
        position_t.value=((story_script.parameters.text_panel.position[3])?story_script.parameters.text_panel.position[3]:0)
    }
    if(story_script.parameters.text_panel.color){
        color_t.value=story_script.parameters.text_panel.color
        color_t_b.value=story_script.parameters.text_panel.color
        color_t_s.style.backgroundColor=story_script.parameters.text_panel.color
    }else{color_t.value=""}
    if(story_script.parameters.text_panel.color_text){
        color_text.value=story_script.parameters.text_panel.color_text
        color_text_b.value=story_script.parameters.text_panel.color_text
        color_text_s.style.backgroundColor=story_script.parameters.text_panel.color_text
    }else{color_text.value=""}
    indent_bottom.value=((story_script.parameters.text_panel.indent_bottom)?story_script.parameters.text_panel.indent_bottom:"")
    indent_text.value=((story_script.parameters.text_panel.indent_text)?story_script.parameters.text_panel.indent_text:"")
    size_text.value=((story_script.parameters.text_panel.size_text)?story_script.parameters.text_panel.size_text:"")
    font_family.value=((story_script.parameters.font)?story_script.parameters.font:"")
    dialog_speed.value=((story_script.parameters.text_panel.dialog_speed)?story_script.parameters.text_panel.dialog_speed:"")
    n_size_w.value=((story_script.parameters.name_panel.size[0])?story_script.parameters.name_panel.size[0]:0)
    n_size_h.value=((story_script.parameters.name_panel.size[1])?story_script.parameters.name_panel.size[1]:0)
    if(story_script.parameters.name_panel.position){
        n_position_l.value=((story_script.parameters.name_panel.position[0])?story_script.parameters.name_panel.position[0]:0)
        n_position_r.value=((story_script.parameters.name_panel.position[1])?story_script.parameters.name_panel.position[1]:0)
        n_position_t.value=((story_script.parameters.name_panel.position[2])?story_script.parameters.name_panel.position[2]:0)
        n_position_b.value=((story_script.parameters.name_panel.position[3])?story_script.parameters.name_panel.position[3]:0)
    }
    n_className.value=((story_script.parameters.name_panel.className)?story_script.parameters.name_panel.className:"")
    n_style.value=((story_script.parameters.name_panel.style)?story_script.parameters.name_panel.style:"")
    n_indent_text.value=((story_script.parameters.name_panel.indent_text)?story_script.parameters.name_panel.indent_text:"")
    n_size_text.value=((story_script.parameters.name_panel.size_text)?story_script.parameters.name_panel.size_text:"")
    if(story_script.parameters.name_panel.color){
        n_color.value=story_script.parameters.name_panel.color
        n_color_b.value=story_script.parameters.name_panel.color
        n_color_s.style.backgroundColor=story_script.parameters.name_panel.color
    }else{n_color.value=""}
    if(story_script.parameters.name_panel.color_text){
        n_color_text.value=story_script.parameters.name_panel.color_text
        n_color_text_b.value=story_script.parameters.name_panel.color_text
        n_color_text_s.style.backgroundColor=story_script.parameters.name_panel.color_text
    }else{n_color_text.value=""}
}
function scen_edit_updare(show){
    if(!style.value==""){story_script.parameters.text_panel.style=style.value}else{delete story_script.parameters.text_panel.style};
    if(!size_w.value==""){story_script.parameters.text_panel.size[0]=correct_value(size_w.value)};
    if(!size_h.value==""){story_script.parameters.text_panel.size[1]=correct_value(size_h.value)};
    if(!className.value==""){story_script.parameters.text_panel.className=className.value}else{delete story_script.parameters.text_panel.className};
    story_script.parameters.text_panel.dialog_speed=dialog_speed.value;
    story_script.parameters.text_panel.position=[((position_l.value)?correct_value(position_l.value):0),((position_r.value)?correct_value(position_r.value):0),((position_t.value)?correct_value(position_t.value):0),0];
    if(!color_text.value==""){story_script.parameters.text_panel.color_text=color_text.value}else{delete story_script.parameters.text_panel.color_text};
    if(!color_t.value==""){story_script.parameters.text_panel.color=color_t.value}else{delete story_script.parameters.text_panel.color};
    if(!size_text.value==""){story_script.parameters.text_panel.size_text=correct_value(size_text.value)};
    if(!font_family.value==""){story_script.parameters.font=font_family.value}else{delete story_script.parameters.font};
    story_script.parameters.text_panel.indent_text=((indent_text.value)?correct_value(indent_text.value):0);
    story_script.parameters.text_panel.indent_bottom=((indent_bottom.value)?correct_value(indent_bottom.value):0);
    story_script.parameters.name_panel.position=[((n_position_l.value)?correct_value(n_position_l.value):0),((n_position_r.value)?correct_value(n_position_r.value):0),((n_position_t.value)?correct_value(n_position_t.value):0),((n_position_b.value)?correct_value(n_position_b.value):0)];
    story_script.parameters.name_panel.indent_text=((n_indent_text.value)?correct_value(n_indent_text.value):0);
    if(!n_className.value==""){story_script.parameters.name_panel.className=className.value}else{delete story_script.parameters.name_panel.className};
    if(!n_style.value==""){story_script.parameters.name_panel.style=n_style.value}else{delete story_script.parameters.name_panel.style};
    if(n_size_text.value!=""){story_script.parameters.name_panel.size_text=correct_value(n_size_text.value)};
    if(!n_size_w.value==""){story_script.parameters.name_panel.size[0]=correct_value(n_size_w.value)};
    if(!n_size_h.value==""){story_script.parameters.name_panel.size[1]=correct_value(n_size_h.value)};
    if(!n_color_text.value==""){story_script.parameters.name_panel.color_text=n_color_text.value}else{delete story_script.parameters.name_panel.color_text};
    if(!n_color.value==""){story_script.parameters.name_panel.color=n_color.value}else{delete story_script.parameters.name_panel.color};
    if(show){scen_editor(scen_data[0],scen_data[1],scen_data[2])}else{scen_element={};scen_editor_apply()}
}
var scene_scroll=false;
function scen_editor(block,i,n){
    if(scen_data[2]<n){
        if(i>=story_script[block].length-1){i=story_script[block].length-1;}
        if(!story_script[block][i].dialogs[n-1]){i+=1;n=1;}
        if(!story_script[block][i]||story_script[block][i].dialogs.length==0){i-=1;n=story_script[block][i].dialogs.length;toast('not scene')}
    } else if(scen_data[2]>n){if(!story_script[block][i].dialogs[n-1]){i-=1;n=story_script[block][i].dialogs.length;}}
    scen_data=[block,i,n];
    p_width.value=setup_editor.preview[0];
    ratio_screen.selectedIndex=setup_editor.preview[1];
    world.style.display="none";
    new_story_block.style.display="none";
    scene_maker.style.display="initial";
    scroll_block=true;
    scene_screen=true;
    scene_scroll=true;
    html.style.overflow="hidden"
    scrnr_title.innerHTML=block+" (scene:"+(i+1)+" | dialog:"+n+")"
    preview_size();
    scene_layout.style.backgroundImage="url("+open_file(languare_data(story_script[block][i].background_image))+")";
    scene_layout.style.backgroundColor=story_script[block][i].background_color;
    if(story_script[block][i].dialogs[n-1].text&&(typeof story_script[block][i].dialogs[n-1].text!=='object'||(story_script[block][i].dialogs[n-1].text[languare]&&typeof story_script[block][i].dialogs[n-1].text[languare]!=='object'))){
        tue_text_block.style.visibility='visible';
        tue_text_element.style.position="relative";
        if(story_script.parameters.text_panel.className){tue_text_block.className=story_script.parameters.text_panel.className;}else{tue_text_block.className=""};
        if(story_script.parameters.text_panel.style){tue_text_block.style=story_script.parameters.text_panel.style;}else{tue_text_block.style=null};
        tue_text_block.style.position="absolute";
        tue_text_block.style.margin="auto";
        tue_text_block.style.borderCollapse="separate";
        if(story_script.parameters.text_panel.size){
            tue_text_block.style.width=story_script.parameters.text_panel.size[0];
            tue_text_block.style.height=story_script.parameters.text_panel.size[1];
        }
        if(story_script.parameters.text_panel.position){
            tue_text_block.style.left=(story_script.parameters.text_panel.position[0]!=0)?story_script.parameters.text_panel.position[0]:"0";
            tue_text_block.style.right=(story_script.parameters.text_panel.position[1]!=0)?story_script.parameters.text_panel.position[1]:"0";
            if(story_script.parameters.text_panel.position[2]!=0){tue_text_block.style.top=story_script.parameters.text_panel.position[2];}
            if(story_script.parameters.text_panel.position[3]!=0){tue_text_block.style.bottom=story_script.parameters.text_panel.position[3];}
        }else{
            tue_text_block.style.left="0";
            tue_text_block.style.right="0";
        }
        if(story_script.parameters.text_panel.indent_bottom){tue_text_block.style.bottom=story_script.parameters.text_panel.indent_bottom;}
        tue_text_block.style.zIndex="1000";
        tue_text_block.style.borderSpacing="0";
        tue_text_block.style.zIndex=1998;
        tue_text_view=document.getElementById("tue_text_view");
        tue_text_view.style.padding=story_script.parameters.text_panel.indent_text;
        tue_text_view.style.fontSize=((story_script.parameters.text_panel.size_text)?story_script.parameters.text_panel.size_text:story_script.parameters.font_size);
        tue_text_view.style.height="100%";
        if(story_script[block][i].dialogs[n-1].name&&story_script.parameters.name_panel){
            if(story_script.parameters.name_panel.className){tue_name_block.className=story_script.parameters.name_panel.className;}else{tue_name_block.className=""};
            if(story_script.parameters.name_panel.style){tue_name_block.style=story_script.parameters.name_panel.style;}else{tue_name_block.style=null};
            if(story_script.parameters.name_panel.color){tue_name_block.style.backgroundColor=story_script.parameters.name_panel.color};
            if(story_script.parameters.name_panel.color_text){tue_name_block.style.color=story_script.parameters.name_panel.color_text}else{tue_name_block.style.color=null};
            tue_name_block.style.position="absolute";
            tue_name_block.style.padding=story_script.parameters.name_panel.indent_text;
            tue_name_block.style.fontSize=((story_script.parameters.name_panel.size_text)?story_script.parameters.name_panel.size_text:story_script.parameters.font_size);
            tue_name_block.style.textAlign="center";
            if(tue_name_block.style.width=story_script.parameters.name_panel.size[0]!=0){tue_name_block.style.width=story_script.parameters.name_panel.size[0];}
            tue_name_block.style.height=story_script.parameters.name_panel.size[1];
            tue_name_block.style.lineHeight=story_script.parameters.name_panel.size[1];
            if(story_script.parameters.name_panel.position[0]!=0){tue_name_block.style.left=story_script.parameters.name_panel.position[0];}
            if(story_script.parameters.name_panel.position[1]!=0){tue_name_block.style.right=story_script.parameters.name_panel.position[1];}
            if(story_script.parameters.name_panel.position[2]!=0){tue_name_block.style.top=story_script.parameters.name_panel.position[2];}
            if(story_script.parameters.name_panel.position[3]!=0){tue_name_block.style.bottom=story_script.parameters.name_panel.position[3];}
            tue_name_block.style.visibility='visible';
        }else{tue_name_block.style.visibility='hidden';}
        tue_text_block.style.backgroundColor=story_script.parameters.text_panel.color;
        tue_text_block.style.color=story_script.parameters.text_panel.color_text;
        tue_text_view.innerHTML=languare_data(story_script[block][i].dialogs[n-1].text);
        tue_name_block.innerHTML=languare_data(story_script[block][i].dialogs[n-1].name);
    }else{tue_text_block.style.visibility='hidden';tue_name_block.style.visibility='hidden';}
    button_panel_update();
    if(story_script[block][i].dialogs[n-1].art){art_panel_update(block,i,n);}else{arts_ec.innerHTML="";var tue_art=document.getElementsByClassName("tue_art");while(tue_art.length){scene_layout.removeChild(tue_art[0]);}}
    add_art.setAttribute('onclick','art_panel_add("'+block+'",'+i+','+n+')');
    if(story_script[block][i].dialogs[n-1].choice){choice_panel_update(block,i,n);}else{choice_ec.innerHTML="";var tue_choice=document.getElementsByClassName("tue_choice");while(tue_choice.length){scene_layout.removeChild(tue_choice[0]);}}
    add_choice.setAttribute('onclick','choice_panel_add("'+block+'",'+i+','+n+')');
}
function art_panel_update(block,i,n){
    droppFocus();
    arts_ec.innerHTML=""
    var tue_art=document.getElementsByClassName("tue_art");
    while(tue_art.length){scene_layout.removeChild(tue_art[0]);}
    for(var b=0;b<story_script[block][i].dialogs[n-1].art.length;b++){
        if(!story_script[block][i].dialogs[n-1].art[b].url[languare]){data_la(story_script[block][i].dialogs[n-1].art[b],'url')}
        var art=document.createElement("img");
        art.id='art'+b
        art.setAttribute('draggable','false');
        art.setAttribute('onclick','objSelect(this.id);arr_e=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+']');
        art.src=(story_script[block][i].dialogs[n-1].art[b].url[languare])?open_file(story_script[block][i].dialogs[n-1].art[b].url[languare]):open_file(story_script[block][i].dialogs[n-1].art[b].url)
        art.classList.add("tue_art");
        art.style="user-select:text;"+((story_script[block][i].dialogs[n-1].art[b].style)?story_script[block][i].dialogs[n-1].art[b].style:"")
        art.style.position="absolute";
        art.style.zIndex=1001+b;
        if(story_script[block][i].dialogs[n-1].art[b].fit)art.style.objectFit=story_script[block][i].dialogs[n-1].art[b].fit;
        if(story_script[block][i].dialogs[n-1].art[b].size){
            art.style.width=story_script[block][i].dialogs[n-1].art[b].size[0];
            art.style.height=story_script[block][i].dialogs[n-1].art[b].size[1];
        }
        if(story_script[block][i].dialogs[n-1].art[b].position[0]!=0){art.style.left=story_script[block][i].dialogs[n-1].art[b].position[0];}
        if(story_script[block][i].dialogs[n-1].art[b].position[1]!=0){art.style.right=story_script[block][i].dialogs[n-1].art[b].position[1];}
        if(story_script[block][i].dialogs[n-1].art[b].position[2]!=0){art.style.top=story_script[block][i].dialogs[n-1].art[b].position[2];}
        if(story_script[block][i].dialogs[n-1].art[b].position[3]!=0){art.style.bottom=story_script[block][i].dialogs[n-1].art[b].position[3];}
        scene_layout.appendChild(art);
        arts_ec.innerHTML+=art_panel_edit(block,i,n,b)
    }
}
function art_panel_add(block,i,n){
    if(!story_script[block][i].dialogs[n-1].art){story_script[block][i].dialogs[n-1].art=[]}
    story_script[block][i].dialogs[n-1].art.push({"position":["25%","0","25%","0"],"size":["auto","50%"],"url":"","fit":"contain"});
    b=story_script[block][i].dialogs[n-1].art.length-1;
    art_panel_update(block,i,n)
    file_catalog('artt'+b,'img','artt'+b,'artpre'+b,'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url')
}
function art_panel_edit(block,i,n,b){
    var html='<div class="ui_buttons dialog" style="margin:8px;"><table style="width:100%"><tbody><tr>'
            +'<td width="24px" class="icon_m icon_up"   onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art,'+b+',-1);art_panel_update(\''+block+'\','+i+','+n+');"height="22px"></td>'
            +'<td width="24px" class="icon_m icon_down" onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art,'+b+',1);art_panel_update(\''+block+'\','+i+','+n+');"></td><td>&nbsp;</td>'
            +'<td width="24px" class="icon icon_del" style="cursor:pointer;" onclick="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art.splice('+b+',1);art_panel_update(\''+block+'\','+i+','+n+');" ></td>'
    +'</tr><tr><td colspan="4" height="80px" align="center"><div id="artpre'+b+'" style="background-image:url('+((story_script[block][i].dialogs[n-1].art[b].url[languare])?open_file(story_script[block][i].dialogs[n-1].art[b].url[languare]):open_file(story_script[block][i].dialogs[n-1].art[b].url))+'); background-position:center; background-repeat:no-repeat; background-size:auto 100%; height:100%; width:100%";> </div></td></tr><tr>'
    +'<td class="icon_m icon_more" height="22px" onclick="block_open(\'artsp'+b+'\');scen_element.artsp'+b+'=artsp'+b+'.style.display;"></td><td colspan="3"></td></tr></tbody></table>'
    +'<table width="100%" id=artsp'+b+' style="display:'+((scen_element['artsp'+b])?scen_element['artsp'+b]:'none')+';border-top:1px solid var(--cb);margin-top:8px;"><tbody><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Art</td>'
        +'<td style="width:28px;" align="center"><select id="artl'+b+'" class="input_text" onchange="if(!story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[languare]){data_la(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'],\'url\')} ; artt'+b+'.value=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td ><input id="artt'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[artl'+b+'.value]=this.value;art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].art[b].url[languare])?story_script[block][i].dialogs[n-1].art[b].url[languare]:story_script[block][i].dialogs[n-1].art[b].url)+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'artt'+b+'\',\'img\',\'artt'+b+'\',\'artpre'+b+'\',\'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].url[artl'+b+'.value]\')"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Art width</td>'
        +'<td colspan="2"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].size[0]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+story_script[block][i].dialogs[n-1].art[b].size[0]+'"></td>'
        +'<td height="40px" align="right" rowspan="2"><input id="artp'+b+'" onchange="var f=(this.checked)?\'contain\':\'fill\';art'+b+'.style.objectFit=f;story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].fit=f;" type="checkbox" class="proportion_c" '+((story_script[block][i].dialogs[n-1].art[b].fit=='contain')?'checked':'')+'></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Art height</td>'
        +'<td colspan="2"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].size[1]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+story_script[block][i].dialogs[n-1].art[b].size[1]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Top position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[2]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+story_script[block][i].dialogs[n-1].art[b].position[2]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Left position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[0]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+story_script[block][i].dialogs[n-1].art[b].position[0]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Bottom position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[3]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+story_script[block][i].dialogs[n-1].art[b].position[3]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Right position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].position[1]=correct_value(this.value);art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+story_script[block][i].dialogs[n-1].art[b].position[1]+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Style CSS</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].style=this.value;art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].art[b].style)?story_script[block][i].dialogs[n-1].art[b].style:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Class Name</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].art['+b+'].className=this.value;art_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].art[b].className)?story_script[block][i].dialogs[n-1].art[b].className:'')+'"></td>'
    +'</tr></tbody></table></div>'
    return html;
}
function choice_panel_update(block,i,n){
    droppFocus();
    choice_ec.innerHTML=""
    var tue_choice=document.getElementsByClassName("tue_choice");
    while(tue_choice.length){scene_layout.removeChild(tue_choice[0]);}
    for(var b=0;b<story_script[block][i].dialogs[n-1].choice.length;b++){
        if(!story_script[block][i].dialogs[n-1].choice[b].text){story_script[block][i].dialogs[n-1].choice[b].text={}}
        if(!story_script[block][i].dialogs[n-1].choice[b].text[languare]){data_la(story_script[block][i].dialogs[n-1].choice[b],'text')}
        if(!story_script[block][i].dialogs[n-1].choice[b].art){story_script[block][i].dialogs[n-1].choice[b].art={}}
        if(!story_script[block][i].dialogs[n-1].choice[b].art[languare]){data_la(story_script[block][i].dialogs[n-1].choice[b],'art')}
        var choice=document.createElement("div");
        choice.id='cho'+b
        choice.setAttribute('onclick','objSelect(this.id);arr_e=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+']');
        if(story_script[block][i].dialogs[n-1].choice[b].className){choice.className=story_script[block][i].dialogs[n-1].choice[b].className;}
        if(story_script[block][i].dialogs[n-1].choice[b].style){choice.style=story_script[block][i].dialogs[n-1].choice[b].style;}
        choice.classList.add("tue_choice");
        choice.style.position="absolute";
        choice.style.backgroundColor=story_script[block][i].dialogs[n-1].choice[b].color;
        choice.style.backgroundRepeat="no-repeat";
        choice.style.backgroundPosition="center";
        choice.style.backgroundImage="url('"+open_file((story_script[block][i].dialogs[n-1].choice[b].art[languare])?story_script[block][i].dialogs[n-1].choice[b].art[languare]:story_script[block][i].dialogs[n-1].choice[b].art)+"')";
        if(story_script[block][i].dialogs[n-1].choice[b].size){
            if(story_script[block][i].dialogs[n-1].choice[b].size[0]!=0){
                choice.style.width=story_script[block][i].dialogs[n-1].choice[b].size[0];}
            if(story_script[block][i].dialogs[n-1].choice[b].size[1]!=0){
                choice.style.height=story_script[block][i].dialogs[n-1].choice[b].size[1];
                choice.style.lineHeight=story_script[block][i].dialogs[n-1].choice[b].size[1];
            }
        }
        if(story_script[block][i].dialogs[n-1].choice[b].art_size){choice.style.backgroundSize=story_script[block][i].dialogs[n-1].choice[b].art_size[0]+" "+story_script[block][i].dialogs[n-1].choice[b].art_size[1];}else{story_script[block][i].dialogs[n-1].choice[b].art_size=['','']}
        if(story_script[block][i].dialogs[n-1].choice[b].position[0]!=0){choice.style.left=story_script[block][i].dialogs[n-1].choice[b].position[0];}
        if(story_script[block][i].dialogs[n-1].choice[b].position[1]!=0){choice.style.right=story_script[block][i].dialogs[n-1].choice[b].position[1];}
        if(story_script[block][i].dialogs[n-1].choice[b].position[2]!=0){choice.style.top=story_script[block][i].dialogs[n-1].choice[b].position[2];}
        if(story_script[block][i].dialogs[n-1].choice[b].position[3]!=0){choice.style.bottom=story_script[block][i].dialogs[n-1].choice[b].position[3];}
        choice.style.color=story_script[block][i].dialogs[n-1].choice[b].color_text;
        choice.style.fontSize=((story_script[block][i].dialogs[n-1].choice[b].size_text)?story_script[block][i].dialogs[n-1].choice[b].size_text:story_script.parameters.font_size);
        choice.style.zIndex=2001+n;
        choice.style.textAlign="center";
        if(story_script[block][i].dialogs[n-1].choice[b].text[languare].length>0){
            choice.innerHTML=story_script[block][i].dialogs[n-1].choice[b].text[languare];
            choice.style.padding=story_script[block][i].dialogs[n-1].choice[b].indent_text;
        }
        scene_layout.appendChild(choice);
        choice_ec.innerHTML+=choice_panel_edit(block,i,n,b);
    }
}
function choice_panel_add(block,i,n){
    if(!story_script[block][i].dialogs[n-1].choice){story_script[block][i].dialogs[n-1].choice=[]}
    story_script[block][i].dialogs[n-1].choice.push({"go_to":story_script.parameters.launch_story,"position":["50%","0","50%","0"],"size":[0,story_script.parameters.buttons[0].size[1]],"color":story_script.parameters.text_panel.color,"color_text":story_script.parameters.text_panel.color_text,"text":"button"});
    b=story_script[block][i].dialogs[n-1].choice.length-1;
    choice_panel_update(block,i,n)
}
function choice_panel_edit(block,i,n,b){
    var var_list="<table id='var_table"+b+"' width='100%'><tbody><tr><td style='width:128px;' valign='bottom'></td><td style='width:48px; border-right:1px solid var(--cb); border-left:1px solid var(--cb);'></td><td></td><td style='width:30px;'></td></tr>"
    if (story_script[block][i].dialogs[n-1].choice[b].variables){
        for(var c=0;c<story_script[block][i].dialogs[n-1].choice[b].variables.length;c++){
            var_list+="<tr><td valign='bottom'><select class='input_text var_name' onchange='story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][0]=this.value'>"+option_var(story_script[block][i].dialogs[n-1].choice[b].variables[c][0])+"</select></td><td style='border-right:1px solid var(--cb); border-left:1px solid var(--cb);'><select class='input_text var_operation' onchange='story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][1]=this.value'><option value='add'>add</option><option value='set' "+((story_script[block][i].dialogs[n-1].choice[b].variables[c][1]=="set")?"selected":"")+">set</option></select></td><td><input class='input_text var_value' onchange='story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables["+c+"][2]=this.value' value='"+ story_script[block][i].dialogs[n-1].choice[b].variables[c][2] +"' type='text'></td><td onclick='var a=this.closest(\"tr\"); a.parentElement.removeChild(a);' style='cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"
        };
    }
    var_list+="</tbody></table>"+((story_script.parameters.variables&&Object.keys(story_script.parameters.variables).length>0)?"<div onclick=\"if (!story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables){story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables=[]}; story_script."+block+"["+i+"].dialogs["+(n-1)+"].choice["+b+"].variables.push( ['"+Object.keys(story_script.parameters.variables)[0]+"','add',0] ); choice_panel_update('"+block+"',"+i+","+n+");\" class='icon_m icon_add' style='margin-top:16px;height:26px; width:100%; cursor:pointer;'></div>":"<div onclick=\"setup();set_menu(5);\" class='icon_m icon_add' style='margin-top:16px;height:26px; width:100%; cursor:pointer;'></div>")
    var html='<div class="ui_buttons dialog" style="margin:8px;"><table style="width:100%"><tbody><tr>'
            +'<td width="24px" class="icon_m icon_up"   onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice,'+b+',-1);choice_panel_update(\''+block+'\','+i+','+n+');"height="22px"></td>'
            +'<td width="24px" class="icon_m icon_down" onclick="move_elenetn(story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice,'+b+', 1);choice_panel_update(\''+block+'\','+i+','+n+');"></td><td>&nbsp;</td>'
            +'<td width="24px" class="icon icon_del" style="cursor:pointer;" onclick="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice.splice('+b+',1);choice_panel_update(\''+block+'\','+i+','+n+');" ></td>'
    +'</tr><tr><td id="chdbn'+b+'" colspan="4" height="24px" align="center">'+((button_name[story_script[block][i].dialogs[n-1].choice[b].go_to])?button_name[story_script[block][i].dialogs[n-1].choice[b].go_to]:story_script[block][i].dialogs[n-1].choice[b].go_to)+'</td></tr><tr>'
    +'<td class="icon_m icon_more" height="22px" onclick="block_open(\'chosp'+b+'\');scen_element.chosp'+b+'=chosp'+b+'.style.display;"></td><td colspan="3"></td></tr></tbody></table>'
    +'<table id="chosp'+b+'" width="100%" style="display:'+((scen_element['chosp'+b])?scen_element['bpsp'+b]:'none')+';border-top:1px solid var(--cb);margin-top:8px;"><tbody><tr>'
        +'<td height="40px" align="right" style="width:40%;padding-right:8px;">Text</td>'
        +'<td style="width:28px;" align="center"><select id="сts'+b+'" class="input_text" onchange="сtм'+b+'.value=((story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].text[this.value].length>0)?story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].text[this.value]:\'\')" style="height:28px;width:100%;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td colspan="2"><input id="сtм'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].text[сts'+b+'.value]=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].text[languare].length>0)?story_script[block][i].dialogs[n-1].choice[b].text[languare]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Go to</td>'
        +'<td colspan="3"><select class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].go_to=this.value;" style="width:100%;height:28px" oninput="chdbn'+b+'.innerHTML=((button_name[this.value])?button_name[this.value]:this.value)">'+option_block(story_script[block][i].dialogs[n-1].choice[b].go_to,2)+'</select></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Style CSS</td>'
        +'<td colspan="3"><input class="input_text"  onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].style=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].style)?story_script[block][i].dialogs[n-1].choice[b].style:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Width size</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].size[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].size)?story_script[block][i].dialogs[n-1].choice[b].size[0]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Height size</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].size[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].size)?story_script[block][i].dialogs[n-1].choice[b].size[1]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Color</td>'
        +'<td style="width:28px;" align="center"><div class="show_color" style="background-color:'+story_script[block][i].dialogs[n-1].choice[b].color+';"></div></td>'
        +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].color)?story_script[block][i].dialogs[n-1].choice[b].color:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color=this.value;choice_panel_update(\''+block+'\','+i+','+n+');"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Color text</td>'
        +'<td style="width:28px;" align="center"><div class="show_color" style="background-color:'+story_script[block][i].dialogs[n-1].choice[b].color_text+';"></div></td>'
        +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color_text=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].color_text)?story_script[block][i].dialogs[n-1].choice[b].color_text:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].color_text=this.value;choice_panel_update(\''+block+'\','+i+','+n+');"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Text size</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].size_text=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].size_text)?story_script[block][i].dialogs[n-1].choice[b].size_text:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Class Name</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].className=this.value;" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].className)?story_script[block][i].dialogs[n-1].choice[b].className:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Top position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[2]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].position)?story_script[block][i].dialogs[n-1].choice[b].position[2]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Left position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].position)?story_script[block][i].dialogs[n-1].choice[b].position[0]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Bottom position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[3]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].position)?story_script[block][i].dialogs[n-1].choice[b].position[3]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Right position</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].position[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].position)?story_script[block][i].dialogs[n-1].choice[b].position[1]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Indent text</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].indent_text=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].indent_text)?story_script[block][i].dialogs[n-1].choice[b].indent_text:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Art</td>'
        +'<td style="width:28px;" align="center"><select id="сas'+b+'" class="input_text" onchange="сtt'+b+'.value=story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
        +'<td><input id="сtt'+b+'" class="input_text" onchange="var v=document.getElementById(\'сas'+b+'\');story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art[v.value]=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].art[languare])?story_script[block][i].dialogs[n-1].choice[b].art[languare]:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'сtt'+b+'\',\'img\',\'сtt'+b+'\',\'cho'+b+'\',\'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art[сas'+b+'.value]\')"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Width art</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size[0]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].art_size)?story_script[block][i].dialogs[n-1].choice[b].art_size[0]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Height art</td>'
        +'<td colspan="3"><input class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].art_size[1]=correct_value(this.value);choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].art_size)?story_script[block][i].dialogs[n-1].choice[b].art_size[1]:'')+'"></td>'
    +'</tr><tr>'
        +'<td height="40px" align="right" style="padding-right:8px;">Sound</td>'
        +'<td colspan="2"><input id="сst'+b+'" class="input_text" onchange="story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].sound=this.value;choice_panel_update(\''+block+'\','+i+','+n+');" type="text" style="width:100%;height:28px" value="'+((story_script[block][i].dialogs[n-1].choice[b].sound)?story_script[block][i].dialogs[n-1].choice[b].sound:'')+'"></td>'
        +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'сst'+b+'\',\'audio\',\'сst'+b+'\',\'cho'+b+'\',\'story_script.'+block+'['+i+'].dialogs['+(n-1)+'].choice['+b+'].sound\')"></td>'
    +'</tr><tr>'
        +'<td colspan="4" height="40px" align="left" style="padding-left:8px; border-bottom:1px solid var(--cb);">Variables</td>'
    +'</tr><tr>'
        +'<td colspan="4">'+var_list+'</td>'
    +'</tr></tbody></table></div>'
    return html;
}
let button_name={
    'tue_back':'Back dialog',
    'tue_next':'Next dialog',
    'tue_home':'Start block',
    'tue_save':'Save stage',
    'tue_load':'Load stage',
    'tue_load_autosave':'Load avtosave',
    'tue_fullScreen':'Full screen',
}
function button_panel_update(){
    droppFocus();
    interface_buttons_c.innerHTML=""
    var clear_ui=document.getElementsByClassName("tue_controll");
    while(clear_ui.length){scene_layout.removeChild(clear_ui[0]);}
    for(var b=0;b<story_script.parameters.buttons.length;b++){
        if(!story_script.parameters.buttons[b].text){story_script.parameters.buttons[b].text={}}
        if(!story_script.parameters.buttons[b].text[languare]){data_la(story_script.parameters.buttons[b],'text')}
        if(!story_script.parameters.buttons[b].art){story_script.parameters.buttons[b].art={}}
        if(!story_script.parameters.buttons[b].art[languare]){data_la(story_script.parameters.buttons[b],'art')}
        var ui_button=document.createElement("div");
        if(story_script.parameters.buttons[b].className){ui_button.className=story_script.parameters.buttons[b].className;}
        if(story_script.parameters.buttons[b].style){ui_button.style=story_script.parameters.buttons[b].style;}
        if(story_script.parameters.buttons[b].text){
            if (story_script.parameters.buttons[b].text[languare].length>0){
                ui_button.innerHTML=story_script.parameters.buttons[b].text[languare];
                ui_button.style.padding=story_script.parameters.buttons[b].indent_text;
            };
            ui_button.style.textAlign="center";
            ui_button.style.color=story_script.parameters.buttons[b].color_text;
            ui_button.style.fontSize=((story_script.parameters.buttons[b].size_text)?story_script.parameters.buttons[b].size_text:story_script.parameters.font_size);
        }
        ui_button.style.zIndex=3000+b;
        ui_button.id=story_script.parameters.buttons[b].name+b;
        ui_button.setAttribute('onclick','objSelect(this.id);arr_e=story_script.parameters.buttons['+b+']');
        ui_button.classList.add("tue_controll");
        ui_button.style.position="absolute";
        ui_button.style.width=story_script.parameters.buttons[b].size[0];
        ui_button.style.height=story_script.parameters.buttons[b].size[1];
        ui_button.style.backgroundColor=story_script.parameters.buttons[b].color;
        ui_button.style.backgroundRepeat="no-repeat";
        ui_button.style.backgroundPosition="center";
        ui_button.style.backgroundImage="url('"+open_file((story_script.parameters.buttons[b].art[languare])?story_script.parameters.buttons[b].art[languare]:story_script.parameters.buttons[b].art)+"')";
        if(story_script.parameters.buttons[b].art_size){ui_button.style.backgroundSize=story_script.parameters.buttons[b].art_size[0]+" "+story_script.parameters.buttons[b].art_size[1];}
        if(story_script.parameters.buttons[b].position[0]!=0){ui_button.style.left=story_script.parameters.buttons[b].position[0];}
        if(story_script.parameters.buttons[b].position[1]!=0){ui_button.style.right=story_script.parameters.buttons[b].position[1];}
        if(story_script.parameters.buttons[b].position[2]!=0){ui_button.style.top=story_script.parameters.buttons[b].position[2];}
        if(story_script.parameters.buttons[b].position[3]!=0){ui_button.style.bottom=story_script.parameters.buttons[b].position[3];}
        scene_layout.appendChild(ui_button);
        interface_buttons_c.innerHTML+=button_panel_edit(b)
    }
}
function button_panel_edit(b){
    if(b==-1){
        story_script.parameters.buttons.push({"name":"","position":["50%","0","50%","0"],"size":[0,story_script.parameters.buttons[0].size[1]],"color":story_script.parameters.text_panel.color,"art":"","text":"","color_text":story_script.parameters.text_panel.color_text})
        b=story_script.parameters.buttons.length-1
    }
    var html='<div class="ui_buttons dialog" style="margin:8px;"><table style="width:100%"><tbody><tr>'
            +'<td width="24px" class="icon_m icon_up" onclick="move_elenetn(story_script.parameters.buttons,'+b+',-1);button_panel_update();" height="22px"></td>'
            +'<td width="24px" class="icon_m icon_down" onclick="move_elenetn(story_script.parameters.buttons,'+b+', 1);button_panel_update();"></td><td>&nbsp;</td>'
            +'<td width="24px" '+((story_script.parameters.buttons[b].name=='tue_back'||story_script.parameters.buttons[b].name=='tue_next')?'':'class="icon icon_del" onmouseup="story_script.parameters.buttons.splice('+b+',1);button_panel_update();"')+' style="cursor:pointer;"></td>'
            +'</tr><tr><td id="bt'+b+'" colspan="4" height="24px" align="center">'+((button_name[story_script.parameters.buttons[b].name])?button_name[story_script.parameters.buttons[b].name]:'None')+'</td></tr><tr>'
    +'<td height="22px" class="icon_m icon_more" onclick="block_open(\'bpsp'+b+'\');scen_element.bpsp'+b+'=bpsp'+b+'.style.display;"></td><td colspan="3"></td></tr></tbody></table>'
    +'<table id="bpsp'+b+'" width="100%" style="display:'+((scen_element['bpsp'+b])?scen_element['bpsp'+b]:'none')+';border-top:1px solid var(--cb);margin-top:8px;"><tbody><tr>'
            +'<td height="40px" align="right" style="width:40%; padding-right:8px;">Function</td>'
            +'<td colspan="3"><select class="input_text" oninput="bt'+b+'.innerHTML=((button_name[this.value])?button_name[this.value]:this.value);story_script.parameters.buttons['+b+'].name=this.value;" style="width:100%;height:28px">'+option_block(story_script.parameters.buttons[b].name,3)+'</select></select></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Text</td>'
            +'<td style="width:28px;" align="center"><select id="bts'+b+'" class="input_text" onchange="btv'+b+'.value=((story_script.parameters.buttons['+b+'].text[this.value].length>0)?story_script.parameters.buttons['+b+'].text[this.value]:\'\');" style="height:28px;width:100%;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
            +'<td colspan="2"><input id="btv'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].text[bts'+b+'.value]=this.value;button_panel_update(true);" type="text" style="width:100%;height:28px;" value="'+((story_script.parameters.buttons[b].text[languare])?story_script.parameters.buttons[b].text[languare]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Style CSS</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].style=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].style)?story_script.parameters.buttons[b].style:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Width size</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].size[0]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].size)?story_script.parameters.buttons[b].size[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Height size</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].size[1]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].size)?story_script.parameters.buttons[b].size[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Color</td>'
            +'<td style="width:28px;" align="center"><div class="show_color" '+((story_script.parameters.buttons[b].color)?'style="background-color:'+story_script.parameters.buttons[b].color+';"':"")+'></div></td>'
            +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].color=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].color)?story_script.parameters.buttons[b].color:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.parameters.buttons['+b+'].color=this.value;button_panel_update();"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Color text</td>'
            +'<td style="width:28px;" align="center"><div class="show_color" '+((story_script.parameters.buttons[b].color_text)?'style="background-color:'+story_script.parameters.buttons[b].color_text+';"':"")+'></div></td>'
            +'<td style="padding-right:8px;"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].color_text=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].color_text)?story_script.parameters.buttons[b].color_text:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_color"><input type="color" name="paletr" class="input_color" onchange="story_script.parameters.buttons['+b+'].color_text=this.value;button_panel_update();"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Text size</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].size_text=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].size_text)?story_script.parameters.buttons[b].size_text:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Class Name</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].className=this.value" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].className)?story_script.parameters.buttons[b].className:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Top position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[2]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].position)?story_script.parameters.buttons[b].position[2]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Left position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[0]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].position)?story_script.parameters.buttons[b].position[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Bottom position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[3]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].position)?story_script.parameters.buttons[b].position[3]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Right position</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].position[1]=correct_value(this.value);button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].position)?story_script.parameters.buttons[b].position[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Indent text</td>'
            +'<td colspan="3"><input class="input_text" onchange="story_script.parameters.buttons['+b+'].indent_text=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].indent_text)?story_script.parameters.buttons[b].indent_text:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Art</td>'
            +'<td style="width:28px;" align="center"><select id="bpal'+b+'" class="input_text" onchange="bpat'+b+'.value=story_script.parameters.buttons['+b+'].art[this.value]" style="height:28px;width:100%;border-left:1px solid var(--cb); border-right:1px solid var(--cb); border-bottom:1px solid var(--cb);">'+project_languares(languare)+'</select></td>'
            +'<td><input id="bpat'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].art[bpal'+b+'.value]=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+story_script.parameters.buttons[b].art[languare]+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'bpat'+b+'\',\'img\',\'bpat'+b+'\',\''+story_script.parameters.buttons[b].name+b+'\',\'story_script.parameters.buttons['+b+'].art[bpal'+b+'.value]\')"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Width art</td>'
            +'<td colspan="3"><input class="input_text" onchange="if(!story_script.parameters.buttons['+b+'].art_size){story_script.parameters.buttons['+b+'].art_size=[correct_value(this.value),correct_value(this.value)]}else{story_script.parameters.buttons['+b+'].art_size[0]=correct_value(this.value)};button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].art_size)?story_script.parameters.buttons[b].art_size[0]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Height art</td>'
            +'<td colspan="3"><input class="input_text" onchange="if(!story_script.parameters.buttons['+b+'].art_size){story_script.parameters.buttons['+b+'].art_size=[correct_value(this.value),correct_value(this.value)]}else{story_script.parameters.buttons['+b+'].art_size[1]=correct_value(this.value)};button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].art_size)?story_script.parameters.buttons[b].art_size[1]:'')+'"></td>'
        +'</tr><tr>'
            +'<td height="40px" align="right" style="padding-right:8px;">Sound</td>'
            +'<td colspan="2"><input id="bpst'+b+'" class="input_text" onchange="story_script.parameters.buttons['+b+'].sound=this.value;button_panel_update();" type="text" style="width:100%;height:28px" value="'+((story_script.parameters.buttons[b].sound)?story_script.parameters.buttons[b].sound:'')+'"></td>'
            +'<td height="40px" align="right" style="width:30px;" class="icon icon_load" onclick="file_catalog(\'bpst'+b+'\',\'audio\',\'bpst'+b+'\',\''+story_script.parameters.buttons[b].name+b+'\',\'story_script.parameters.buttons['+b+'].sound\')"></td>'
    +'</tr></tbody></table></div>'
    return html;
}
function preview_size(){
    if(screen_size.value==0){
        scale_scene=1;screen_preview.style.transform='scale(1)';scene_canvas.style.transform='scale(1)';
        screen_preview.style.backgroundSize="64px"
        screen_preview.style.width="100%";
        screen_preview.style.height="calc(100vh - 40px)";
        if(ratio_screen.selectedIndex==0){
            scene_layout.style.width="100%";
            scene_layout.style.height=p_width.value+"%";
        }else{
            scene_layout.style.height="100%";
            scene_layout.style.width=p_width.value+"%";
        }
    }else{
        screen_preview.style.width=(screen_size.value*2.5)+"px";
        screen_preview.style.height=screen_preview.style.width;
        if(ratio_screen.selectedIndex==0){
            scene_layout.style.height=screen_size.value+"px";
            scene_layout.style.width=((100/p_width.value)*screen_size.value)+"px";
        }else{
            scene_layout.style.width=screen_size.value+"px";
            scene_layout.style.height=((100/p_width.value)*screen_size.value)+"px";
        }
    }
    scene_view.scrollTop=(screen_preview.clientHeight/2)-(scene_view.clientHeight/2);
    scene_view.scrollLeft=(screen_preview.clientWidth/2)-(scene_view.clientWidth/2);
}
function scen_editor_apply(){
    world.style.display="initial";
    new_story_block.style.display="initial";
    scene_maker.style.display="none";
    scroll_block=false;
    scene_screen=false;
    html.style.overflow="auto"
    update_novel();
}
function variables_set_edit(){
    copy_arr=JSON.parse(JSON.stringify(arr_l));
    var t=""
    for(var c=0;c<copy_arr.variables.length;c++){t+="<tr><td style='width:128px;' valign='bottom'><select class='input_text var_name'>"+option_var(arr_l.variables[c][0])+"</select></td><td style='width:48px; border-right:1px solid var(--cb); border-left:1px solid var(--cb);'><select class='input_text var_operation'><option value='add'>add</option><option value='set' "+((arr_l.variables[c][1]=="set")?"selected":"")+">set</option></select></td><td><input class='input_text var_value' value='"+ arr_l.variables[c][2] +"' type='text'></td><td onclick='var a=this.closest(\"tr\"); a.parentElement.removeChild(a);' style='width:40px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>"};
    var html="<div class='window' style='padding:24px 8px; width:480px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")' ></div></div><p>Changes to values</p><br><hr style='margin:0;'><p class='text_tutorials_a select_tutorials'>"+texts.tutorials[4].en+"</p><br><br>"
    +"<table id='var_table' width='100%'><tbody>"+t+"</tbody></table>"
    +"<div onclick=\"variables_set_add('var_table')\" class='icon icon_add' style='margin-top:16px;height:26px; width:100%; cursor:pointer;'></div>"
    +"<br><br><table class='big_button' width='256px' onclick='variables_set_apply();'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function variables_set_add(id){
    var tbody=document.getElementById(id).getElementsByTagName('tbody')[0];
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    var td4=document.createElement("td");
    td1.innerHTML="<select class='input_text var_name'>"+option_var()+"</select>";
    td2.innerHTML="<select class='input_text var_operation'><option value='add'>add</option><option value='set'>set</option></select>";
    td2.style='width:48px; border-right:1px solid var(--cb); border-left:1px solid var(--cb);';
    td3.innerHTML="<input class='input_text var_value' value='0' type='text'>";
    td4.style="width:40px;cursor:pointer;";
    td4.title="delet";
    td4.className="icon icon_del";
    td4.setAttribute("onclick","var a=this.closest('tr'); a.parentElement.removeChild(a);");
    row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
    row.appendChild(td4);
    tbody.appendChild(row);
}
function variables_set_apply(){
    li_v=document.getElementsByClassName("var_name");
    li_c=document.getElementsByClassName("var_operation");
    li_z=document.getElementsByClassName("var_value");
    copy_arr.variables=[];
    for(var i=0;i<li_v.length;i++){ copy_arr.variables.push( [li_v[i].value,li_c[i].value,parseInt(li_z[i].value)] ) };
    arr_l.variables=JSON.parse(JSON.stringify(copy_arr.variables));
    modal_window("close");
    update_novel();
}
function scen_compres(block,i,n){
    var a=0;
    if (story_script[block][i].dialogs[n-1]){
        if(story_script[block][i].dialogs[n-1].art){for(a=0;a<story_script[block][i].dialogs[n-1].art.length;a++){data_only(story_script[block][i].dialogs[n-1].art[a],'url');}}
        if(story_script[block][i].dialogs[n-1].choice){for(a=0;a<story_script[block][i].dialogs[n-1].choice.length;a++){data_only(story_script[block][i].dialogs[n-1].choice[a],'art');}}
    }
}
function correct_name(name){return name.trim().replace(/[\s.,':;]/g,'_');};
let units=['px','%','em',"pc","pt","in","mm","cm","ex","ch","rem","vw","vh"];
function correct_value(name){
    var l="px"
    if (name.indexOf("calc")>-1){return name}
    else if(name.indexOf("+")>-1||name.indexOf("-")>-1||name.indexOf("*")>-1||name.indexOf("/")>-1){
        for(var u=0;u<units.length;u++){if(name.indexOf(units[u])>-1){name=name.replace(new RegExp(units[u],'g'),'');l=units[u];}}
        return eval(name)+l;}
    else if(name==parseInt(name)&&name!=0){ return name+l}
    else{return name}
}
function move_elenetn(arr,o,n){
	var new_index=((o+n)<0)?o:o+n;
    arr.splice(new_index,0,arr.splice(o,1)[0]);
    update_novel();
};
function setup(){
    var block_list;
    var i
    var li=document.getElementsByClassName("story_block");
    if(!story_script.parameters.plugins){story_script.parameters.plugins=[]}
    for(i=0;i<li.length;i++){block_list+="<option value='"+li[i].id+"' "+((li[i].id==story_script.parameters.launch_story)?"selected" :"")+">"+li[i].id+"</option>"}
    var var_list="<table width='100%' id='var_tablet'><tbody>";
    if(story_script.parameters.variables){for(i=0;i<Object.keys(story_script.parameters.variables).length;i++){var_list+="<tr><td style='padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;'><input class='var_name input_text' onchange='this.value=correct_name(this.value)' placeholder='Name' value='"+Object.keys(story_script.parameters.variables)[i]+"' type='text'></td><td><input class='var_vol input_text' placeholder='Value' style='padding-top:10px;' value='"+story_script.parameters.variables[Object.keys(story_script.parameters.variables)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet "+Object.keys(story_script.parameters.variables)[i]+"' class='icon icon_del'></td></tr>";}}
    var_list+="</tbody></table><div onclick=\"add_tr('var_tablet')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px; width:26px; cursor:pointer;'></div>"
    var sound_list="<table width='100%' id='var_sounds'><tbody>";
    if(story_script.parameters.sounds){for(i=0;i<Object.keys(story_script.parameters.sounds).length;i++){sound_list+="<tr><td style='padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;'><input class='sound_name input_text' placeholder='Name' value='"+Object.keys(story_script.parameters.sounds)[i]+"' type='text'></td><td><input class='sound_path input_text' placeholder='path to audio file' style='padding-top:10px;' value='"+story_script.parameters.sounds[Object.keys(story_script.parameters.sounds)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet "+Object.keys(story_script.parameters.sounds)[i]+"' class='icon icon_del'></td></tr>";}}
    sound_list+="</tbody></table><div onclick=\"add_tr('var_sounds')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px; width:26px; cursor:pointer;'></div>"
    var font_list="<table width='100%' id='var_fonts'><tbody>";
    if(story_script.parameters.font_files){for(i=0;i<Object.keys(story_script.parameters.font_files).length;i++){font_list+="<tr><td style='padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;'><input class='font_name input_text' placeholder='Name' value='"+Object.keys(story_script.parameters.font_files)[i]+"' type='text'></td><td><input class='font_path input_text' placeholder='path to font file' style='padding-top:10px;' value='"+story_script.parameters.font_files[Object.keys(story_script.parameters.font_files)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet "+Object.keys(story_script.parameters.font_files)[i]+"' class='icon icon_del'></td></tr>";}}
    font_list+="</tbody></table><div onclick=\"add_tr('var_fonts')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px; width:26px; cursor:pointer;'></div>"
    if(!story_script.parameters.title[languare]){data_la(story_script.parameters,'title')};
    var title_list="<table width='100%' id='var_title'><tbody>";
    if(story_script.parameters.title){
        for(i=0;i<Object.keys(story_script.parameters.title).length;i++){
            title_list+="<tr><td style='padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;'><select class='input_text title_lang'>"
            +big_languares(Object.keys(story_script.parameters.title)[i])+"</select></td><td><input class='title_name input_text' placeholder='translated title' style='padding-top:10px;' value='"+story_script.parameters.title[Object.keys(story_script.parameters.title)[i]]+"' type='text'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:40px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>";
        }
    }
    var plugins_show="<table id='plugin' style='width:100%;  border-spacing:10px; border-collapse:separate;'>"
    var plugins_name
    for(i=0;i<Object.keys(plugins_list).length;i++){plugins_name=Object.keys(plugins_list)[i];plugins_show+="<tr><td align='right' style='padding-top:4px; height:40px;'><input id='"+plugins_name+"' type='checkbox' class='chec_plugin checkbox_a' "+((story_script.parameters.plugins.indexOf(plugins_name)>-1)?'checked' :'')+"></td><td align='left' style='width:80px;'>"+plugins_list[plugins_name].name+"</td><td>"+plugins_list[plugins_name].text+"</td></tr>"}
    plugins_show+="</table>"
    var thems="<table style='border-spacing:10px;border-collapse:separate;'><tbody><tr>"
    for(i=0;i<color_ui.length;i++){thems+="<td class='color_select' style='background-color:"+color_ui[i][0]+";'><input class='checkbox_b' type='radio' name='color' value='"+i+"' "+((setup_editor.ui==i)?'checked' :'')+"></td>"}
    thems+="</tr></tbody></table>"
    var addon_list="<table width='100%' id='var_addon'><tbody>";
    if(story_script.parameters.plugins){for(i=0;i<story_script.parameters.plugins.length;i++){if(!plugins_list[story_script.parameters.plugins[i]]){addon_list+="<tr><td style='padding-right:8px; padding-left:8px; width:calc(100% - 14px); padding-top:10px;'><input class='addon_path input_text' placeholder='path to plugin js file' value='"+story_script.parameters.plugins[i]+"' type='text'></td><td onclick=\"var a=this.closest('tr'); a.parentElement.removeChild(a);\" style='width:14px; cursor:pointer;' title='delet' class='icon icon_del'></td></tr>";}}}
    addon_list+="</tbody></table><div onclick='add_addon()' class='icon icon_add' style='margin:16px 0 0 45%;height:26px; width:26px; cursor:pointer;'></div>"
    title_list+="</tbody></table><div onclick=\"add_tr('var_title')\" class='icon icon_add' style='margin:16px 0 0 45%;height:26px; width:26px; cursor:pointer;'></div>"
    var html="<div class='window' style='padding:24px 16px; width:480px;'><div style'position:relative;'><div class='window_close icon icon_close' onclick='modal_window(\"close\")'></div></div><p>Settings project</p><br>"+
        "<table width='100%' style='height:60vh; border-radius:8px; border-top:1px solid var(--cb);'><tbody>"+
        "<tr><td id='set_1' onclick='set_menu(0)' align='right' class='set_button set_select'>Project</td><td width='100%' valign='top' rowspan='6' style='position:relative;'>"+
        //
        "<div id='blank_0' style='visibility:visible;' class='set_blank'><table style='width:100%;  border-spacing:10px; border-collapse:separate;'>"+
        "<tr><td align='right'>autosave </td><td align='left' style='padding-top:4px; width:60%;'><table style='width:100%'><tbody><tr><td><input id='autosave' type='checkbox' class='checkbox_a' "+((story_script.parameters.autosave)?'checked' :'')+"></td><td align='right'>Clear localStorage:</td></tr></tbody></table></td><td onclick=\"localStorage.clear();toast('localStorage clear');\" style='width:40px; cursor:pointer;' title='clear autosave' class='icon icon_del'></td></tr>"+
        "<tr><td align='right'>story launch block </td><td align='left' colspan='2'><select class='input_text' id='launch_story'>"+((block_list)?block_list :'')+"</select></td></tr>"+
        "<tr><td align='right'>css styles file </td><td align='left'><input id='style_file' class='input_text' value='"+((story_script.parameters.style_file)?story_script.parameters.style_file :'')+"' type='text'></td><td id='l_css' style='width:14px; cursor:pointer;' class='icon icon_load' onclick='file_catalog(this.id,\".css\",\"style_file\",0,\"story_script.parameters.style_file\")'></td></tr>"+
        "<tr><td align='right'>dialog speed </td><td align='left' colspan='2'><input id='dialog_speed_s' class='input_text' value='"+((story_script.parameters.text_panel.dialog_speed)?story_script.parameters.text_panel.dialog_speed :'')+"' type='text'></td></tr>"+"<tr><td align='right'>font family </td><td align='left' colspan='2'><input id='font' class='input_text' value='"+((story_script.parameters.font)?story_script.parameters.font :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>font size </td><td align='left' colspan='2'><input id='font_size' class='input_text' value='"+((story_script.parameters.font_size)?story_script.parameters.font_size :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>icon </td><td align='left'><input id='icon' class='input_text' value='"+((story_script.parameters.icon)?story_script.parameters.icon :'')+"' type='text'></td><td id='l_icon'style='width:14px; cursor:pointer;' class='icon icon_load' onclick='file_catalog(this.id,\"img\",\"icon\",0,\"story_script.parameters.icon\")'></td></tr>"+
        "</table><br><p align='left' style=' margin-left:8px;'>name project</p><hr>"+title_list+"</div>"+
        //
        "<div id='blank_6' style='visibility:hidden;' class='set_blank'><table style='width:100%;  border-spacing:10px; border-collapse:separate;'>"+
        "<tr><td align='right'>next </td><td align='left'><input id='key_next' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.next)?story_script.parameters.key.next :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>back </td><td align='left'><input id='key_back' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.back)?story_script.parameters.key.back :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>save stage</td><td align='left'><input id='key_save' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.save)?story_script.parameters.key.save :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>load stage</td><td align='left'><input id='key_load' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.load)?story_script.parameters.key.load :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>full screen </td><td align='left'><input id='key_full_screen' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.full_screen)?story_script.parameters.key.full_screen :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>launch screen </td><td align='left'><input id='key_launch_story' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.launch_story)?story_script.parameters.key.launch_story :'')+"' type='text'></td></tr>"+
        "<tr><td align='right'>load autosave </td><td align='left' style='width:60%;'><input id='key_load_autosave' class='input_text' onkeyup='this.value=event.code;' value='"+((story_script.parameters.key.load_autosave)?story_script.parameters.key.load_autosave :'')+"' type='text'></td></tr>"+
        "</table></div>"+
        //
        "<div id='blank_5' style='visibility:hidden;' class='set_blank'>"+var_list+"</div>"+
        "<div id='blank_4' style='visibility:hidden;' class='set_blank'>"+sound_list+"</div>"+
        "<div id='blank_7' style='visibility:hidden;' class='set_blank'>Characters</div>"+
        "<div id='blank_3' style='visibility:hidden;' class='set_blank'>"+font_list+"</div>"+
        //
        "<div id='blank_1' style='visibility:hidden;' class='set_blank'><br><p align='left' style=' margin-left:8px;'>Devices control</p><hr><form id='devices'><table id='controll' style='width:100%;  border-spacing:10px; border-collapse:separate;'>"+
        "<tr><td align='right' style='padding-top:4px; height:40px;'><input type='radio' name='devices' class='chec_plugin checkbox_a' "+((setup_editor.wheel==true)?'checked' :'')+"></td><td align='left' style='width:80px;'>Mouse </td><td> scrolling with the mouse cursor, zooming with the wheel</td></tr>"+
        "<tr><td align='right' style='padding-top:4px; height:40px;'><input type='radio' name='devices' class='chec_plugin checkbox_a' "+((setup_editor.wheel==false)?'checked' :'')+"></td><td align='left' style='width:80px;'>TouchPad </td><td> swipe scrolling is recommended for Laptops and MacBooks</td></tr>"+
        "</tbody></table></form><br><p align='left' style=' margin-left:8px;'>Display script</p><hr><table id='controll' style='width:100%;  border-spacing:10px; border-collapse:separate;'><tbody>"+
        "<tr><td align='right' style='padding-top:4px; height:40px;'><input id='all_lines' type='checkbox' class='chec_plugin checkbox_a' "+((setup_editor.lines)?'checked' :'')+"></td><td align='left' style='width:80px;'>All Lines </td><td> Show all lines of a block or only a selected block</td></tr>"+
        "</tbody></table><br>"+
        "<p align='left' style='margin-left:8px;'>Color them</p><hr><form id='ui_color'>"+
        "<table style='border-spacing:10px;border-collapse:separate;'><tbody><tr>"+thems+
        "</form><br>"+
        "<p align='left' style='margin-left:8px;'>Background</p><hr><form id='bg_edit'><table style='width:100%;'><tbody><tr>"+
        "<td align='center' height='92px'><input type='radio' name='bg_edit' class='chec_bg' value='' "+((setup_editor.fon=='')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_1' value='bg_1' "+((setup_editor.fon=='bg_1')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_2' value='bg_2' "+((setup_editor.fon=='bg_2')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_8' value='bg_8' "+((setup_editor.fon=='bg_8')?'checked' :'')+"></td></tr><tr>"+
        "<td align='center' height='92px'><input type='radio' name='bg_edit' class='chec_bg bg_4' value='bg_4' "+((setup_editor.fon=='bg_4')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_5' value='bg_5' "+((setup_editor.fon=='bg_5')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_6' value='bg_6' "+((setup_editor.fon=='bg_6')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_3' value='bg_3' "+((setup_editor.fon=='bg_3')?'checked' :'')+"></td></tr><tr>"+
        "<td align='center' height='92px'><input type='radio' name='bg_edit' class='chec_bg bg_7' value='bg_7' "+((setup_editor.fon=='bg_7')?'checked' :'')+"></td>"+
        "<td align='center'><input type='radio' name='bg_edit' class='chec_bg bg_9' value='bg_9' "+((setup_editor.fon=='bg_9')?'checked' :'')+"></td>"+
        "<td align='center'></td>"+
        "<td align='center'></td>"+
        "</tr></tbody></table></form></div>"+
        //
        "<div id='blank_2' style='visibility:hidden;' class='set_blank'>"+plugins_show+"<br>"+addon_list+"</div>"+
        //
        "</td></tr>"+
        "<tr><td id='set_2' onclick='set_menu(1)' align='right' class='set_button'>Editor</td></tr>"+
        "<tr><td id='set_3' onclick='set_menu(2)' align='right' class='set_button'>Add-on</td></tr>"+
        "<tr><td id='set_4' onclick='set_menu(3)' align='right' class='set_button'>Fonts</td></tr>"+
        "<tr><td id='set_5' onclick='set_menu(4)' align='right' class='set_button'>Sounds</td></tr>"+
        "<tr><td id='set_6' onclick='set_menu(5)' align='right' class='set_button'>Variables</td></tr>"+
        "<tr><td id='set_7' onclick='set_menu(6)' align='right' class='set_button'>Keyboard</td></tr>"+
        "<tr><td id='set_8' onclick='set_menu(7)' align='right' class='set_button' style='border-radius:0 0 0 16px;'>Characters</td></tr>"+
        "<tr><td style='border-right:1px solid var(--cb);'></td></tr></tbody></table><br><table class='big_button' width='256px' onclick='apply_setup()'><tbody><tr><td width='42px' class='icon icon_ok'></td><td align='center'>Apply</td><td width='42px'></td></tr></tbody></table></div>"
    modal_window("open",html);
}
function set_menu(name){
    var li=document.getElementsByClassName("set_button");
    for(var i=0;i<li.length;i++){
        if(i==name){
            li[i].className='set_button set_select'
            document.getElementById('blank_'+i).style.visibility='visible';
        }else{
            li[i].className='set_button'
            document.getElementById('blank_'+i).style.visibility='hidden';
        }
    }
}
function add_tr(id){
    var tbody=document.getElementById(id).getElementsByTagName('tbody')[0];
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td2=document.createElement("td");
    var td3=document.createElement("td");
    if(id=='var_title'||id=='new_title'){
        td1.innerHTML="<select class='input_text title_lang'>"+big_languares()+"</select>";
        td1.style="padding-right:8px; border-right:1px solid var(--cb); width:40%; padding-top:10px;";
        td2.innerHTML="<input class='title_name input_text' value='"+languare_data(story_script.parameters.title)+"' style='padding-top:10px;' type='text' placeholder='translated title'>";
    } else if(id=='var_tablet'){
        td1.innerHTML="<input class='var_name input_text' value='varible"+(tbody.getElementsByTagName('tr').length+1)+"' placeholder='name' onchange='this.value=correct_name(this.value)' style='padding-top:10px;' type='text'>";
        td1.style="padding-right:8px; border-right:1px solid var(--cb); width:40%;";
        td2.innerHTML="<input class='var_vol input_text' style='padding-top:10px;' type='text' placeholder='value'>";
    } else if(id=='var_sounds'){
        td1.innerHTML="<input class='sound_name input_text' placeholder='name' style='padding-top:10px;' type='text'>";
        td1.style="padding-right:8px; border-right:1px solid var(--cb); width:40%;";
        td2.innerHTML="<input class='sound_path input_text' style='padding-top:10px;' type='text' placeholder='path to audio file'>";
    } else if(id=='var_fonts'){
        td1.innerHTML="<input class='font_name input_text' placeholder='name' style='padding-top:10px;' type='text'>";
        td1.style="padding-right:8px; border-right:1px solid var(--cb); width:40%;";
        td2.innerHTML="<input class='font_path input_text' style='padding-top:10px;' type='text' placeholder='path to font file'>";
    }
    td3.style="width:40px; cursor:pointer;";
    td3.title="delet";
    td3.className="icon icon_del";
    td3.setAttribute("onclick","var a=this.closest('tr'); a.parentElement.removeChild(a);");
    row.appendChild(td1);
    row.appendChild(td2);
    row.appendChild(td3);
    tbody.appendChild(row);
}
function add_addon(){
    var tbody=document.getElementById('var_addon').getElementsByTagName('tbody')[0];
    var row=document.createElement("tr");
    var td1=document.createElement("td");
    var td3=document.createElement("td");
    td1.innerHTML="<input class='addon_path input_text' placeholder='path to plugin js file' type='text'>";
    td1.style="padding-right:8px; padding-left:8px; width:calc(100% - 14px); padding-top:10px;";
    td3.style="width:14px; cursor:pointer;";
    td3.title="delet";
    td3.className="icon icon_del";
    td3.setAttribute("onclick","var a=this.closest('tr'); a.parentElement.removeChild(a);");
    row.appendChild(td1);
    row.appendChild(td3);
    tbody.appendChild(row);
}
function apply_setup(){
    var i,li_n,li_v,forms;
    story_script.parameters.launch_story=launch_story.value
    story_script.parameters.style_file=style_file.value
    story_script.parameters.icon=icon.value
    story_script.parameters.autosave=autosave.checked
    story_script.parameters.key.next=key_next.value
    story_script.parameters.key.back=key_back.value
    story_script.parameters.key.save=key_save.value
    story_script.parameters.key.load=key_load.value
    story_script.parameters.key.full_screen=key_full_screen.value
    story_script.parameters.key.launch_story=key_launch_story.value
    story_script.parameters.key.load_autosave=key_load_autosave.value
    story_script.parameters.font=font.value
    story_script.parameters.font_size=correct_value(font_size.value)
    story_script.parameters.text_panel.dialog_speed=dialog_speed_s.value
    //
    forms=document.forms.devices;
    setup_editor.wheel=(forms[0].checked)?true:false;
    setup_editor.lines=all_lines.checked;
    forms=document.forms.bg_edit;
    for(i=0;i<forms.length;i++){if(forms[i].checked){setup_editor.fon=forms[i].value;break;}}
    forms=document.forms.ui_color;
    for(i=0;i<forms.length;i++){if(forms[i].checked){setup_editor.ui=forms[i].value;if(setup_editor.ui==0){set_ui(0)};break;}}
    editor_setup();
    localStorage.setItem("editor_setup",JSON.stringify(setup_editor));
    //
    li_n=document.getElementsByClassName("var_name");
    li_v=document.getElementsByClassName("var_vol");
    story_script.parameters.variables={};
    for(i=0;i<li_n.length;i++){
        if(li_n[i].value!=""){
            if (parseFloat(li_v[i].value)==li_v[i].value){story_script.parameters.variables[correct_name(li_n[i].value)]=parseFloat(li_v[i].value)}
            else{story_script.parameters.variables[correct_name(li_n[i].value)]=li_v[i].value}
        }
    }
    li_n=document.getElementsByClassName("font_name");
    li_v=document.getElementsByClassName("font_path");
    story_script.parameters.font_files={};
    for(i=0;i<li_n.length;i++){if(li_n[i].value!=""){ story_script.parameters.font_files[li_n[i].value]=li_v[i].value}}
    li_n=document.getElementsByClassName("sound_name");
    li_v=document.getElementsByClassName("sound_path");
    story_script.parameters.sounds={};
    for(i=0;i<li_n.length;i++){if(li_n[i].value!=""){ story_script.parameters.sounds[li_n[i].value]=li_v[i].value}}
    li_n=document.getElementsByClassName("title_lang");
    li_v=document.getElementsByClassName("title_name");
    story_script.parameters.title={};
    story_script.parameters.languares=[];
    for(i=0;i<li_n.length;i++){story_script.parameters.title[li_n[i].value]=li_v[i].value;story_script.parameters.languares.push(li_n[i].value);}
    data_only(story_script.parameters,'title');
    li_v=document.getElementsByClassName("chec_plugin");
    story_script.parameters.plugins=[];
    for(i=0;i<li_v.length;i++){if(li_v[i].checked&&plugins_list[li_v[i].id] ){story_script.parameters.plugins.push(li_v[i].id);}}
    li_v=document.getElementsByClassName("addon_path");
    for(i=0;i<li_v.length;i++){if(li_n[i].value!=""){story_script.parameters.plugins.push(li_v[i].value);}}
    lang_select();
    update_novel();
    modal_window('close');
    toast("parameters updated");
}
var scale=1;
var scale_scene=1;
document.addEventListener('keydown',function(event){
    if(!scroll_block||scene_screen){
        if(event.code=='Equal'){world_scale(2)}
        else if(event.code=='Minus'){world_scale(false)}
        else if(event.code=='Digit0'){world_scale(1)}
        else if(scene_screen&&event.code=='Comma'){scen_editor(scen_data[0],scen_data[1],scen_data[2]-1)}
        else if(scene_screen&&event.code=='Period'){scen_editor(scen_data[0],scen_data[1],scen_data[2]+1)}
    }
});
var scene_screen=false
var scroll_xs=null;
var scroll_ys=null;
function scene_z(){
    scroll_xs=((scene_view.scrollTop+(scene_view.clientHeight/2))/scale_scene)-(scene_view.clientHeight/2);
    scroll_ys=((scene_view.scrollLeft+(scene_view.clientWidth/2))/scale_scene)-(scene_view.clientWidth/2);
}
function world_scale(s){
    if(scene_screen){
        scene_z();
        if(screen_size.value!=0){
            if(s==1){scale_scene=1;scene_canvas.style.transform='scale(1)';}
            else if(s==2){scale_scene=Math.min(2,scale_scene+0.05);scene_canvas.style.transform='scale('+scale_scene+')';}
            else{scale_scene=Math.max(0.25,scale_scene-0.05);scene_canvas.style.transform='scale('+scale_scene+')';}
            scene_view.scrollTop=((scroll_xs+(scene_view.clientHeight/2))*scale_scene)-(scene_view.clientHeight/2);
            scene_view.scrollLeft=((scroll_ys+(scene_view.clientWidth/2))*scale_scene)-(scene_view.clientWidth/2);
            screen_preview.style.width=(screen_size.value*2.5)*scale_scene+"px";
            screen_preview.style.height=(screen_size.value*2.5)*scale_scene+"px";
            screen_preview.style.backgroundSize=64*scale_scene+"px"
        }else{
            if(s==1){scale_scene=1;screen_preview.style.transform='scale(1)';}
            else if(s==2){scale_scene=Math.min(2,scale_scene+0.05);screen_preview.style.transform='scale('+scale_scene+')';}
            else{scale_scene=Math.max(1,scale_scene-0.05);screen_preview.style.transform='scale('+scale_scene+')';}
            scene_view.scrollTop=((scroll_xs+(scene_view.clientHeight/2))*scale_scene)-(scene_view.clientHeight/2);
            scene_view.scrollLeft=((scroll_ys+(scene_view.clientWidth/2))*scale_scene)-(scene_view.clientWidth/2);
        }
    }else{
        scroll_z();
        add_element.style.visibility='hidden';
        if(s==1){scale=1;world.style.transform='scale(1)';}
        else if(s==2){scale=Math.min(2,scale+0.05);world.style.transform='scale('+scale+')';}
        else{scale=Math.max(0.25,scale-0.05);world.style.transform='scale('+scale+')';}
        html.scrollTop=((scroll_xz+(html.clientHeight/2))*scale)-(html.clientHeight/2);
        html.scrollLeft=((scroll_yz+(html.clientWidth/2))*scale)-(html.clientWidth/2);
    }
}
function csv_export(){
    var n,i,d,l,r;
    var CSV='name\t';
	for(i=0;i<story_script.parameters.languares.length;i++){CSV+=story_script.parameters.languares[i]+'\t';}
	CSV+='\rtitle\t';
	if(story_script.parameters.title[languare]){for(i=0;i<story_script.parameters.languares.length;i++){CSV+=story_script.parameters.title[story_script.parameters.languares[i]]+'\t';}}
    else{CSV+=story_script.parameters.title}
	CSV+='\r';
	all_blocks=0;
    while(Object.keys(story_script)[all_blocks]){
		var k=Object.keys(story_script)[all_blocks]
		if(k!="parameters"&&k!="blocks"){
			CSV+=k+'\r';
			for(var i=0;i<story_script[k].length;i++){
				if(story_script[k][i].dialogs){
					for(d=0;d<story_script[k][i].dialogs.length;d++){
						if(story_script[k][i].dialogs[d].text){
							CSV+=languare_data(story_script[k][i].dialogs[d].name)+'\t';
							if(story_script[k][i].dialogs[d].text[languare]){for(l=0;l<story_script.parameters.languares.length;l++){CSV+=story_script[k][i].dialogs[d].text[story_script.parameters.languares[l]].replace(new RegExp('\t',"g"),'')+'\t';}}
                            else{CSV+=story_script[k][i].dialogs[d].text.replace(new RegExp('\t',"g"),'')+'\t';}
							CSV+='\r';
						} else if(story_script[k][i].dialogs[d].text_add){
							CSV+=languare_data(story_script[k][i].dialogs[d].name)+'\t';
							if(story_script[k][i].dialogs[d].text_add[languare]){for(l=0;l<story_script.parameters.languares.length;l++){CSV+=story_script[k][i].dialogs[d].text_add[story_script.parameters.languares[l]].replace(new RegExp('\t',"g"),'')+'\t';}}
							else{CSV+=story_script[k][i].dialogs[d].text_add.replace(new RegExp('\t',"g"),'')+'\t';}
                            CSV+='\r';
						}
						else if(story_script[k][i].dialogs[d].choice){
							for(r=0; r<story_script[k][i].dialogs[d].choice.length; r++){
								if(story_script[k][i].dialogs[d].choice[r].text){
									CSV+='choice \t';
									if(story_script[k][i].dialogs[d].choice[r].text[languare]){for(l=0;l<story_script.parameters.languares.length;l++){
										if(story_script[k][i].dialogs[d].choice[r].text[story_script.parameters.languares[l]]){CSV+=story_script[k][i].dialogs[d].choice[r].text[story_script.parameters.languares[l]].replace(new RegExp('\t',"g"),'')+'\t';}
										else{CSV+='\t';}
									}}else{CSV+=story_script[k][i].dialogs[d].choice[r].text.replace(new RegExp('\t',"g"),'')+'\t';}
                                    CSV+='\r'
								}
							}
						}
					} CSV+='\r';
				}
			} CSV+='\r';
		} all_blocks++;
    }
    if(story_script.parameters.title){n="translate_kit_"+((story_script.parameters.title.en)?story_script.parameters.title.en :story_script.parameters.title)}
    else{n="translate_kit";}
    var uri='data:text/csv;charset=utf-8,'+encodeURIComponent(CSV);
    var dlAnchorElem=document.getElementById('downloadAnchorElem');
    dlAnchorElem.setAttribute("href",uri);
    dlAnchorElem.download=n+".csv";
    dlAnchorElem.click();
}
var objFocus;
let arr_e;
function droppFocus(){
    if(objFocus){
        objFocus.style.width=resizers.style.width;
        objFocus.style.height=resizers.style.height;
        objFocus.style.top=resizers.style.top;
        objFocus.style.left=resizers.style.left;
        objFocus.style.zIndex=resizers.style.zIndex;
        objFocus.style.transform=resizers.style.transform;
        resizers.style.transform="";
        scene_layout.appendChild(objFocus);
        objFocus='';
        resizers.style.visibility="hidden"
    }
}
function objSelect(id){
    droppFocus();
    objFocus=document.getElementById(id);
    resizers.style.height=objFocus.offsetHeight+"px"
    resizers.style.width=objFocus.offsetWidth+"px"
    resizers.style.top=objFocus.offsetTop+"px";
    resizers.style.left=objFocus.offsetLeft+"px";
    resizers.style.visibility="visible"
    resizers.style.zIndex=objFocus.style.zIndex;
    resizers.style.transform=objFocus.style.transform;
    objFocus.style.transform="";
    objFocus.style.boxSizing='border-box';
    objFocus.style.width='100%';
    objFocus.style.height='100%';
    objFocus.style.top='0px';
    objFocus.style.left='0px';
    objFocus.style.bottom='none';
    objFocus.style.right='none';
    resizers.appendChild(objFocus);
}
var moveSize=true;
function makeResizableDiv(s){
    s.onmousedown=dragMouseDown;
    function dragMouseDown(e){
        if (moveSize){
            e=e||window.event;
            e.preventDefault();
            original_x=e.clientX;
            original_y=e.clientY;
            scene_scroll=false
            document.onmouseup=closeDragElement;
            document.onmousemove=elementDrag;
        }
    }
    function elementDrag(e){
        e=e||window.event;
        e.preventDefault();
        original_mouse_x=original_x-e.clientX;
        original_mouse_y=original_y-e.clientY;
        original_x=e.clientX;
        original_y=e.clientY;
        s.style.top=(s.offsetTop-original_mouse_y/scale_scene)+"px";
        s.style.left=(s.offsetLeft-original_mouse_x/scale_scene)+"px";
    }
    function closeDragElement(){saveResize();}
    const resizers=document.getElementsByClassName("resizer");
    const minSize=26;
    let original_width=0,original_height=0,original_x=0,original_y=0,original_mouse_x=0,original_mouse_y=0;
    for (let i=0;i<resizers.length;i++){
        const sizer=resizers[i];
        sizer.addEventListener('mousedown',function(e){
            moveSize=false
            scene_scroll=false
            e.preventDefault()
            original_width=parseFloat(getComputedStyle(s,null).getPropertyValue('width').replace('px',''));
            original_height=parseFloat(getComputedStyle(s,null).getPropertyValue('height').replace('px',''));
            original_x=parseFloat(getComputedStyle(s,null).getPropertyValue('left').replace('px',''));
            original_y=parseFloat(getComputedStyle(s,null).getPropertyValue('top').replace('px',''));
            original_mouse_x=e.pageX;
            original_mouse_y=e.pageY;
            window.addEventListener('mousemove',resize)
            screen_preview.addEventListener('mouseup',stopResize)
        })
        function resize(e){
            if (sizer.classList.contains('bottom-right')){
                const width=original_width+(e.pageX-original_mouse_x)/scale_scene;
                const height=original_height+(e.pageY-original_mouse_y)/scale_scene
                if (width>minSize){s.style.width=width+'px'}
                if (height>minSize){s.style.height=height+'px'}
            } else if (sizer.classList.contains('bottom-left')){
                const height=original_height+(e.pageY-original_mouse_y)/scale_scene
                const width=original_width-(e.pageX-original_mouse_x)/scale_scene
                if (height>minSize){s.style.height=height+'px'}
                if (width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.pageX-original_mouse_x)/scale_scene+'px'}
            } else if (sizer.classList.contains('top-right')){
                const width=original_width+(e.pageX-original_mouse_x)/scale_scene
                const height=original_height-(e.pageY-original_mouse_y)/scale_scene
                if (width>minSize){s.style.width=width+'px'}
                if (height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.pageY-original_mouse_y)/scale_scene+'px'}
            } else if (sizer.classList.contains('top-left')){
                const width=original_width-(e.pageX-original_mouse_x)/scale_scene
                const height=original_height-(e.pageY-original_mouse_y)/scale_scene
                if (width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.pageX-original_mouse_x)/scale_scene+'px'}
                if (height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.pageY-original_mouse_y)/scale_scene+'px'}
            } else if (sizer.classList.contains('size-top')){
                const height=original_height-(e.pageY-original_mouse_y)/scale_scene
                if (height>minSize){s.style.height=height+'px';s.style.top=original_y+(e.pageY-original_mouse_y)/scale_scene+'px'}
            } else if (sizer.classList.contains('size-bottom')){
                const height=original_height+(e.pageY-original_mouse_y)/scale_scene
                if (height>minSize){s.style.height=height+'px'}
            } else if (sizer.classList.contains('size-left')){
                const width=original_width-(e.pageX-original_mouse_x)/scale_scene
                if (width>minSize){s.style.width=width+'px';s.style.left=original_x+(e.pageX-original_mouse_x)/scale_scene+'px'}
            } else if (sizer.classList.contains('size-right')){
                const width=original_width+(e.pageX-original_mouse_x)/scale_scene
                if (width>minSize){s.style.width=width+'px'}
            }
        }
        function stopResize(){
            window.removeEventListener('mousemove',resize);
            moveSize=true;
            saveResize();
        }
    }
}
function saveResize(){
    if(!scene_scroll){
        arr_e.position[0]=0;arr_e.position[1]=0;arr_e.position[2]=0;arr_e.position[3]=0
        var layout_width=parseFloat(getComputedStyle(scene_layout,null).getPropertyValue('width').replace('px',''));
        var layout_height=parseFloat(getComputedStyle(scene_layout,null).getPropertyValue('height').replace('px',''));
        var z=resizers.style.left.replace('px','')
        var b=objFocus.style.borderWidth.replace('px','')*2;
        if ((layout_width/2)>=z){arr_e.position[0]=(z/layout_width*100).toFixed(2)+'%';}
        else{ z=parseFloat(getComputedStyle(resizers,null).getPropertyValue('right').replace('px',''));arr_e.position[1]=(z/layout_width*100).toFixed(2)+'%';}
        z=resizers.style.top.replace('px','')
        if ((layout_height/2)>=z){arr_e.position[2]=(z/layout_height*100).toFixed(2)+'%';}
        else{z=parseFloat(getComputedStyle(resizers,null).getPropertyValue('bottom').replace('px',''));arr_e.position[3]=(z/layout_height*100).toFixed(2)+'%';}
        if(arr_e.url){
            arr_e.size[0]=((resizers.style.width.replace('px','')-b)/layout_width*100).toFixed(2)+'%';
            arr_e.size[1]=((resizers.style.height.replace('px','')-b)/layout_height*100).toFixed(2)+'%';
        }else{
            arr_e.size[0]=(resizers.style.width.replace('px','')-b)+'px';
            arr_e.size[1]=(resizers.style.height.replace('px','')-b)+'px';
        }
        objFocus.style.transform=resizers.style.transform;
        resizers.style.transform="";
        scen_edit_updare(true)
    }
    document.onmouseup=null;
    document.onmousemove=null;
    scene_scroll=true
}
makeResizableDiv(document.getElementById("resizers"));
</script>
</body>
</html>
